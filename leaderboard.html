<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RMCQTMKDVP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RMCQTMKDVP');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="English Quest Leaderboard - Compete with other learners">
    <title>English Quest - Leaderboard</title>
    
    <!-- Styles -->
    <link href="/dist/output.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background-image: url('images/backgroundleader.webp');
            background-size: cover;
            background-attachment: fixed;
            color: #f0e6d2;
            margin: 0;
            padding: 0;
        }
        .leaderboard {
            background-color: rgba(0, 0, 0, 0.7);
            border: 20px solid transparent;
            border-image: url('images/fantasy-border.png') 30 round;
            margin: 20px auto;
            max-width: 1000px;
            padding: 20px;
        }
        .leaderboard h2 {
            color: #c9aa71;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        .game-leaderboard {
            margin-bottom: 40px;
        }
        .game-leaderboard h3 {
            color: #e0c589;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        .leaderboard-table th,
        .leaderboard-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #c9aa71;
        }
        .leaderboard-table th {
            background-color: rgba(201, 170, 113, 0.3);
            color: #f0e6d2;
        }
        .leaderboard-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .leaderboard-table tr:hover {
            background-color: rgba(201, 170, 113, 0.1);
        }
        .rank {
            font-weight: bold;
            color: #c9aa71;
        }
        .site-title {
            font-size: 3em;
            color: #c9aa71;
            border: 3px solid #c9aa71;
            border: 2px solid #c9aa71;
            border-radius: 50px;
            padding: 20px;
            transition: transform 0.3s;
        }
    </style>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Leaderboard - English Quest</title>
     <link rel="stylesheet" href="style.css">
     <style>
         /* Vos styles existants... */
     </style>
     <!-- Firebase SDKs -->
     <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="min-h-screen bg-quest-pattern bg-cover bg-fixed leaderboard-theme">
    <!-- Logo et Navigation -->
    <div class="logo-container">
        <img src="images/logo.gif" alt="English Quest Logo">
    </div>

    <nav>
        <div class="flex gap-8">
            <a href="index.html" class="nav-link">Home</a>
            <a href="all-games.html" class="nav-link">Games</a>
            <a href="courses.html" class="nav-link">Courses</a>
            <a href="leaderboard.html" class="nav-link active">Leaderboard</a>
            <a href="contact.html" class="nav-link">Contact</a>
        </div>
    </nav>

    <main class="min-h-screen pt-32">
        <!-- Hero Section -->
        <div class="quest-panel max-w-2xl mx-auto mb-16">
            <h1 class="glow-text">HALL OF CHAMPIONS</h1>
            <p>Discover the greatest warriors in the realm of English mastery!</p>
        </div>

        <!-- Leaderboard Section -->
        <div class="quest-panel max-w-7xl mx-auto mb-16">
            <h2 class="section-title">Global Rankings</h2>
            
            <!-- Speed Verb Challenge -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Speed Verb Challenge</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="speed-verb-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>

            <!-- Word Memory Game -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Word Memory Game</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="memory-game-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>

            <!-- Lost in Migration -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Lost in Migration</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="migration-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>

            <!-- Brew Your Words -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Brew Your Words</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="brew-words-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>

            <!-- Whisper Trials -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Whisper Trials</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="whisper-trials-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>

            <!-- Matrix Game -->
            <div class="mb-12">
                <h3 class="text-xl font-medieval text-quest-red mb-4">Fill in the Gaps</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Champion</th>
                            <th>Score</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="matrix-game-leaderboard">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="fixed bottom-0 w-full">
        <div class="bg-gradient-to-t from-black via-black/95 to-black/75 backdrop-blur-sm border-t border-quest-gold/30">
            <div class="container mx-auto px-4 py-3">
                <div class="text-center">
                    <p class="text-quest-gold/90 font-quest">&copy; 2024 English Quest by Pierre Marienne</p>
                    <div id="visit-stats" class="text-quest-gold/70 mt-1 font-medieval"></div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAm_fvXFh9Iv1EkoCJniaLkmXOelC6CRv0",
            authDomain: "english-games-41017.firebaseapp.com",
            projectId: "english-games-41017",
            storageBucket: "english-games-41017.appspot.com",
            messagingSenderId: "452279652544",
            appId: "1:452279652544:web:916f93e0ab29183e739d25",
            measurementId: "G-RMCQTMKDVP"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Fonction pour charger les scores d'un jeu spécifique
        function loadGameScores(collectionName, tableId) {
            console.log(`Loading scores for ${collectionName}`);
            db.collection(collectionName)
                .orderBy("score", "desc")
                .limit(3)
                .get()
                .then((querySnapshot) => {
                    const tableBody = document.getElementById(tableId);
                    tableBody.innerHTML = "";
                    let rank = 1;
                    querySnapshot.forEach((doc) => {
                        const row = document.createElement('tr');
                        row.className = `rank-${rank}`;
                        
                        const date = doc.data().timestamp ? 
                            new Date(doc.data().timestamp.seconds * 1000).toLocaleDateString() : 
                            'N/A';
                        
                        row.innerHTML = `
                            <td class="rank">${rank}</td>
                            <td>${doc.data().name || 'Anonymous'}</td>
                            <td class="score">${doc.data().score}</td>
                            <td>${date}</td>
                        `;
                        tableBody.appendChild(row);
                        rank++;
                    });
                })
                .catch((error) => {
                    console.error(`Error loading ${collectionName} scores:`, error);
                });
        }

        // Chargement des scores au chargement de la page
        document.addEventListener('DOMContentLoaded', (event) => {
            console.log("DOM fully loaded, loading scores...");
            loadGameScores("speed_verb_scores", "speed-verb-leaderboard");
            loadGameScores("word_memory_game_scores", "memory-game-leaderboard");
            loadGameScores("memory_matrix_scores", "matrix-game-leaderboard");
            loadGameScores("lost_in_migration_scores", "migration-leaderboard");
            loadGameScores("brewYourWordsScores", "brew-words-leaderboard");
            loadGameScores("enigma_scroll_scores", "enigma-scroll-leaderboard");
            loadGameScores("whisper_trials_scores", "whisper-trials-leaderboard");
            loadGameScores("word_bubbles_scores", "word-bubbles-leaderboard");
            loadGameScores("echoes_lexicon_scores", "echoes-lexicon-leaderboard");

            // Compteur de visites
            incrementUniqueVisitCount().then(() => {
                displayVisitorCount();
            }).catch((error) => {
                console.error("Error updating visitor count:", error);
            });
        });

        // Fonctions pour le compteur de visites (conservées de votre code original)
        function incrementUniqueVisitCount() {
            const visitorId = localStorage.getItem('visitorId') || Math.random().toString(36).substr(2, 9);
            localStorage.setItem('visitorId', visitorId);

            const today = new Date().toISOString().split('T')[0];
            const visitsRef = db.collection('visits').doc(today);

            return db.runTransaction((transaction) => {
                return transaction.get(visitsRef).then((doc) => {
                    if (!doc.exists) {
                        transaction.set(visitsRef, { count: 1, visitors: [visitorId] });
                    } else {
                        const data = doc.data();
                        if (!data.visitors.includes(visitorId)) {
                            transaction.update(visitsRef, {
                                count: data.count + 1,
                                visitors: firebase.firestore.FieldValue.arrayUnion(visitorId)
                            });
                        }
                    }
                });
            });
        }

        function displayVisitorCount() {
            const today = new Date().toISOString().split('T')[0];
            db.collection('visits').doc(today).get().then((doc) => {
                if (doc.exists) {
                    const visitStats = document.getElementById('visit-stats');
                    visitStats.textContent = `Visiteurs uniques aujourd'hui : ${doc.data().count}`;
                }
            }).catch((error) => {
                console.error("Error getting visitor count:", error);
            });
        }
    </script>
</body>
</html>
