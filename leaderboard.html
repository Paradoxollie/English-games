<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RMCQTMKDVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RMCQTMKDVP');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="English Quest Leaderboard - Compare your scores with other players">
    <title>English Quest - Leaderboard</title>
    
    <!-- Polices -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link href="./dist/output.css" rel="stylesheet">
    <link href="./src/styles/layout.css" rel="stylesheet">
    <link href="./src/styles/fonts.css" rel="stylesheet">
    <link href="./src/styles/transitions.css" rel="stylesheet">
    <link href="./src/styles/colors.css" rel="stylesheet">
    <link href="./src/styles/navigation.css" rel="stylesheet">
    <link href="./src/styles/leaderboard.css" rel="stylesheet">
    <link href="./src/styles/visitor-counter.css" rel="stylesheet">
    <link href="./src/styles/nav-reset.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>

    <!-- Scripts de l'application -->
    <script src="./src/config/firebase-config.js"></script>
    <script src="./src/js/performance.js"></script>
    <script src="./src/js/accessibility.js"></script>
    <script src="./src/js/cache-manager.js"></script>
    <script src="./src/js/monitoring.js"></script>

    <!-- Preload des ressources critiques -->
    <link rel="preload" href="./src/js/performance.js" as="script">
    <link rel="preload" href="./src/js/accessibility.js" as="script">

    <style>
        /* Styles pour le compteur de visites */
        .counter-container {
            @apply space-y-2;
        }
        .counter-item {
            @apply flex justify-between items-center bg-black/50 p-2 rounded;
        }
        .counter-label {
            @apply mr-4 font-medieval;
        }
        .counter-value {
            @apply font-bold;
        }
        
        /* Styles pour les onglets de difficult√© */
        .difficulty-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .tab-btn {
            background-color: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .tab-btn.active {
            background-color: rgba(255, 68, 68, 0.2);
            border-color: rgba(255, 68, 68, 0.5);
            color: #ff4444;
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.3);
        }
        
        /* Styles pour le bouton "Jouer maintenant" */
        .play-btn {
            display: inline-block;
            background-color: rgba(255, 68, 68, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .play-btn:hover {
            background-color: rgba(255, 68, 68, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Styles pour le spinner de chargement */
        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 68, 68, 0.3);
            border-radius: 50%;
            border-top-color: #ff4444;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-quest-pattern" data-page="leaderboard" style="background-image: url('./images/background.webp');">
    <!-- Header -->
    <header class="site-header" role="banner" aria-label="Site header">
        <div class="logo-container">
            <img src="./images/logo.gif" alt="English Quest Logo" class="w-48 md:w-64 h-auto" width="600" height="400" loading="eager" decoding="async">
        </div>

        <nav class="main-nav overflow-x-auto" role="navigation" aria-label="Main navigation">
            <div class="w-full overflow-x-auto">
                <div class="container mx-auto grid grid-flow-col auto-cols-max gap-8 justify-center px-4 py-3">
                    <a href="index.html" class="nav-link text-sm md:text-base hover:text-white">Home</a>
                    <a href="./all-games.html" class="nav-link text-sm md:text-base hover:text-white">Games</a>
                    <a href="./courses.html" class="nav-link text-sm md:text-base hover:text-white">Courses</a>
                    <a href="./leaderboard.html" class="nav-link active text-[#ff4444] hover:text-[#ff4444] relative glow-red text-sm md:text-base">Leaderboard</a>
                    <a href="./contact.html" class="nav-link text-sm md:text-base hover:text-white">Contact</a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content" class="min-h-screen pt-32 pb-32" role="main">
        <!-- Hero Section -->
        <div class="quest-panel max-w-2xl mx-auto mb-8 md:mb-16 text-center px-4" role="banner">
            <h1 id="page-title" class="text-3xl md:text-5xl font-bold mb-4 md:mb-6 glow-text">
                <span class="text-white">HALL OF</span>
                <span class="text-quest-red">CHAMPIONS</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-300 font-medieval italic">
                "Where Legends Rise and Heroes are Eternal"
            </p>
        </div>

        <!-- Leaderboard Section -->
        <div class="quest-panel max-w-7xl mx-auto mb-8 md:mb-16 px-4">
            <div id="leaderboards" role="region" aria-labelledby="page-title">
                <!-- Speed Verb Challenge -->
                <div class="game-section w-full overflow-x-auto">
                    <div class="text-center mb-4">
                        <h2 class="game-title text-xl md:text-2xl px-2">
                            <span class="game-icon">‚öîÔ∏è</span>
                            Speed Verb Challenge
                            <span class="game-icon">‚öîÔ∏è</span>
                        </h2>
                    </div>
                    <div class="w-full">
                        <p class="text-center text-sm text-gray-300 mb-2">Top 3 des meilleurs scores</p>
                        <table class="podium-table w-full min-w-[300px] text-sm md:text-base">
                            <thead>
                                <tr>
                                    <th class="px-2 py-2">Rang</th>
                                    <th class="px-2 py-2">Champion</th>
                                    <th class="px-2 py-2">Score</th>
                                    <th class="px-2 py-2">Date</th>
                                </tr>
                            </thead>
                            <tbody id="speed-verb-leaderboard">
                                <!-- Rempli dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Word Memory Game -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üéØ</span>
                        Word Memory Game
                        <span class="game-icon">üéØ</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="memory-game-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Memory Matrix -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üß©</span>
                        Memory Matrix
                        <span class="game-icon">üß©</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="matrix-game-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Lost in Migration -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">ü¶Ö</span>
                        Lost in Migration
                        <span class="game-icon">ü¶Ö</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="migration-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Brew Your Words -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üß™</span>
                        Brew Your Words
                        <span class="game-icon">üß™</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="brew-words-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Whisper Trials -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üé≠</span>
                        Whisper Trials
                        <span class="game-icon">üé≠</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="whisper-trials-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Word Bubbles -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">ü´ß</span>
                        Word Bubbles
                        <span class="game-icon">ü´ß</span>
                    </h2>
                    <div class="w-full">
                        <div class="difficulty-tabs mb-4 flex justify-center gap-2">
                            <button class="tab-btn active" data-difficulty="all" data-game="word-bubbles">Tous</button>
                            <button class="tab-btn" data-difficulty="easy" data-game="word-bubbles">Facile</button>
                            <button class="tab-btn" data-difficulty="normal" data-game="word-bubbles">Normal</button>
                            <button class="tab-btn" data-difficulty="hard" data-game="word-bubbles">Difficile</button>
                        </div>
                        <p class="text-center text-sm text-gray-300 mb-2">Top 3 des meilleurs scores</p>
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANG</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>NIVEAU</th>
                                    <th>DIFFICULT√â</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="word-bubbles-leaderboard">
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <div class="loading-spinner"></div>
                                        <p class="mt-2">Chargement des scores...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="text-center mt-4">
                            <a href="wow-bubbles.html" class="play-btn">Jouer maintenant</a>
                        </div>
                    </div>
                </div>

                <!-- Echoes of Lexicon -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üìö</span>
                        Echoes of Lexicon
                        <span class="game-icon">üìö</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="echoes-lexicon-leaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Enigma Scroll -->
                <div class="game-section w-full overflow-x-auto">
                    <h2 class="game-title">
                        <span class="game-icon">üìú</span>
                        Enigma Scroll
                        <span class="game-icon">üìú</span>
                    </h2>
                    <div class="w-full">
                        <table class="podium-table w-full min-w-[500px]">
                            <thead>
                                <tr>
                                    <th>RANK</th>
                                    <th>CHAMPION</th>
                                    <th>SCORE</th>
                                    <th>DATE</th>
                                </tr>
                            </thead>
                            <tbody id="enigma-scroll-leaderboard"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer correct -->
    <footer class="quest-footer">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-[#ff4444] text-lg font-medieval mb-4">About Us</h3>
                    <p class="text-gray-300">
                        English Quest is dedicated to making language learning fun and effective through interactive games.
                    </p>
                </div>
                <div>
                    <h3 class="text-[#ff4444] text-lg font-medieval mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="./index.html" class="footer-link">Home</a></li>
                        <li><a href="./all-games.html" class="footer-link">All Games</a></li>
                        <li><a href="./courses.html" class="footer-link">Courses</a></li>
                        <li><a href="./contact.html" class="footer-link">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-[#ff4444] text-lg font-medieval mb-4">Stats</h3>
                    <div class="visitor-counter text-left mb-4">
                        <div id="visitor-count" class="counter-wrapper">
                            <div class="counter-loading">
                                <span class="text-[#ff4444]">Loading visitor stats...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
            <div class="mt-8 pt-8" style="border-top: 1px solid rgba(255, 68, 68, 0.3);">
                <p class="text-gray-400">&copy; 2024 - English Quest - Pierre Marienne - All rights reserved </p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', async (event) => {
            try {
                // Initialiser les services
                const monitoring = new MonitoringService();
                const cacheManager = new CacheManager();
                const performanceOptimizer = new PerformanceOptimizer();
                const accessibilityManager = new AccessibilityManager();

                // Setup cache
                cacheManager.setupImageCache();

                // Fonction pour mettre √† jour le tableau
                function updateLeaderboardTable(scores, tableId) {
                    const tableBody = document.getElementById(tableId);
                    if (!tableBody) return;
                    
                    // Vider le tableau
                    tableBody.innerHTML = "";
                    
                    // Si aucun score, afficher un message
                    if (scores.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="4" class="text-center py-4">
                                    <p>Aucun score enregistr√©.</p>
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    // Ajouter les scores (maximum 3)
                    scores.slice(0, 3).forEach((doc, index) => {
                        const rank = index + 1;
                        const row = document.createElement('tr');
                        row.className = rank === 1 ? 'top-score' : '';
                        
                        const date = doc.timestamp ? 
                            new Date(doc.timestamp.seconds * 1000).toLocaleDateString() : 
                            'N/A';
                        
                        row.innerHTML = `
                            <td class="rank">${rank}</td>
                            <td>${doc.name || 'Anonyme'}</td>
                            <td class="score">${doc.score}</td>
                            <td>${date}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }

                // Fonction optimis√©e pour charger les scores
                async function loadGameScores(collectionName, tableId) {
                    try {
                        console.log(`Loading scores for ${collectionName}`);
                        
                        // Afficher un message de chargement
                        const tableBody = document.getElementById(tableId);
                        if (tableBody) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <div class="loading-spinner"></div>
                                        <p class="mt-2">Chargement des scores...</p>
                                    </td>
                                </tr>
                            `;
                        }
                        
                        const snapshot = await db.collection(collectionName)
                            .orderBy("score", "desc")
                            .limit(3) // Limiter √† 3 r√©sultats
                            .get();
                        
                        const scores = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            if (data) {
                                scores.push({
                                    id: doc.id,
                                    ...data
                                });
                            }
                        });
                        
                        // V√©rifier s'il y a des r√©sultats
                        if (scores.length === 0) {
                            if (tableBody) {
                                tableBody.innerHTML = `
                                    <tr>
                                        <td colspan="4" class="text-center py-4">
                                            <p>Aucun score enregistr√©.</p>
                                        </td>
                                    </tr>
                                `;
                            }
                            return;
                        }
                        
                        updateLeaderboardTable(scores, tableId);
                        
                        // Mettre en cache pour plus tard
                        await cacheManager.setCachedScores(collectionName, scores);
                        
                        monitoring.trackPerformance({
                            name: `scores_loaded_${collectionName}`,
                            value: Date.now()
                        });
                        
                        console.log(`Scores ${collectionName} charg√©s (nombre: ${scores.length})`);
                    } catch (error) {
                        console.error(`Error loading ${collectionName} scores:`, error);
                        
                        // Afficher un message d'erreur
                        const tableBody = document.getElementById(tableId);
                        if (tableBody) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <p>Erreur lors du chargement des scores. Veuillez r√©essayer plus tard.</p>
                                    </td>
                                </tr>
                            `;
                        }
                        
                        monitoring.trackError(error, {
                            context: 'loadGameScores',
                            collectionName,
                            tableId
                        });
                    }
                }

                // Fonction sp√©cifique pour charger les scores de Word Bubbles
                async function loadWordBubblesScores(difficulty = 'all') {
                    try {
                        const tableBody = document.getElementById('word-bubbles-leaderboard');
                        if (!tableBody) return;
                        
                        // Afficher un message de chargement
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" class="text-center py-4">
                                    <div class="loading-spinner"></div>
                                    <p class="mt-2">Chargement des scores...</p>
                                </td>
                            </tr>
                        `;
                        
                        console.log("Chargement des scores Word Bubbles pour difficult√©:", difficulty);
                        
                        try {
                            // V√©rifier si Firebase est disponible
                            if (!db || !db.collection) {
                                console.warn("Firebase n'est pas disponible, chargement des scores locaux");
                                loadLocalWordBubblesScores(difficulty);
                                return;
                            }
                            
                            // Cr√©er la requ√™te de base - toujours trier par score d√©croissant
                            let query = db.collection("word_bubbles_scores").orderBy("score", "desc");
                            
                            // Limiter √† 10 r√©sultats pour avoir plus de chances de trouver des scores pour chaque difficult√©
                            query = query.limit(10);
                            
                            // Ex√©cuter la requ√™te
                            const snapshot = await query.get();
                            
                            console.log(`Requ√™te ex√©cut√©e, ${snapshot.size} r√©sultats trouv√©s`);
                            
                            // V√©rifier s'il y a des r√©sultats
                            if (snapshot.empty) {
                                console.log("Aucun score trouv√© dans Firebase, essai avec les scores locaux");
                                loadLocalWordBubblesScores(difficulty);
                                return;
                            }
                            
                            // Filtrer les r√©sultats c√¥t√© client si n√©cessaire (pour √©viter l'erreur d'index)
                            let filteredScores = [];
                            snapshot.forEach((doc) => {
                                const data = doc.data();
                                console.log("Score trouv√©:", data);
                                
                                // Si on filtre par difficult√© et que ce n'est pas "all", v√©rifier la difficult√©
                                if (difficulty === 'all' || data.difficulty === difficulty) {
                                    filteredScores.push({
                                        id: doc.id,
                                        ...data
                                    });
                                }
                            });
                            
                            console.log(`Apr√®s filtrage: ${filteredScores.length} scores pour difficult√© ${difficulty}`);
                            
                            // Si aucun score apr√®s filtrage, essayer les scores locaux
                            if (filteredScores.length === 0) {
                                console.log("Aucun score Firebase pour cette difficult√©, essai avec les scores locaux");
                                loadLocalWordBubblesScores(difficulty);
                                return;
                            }
                            
                            // Trier √† nouveau les scores filtr√©s
                            filteredScores.sort((a, b) => Number(b.score) - Number(a.score));
                            
                            // Limiter √† 3 scores maximum
                            filteredScores = filteredScores.slice(0, 3);
                            
                            // Vider le tableau
                            tableBody.innerHTML = "";
                            
                            // Ajouter les scores
                            filteredScores.forEach((data, index) => {
                                const rank = index + 1;
                                const row = document.createElement('tr');
                                row.className = rank === 1 ? 'top-score' : '';
                                
                                // Essayer d'obtenir la date √† partir de timestamp ou date
                                let dateStr = 'N/A';
                                if (data.timestamp && data.timestamp.seconds) {
                                    dateStr = new Date(data.timestamp.seconds * 1000).toLocaleDateString();
                                } else if (data.date) {
                                    dateStr = new Date(data.date).toLocaleDateString();
                                }
                                
                                const difficultyName = data.difficulty ? 
                                    data.difficulty.charAt(0).toUpperCase() + data.difficulty.slice(1) : 
                                    'Normal';
                                
                                row.innerHTML = `
                                    <td class="rank">${rank}</td>
                                    <td>${data.name || 'Anonyme'}</td>
                                    <td class="score">${data.score}</td>
                                    <td>${data.level || 1}</td>
                                    <td>${difficultyName}</td>
                                    <td>${dateStr}</td>
                                `;
                                
                                tableBody.appendChild(row);
                            });
                            
                            console.log(`Scores Word Bubbles affich√©s (difficult√©: ${difficulty}, nombre: ${filteredScores.length})`);
                        } catch (error) {
                            console.error("Erreur Firebase lors du chargement des scores:", error);
                            console.log("Tentative de chargement des scores locaux suite √† l'erreur Firebase");
                            loadLocalWordBubblesScores(difficulty);
                        }
                    } catch (error) {
                        console.error("Erreur lors du chargement des scores Word Bubbles:", error);
                        const tableBody = document.getElementById('word-bubbles-leaderboard');
                        if (tableBody) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <p>Erreur lors du chargement des scores: ${error.message}</p>
                                        <button class="tab-btn mt-2" onclick="loadLocalWordBubblesScores('${difficulty}')">
                                            Essayer avec les scores locaux
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }
                    }
                }

                // Gestionnaire d'√©v√©nements pour les onglets de difficult√©
                document.querySelectorAll('.tab-btn[data-game="word-bubbles"]').forEach(button => {
                    button.addEventListener('click', function() {
                        // Retirer la classe active de tous les boutons
                        document.querySelectorAll('.tab-btn[data-game="word-bubbles"]').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        // Ajouter la classe active au bouton cliqu√©
                        this.classList.add('active');
                        
                        // Charger les scores pour la difficult√© s√©lectionn√©e
                        const difficulty = this.dataset.difficulty;
                        
                        // Essayer d'abord avec Firebase
                        try {
                            loadWordBubblesScores(difficulty);
                        } catch (error) {
                            console.error("Erreur lors du chargement des scores Firebase:", error);
                            // En cas d'erreur, essayer avec les scores locaux
                            loadLocalWordBubblesScores(difficulty);
                        }
                    });
                });

                // Charger les scores
                loadGameScores("speed_verb_scores", "speed-verb-leaderboard");
                loadGameScores("word_memory_game_scores", "memory-game-leaderboard");
                loadGameScores("memory_matrix_scores", "matrix-game-leaderboard");
                loadGameScores("lost_in_migration_scores", "migration-leaderboard");
                loadGameScores("brewYourWordsScores", "brew-words-leaderboard");
                loadGameScores("enigma_scroll_scores", "enigma-scroll-leaderboard");
                loadGameScores("whisper_trials_scores", "whisper-trials-leaderboard");
                loadWordBubblesScores('all'); // Charger tous les scores Word Bubbles
                loadGameScores("echoes_lexicon_scores", "echoes-lexicon-leaderboard");

                // Fonction pour charger les scores locaux si Firebase n'est pas disponible
                function loadLocalWordBubblesScores(difficulty = 'all') {
                    try {
                        const tableBody = document.getElementById('word-bubbles-leaderboard');
                        if (!tableBody) return;
                        
                        console.log("Tentative de chargement des scores locaux pour Word Bubbles");
                        
                        // R√©cup√©rer les scores du localStorage
                        const localScoresJson = localStorage.getItem('wordBubblesGlobalScores');
                        if (!localScoresJson) {
                            console.log("Aucun score local trouv√©");
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <p>Aucun score local enregistr√©.</p>
                                    </td>
                                </tr>
                            `;
                            return;
                        }
                        
                        // Convertir les scores en objet
                        let localScores = JSON.parse(localScoresJson);
                        console.log(`${localScores.length} scores locaux trouv√©s`);
                        
                        // Filtrer par difficult√© si n√©cessaire
                        if (difficulty !== 'all') {
                            localScores = localScores.filter(score => score.difficulty === difficulty);
                        }
                        
                        // V√©rifier s'il y a des scores apr√®s filtrage
                        if (localScores.length === 0) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <p>Aucun score local pour cette difficult√©.</p>
                                    </td>
                                </tr>
                            `;
                            return;
                        }
                        
                        // Trier les scores
                        localScores.sort((a, b) => Number(b.score) - Number(a.score));
                        
                        // Limiter √† 3 scores
                        localScores = localScores.slice(0, 3);
                        
                        // Vider le tableau
                        tableBody.innerHTML = "";
                        
                        // Ajouter les scores
                        localScores.forEach((score, index) => {
                            const rank = index + 1;
                            const row = document.createElement('tr');
                            row.className = rank === 1 ? 'top-score' : '';
                            
                            const dateStr = score.date ? new Date(score.date).toLocaleDateString() : 'N/A';
                            const difficultyName = score.difficulty ? 
                                score.difficulty.charAt(0).toUpperCase() + score.difficulty.slice(1) : 
                                'Normal';
                            
                            row.innerHTML = `
                                <td class="rank">${rank}</td>
                                <td>${score.name || 'Anonyme'}</td>
                                <td class="score">${score.score}</td>
                                <td>${score.level || 1}</td>
                                <td>${difficultyName}</td>
                                <td>${dateStr} (local)</td>
                            `;
                            
                            tableBody.appendChild(row);
                        });
                        
                        console.log(`Scores locaux affich√©s: ${localScores.length}`);
                    } catch (error) {
                        console.error("Erreur lors du chargement des scores locaux:", error);
                        const tableBody = document.getElementById('word-bubbles-leaderboard');
                        if (tableBody) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <p>Erreur lors du chargement des scores locaux.</p>
                                    </td>
                                </tr>
                            `;
                        }
                    }
                }
            } catch (error) {
                console.error("Error loading leaderboard:", error);
                monitoring.trackError(error, {
                    context: 'loadLeaderboard'
                });
            }
        });
    </script>
    <script src="./visit-counter.js"></script>
</body>
</html>