<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RMCQTMKDVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RMCQTMKDVP');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Speed Verb Challenge - Maîtrisez les verbes irréguliers anglais dans cette expérience RPG immersive">
    <meta name="theme-color" content="#0f172a">
    <title>Speed Verb Challenge | English Quest</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=MedievalSharp&display=swap" rel="stylesheet">

    <!-- Base styles -->
    <link href="./dist/output.css" rel="stylesheet">
    <link href="./src/styles/layout.css" rel="stylesheet">

    <!-- Game-specific styles -->
    <link href="./src/styles/speed-verb-challenge.css" rel="stylesheet">
    <link href="./src/styles/button-fix.css" rel="stylesheet">
    <link href="./src/styles/mmorpg-enhanced.css" rel="stylesheet">
    <link href="./src/styles/games/challenge-notifications.css" rel="stylesheet">

    <!-- Three.js -->
    <script async src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>

    <!-- Script de correction de la navigation -->
    <script src="src/js/navigation-fix.js" defer></script>

    <!-- Nouvel ajout: CSS pour les effets avancés -->
    <style>
        /* Variables pour la hauteur de la vue sur mobile */
        :root {
            --vh: 1vh;
        }

        /* Style pour le corps de la page */
        body.game-body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #020617; /* Fond très sombre */
            overflow-x: hidden;
        }

        /* Utiliser la hauteur de la vue personnalisée pour les conteneurs principaux */
        .game-universe {
            position: relative;
            min-height: 100vh; /* Fallback */
            min-height: calc(var(--vh, 1vh) * 100);
            width: 100%;
            overflow: hidden;
            background-color: #020617; /* Fond très sombre pour éviter les espaces vides */
            padding-bottom: 50px; /* Espace supplémentaire en bas */
            padding-top: 60px; /* Espace pour la barre de navigation */
        }

        /* Effets de particules améliorés */
        .magic-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: -5;
        }

        /* Effet de brume magique */
        .magic-fog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.02) 0%, transparent 70%),
                radial-gradient(ellipse at 80% 80%, rgba(59, 130, 246, 0.02) 0%, transparent 70%);
            filter: blur(8px);
            opacity: 0.4;
            z-index: -6;
            animation: fogMovement 30s infinite alternate ease-in-out;
        }

        /* Runes flottantes améliorées */
        .arcane-runes {
            position: fixed;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            z-index: -4;
            pointer-events: none;
        }

        .rune {
            position: absolute;
            font-family: 'MedievalSharp', cursive;
            color: var(--primary-color);
            opacity: 0;
            text-shadow: 0 0 10px var(--primary-glow);
            animation: runeFloat 15s infinite ease-in-out;
        }

        @keyframes runeFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Effet de profondeur pour les cartes */
        .depth-card {
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }

        /* Suppression de l'effet de mouvement au survol */
        .depth-card:hover {
            transform: none;
        }

        /* Effet de portail amélioré */
        .enhanced-portal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.8) 0%, rgba(59, 130, 246, 0.1) 70%, transparent 100%);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.5);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
        }

        .enhanced-portal.active {
            animation: portalOpen 2s forwards ease-out;
        }

        @keyframes portalOpen {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
        }

        /* Effet de lumière pour les boutons */
        .glow-button {
            position: relative;
            overflow: hidden;
        }

        .glow-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glow-button:hover::after {
            opacity: 1;
        }

        /* Style pour les bonus cumulatifs */
        .cumulative-bonus {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            display: inline-block;
            margin-left: 4px;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
        }

        .power-item {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .power-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Styles pour l'option de seconde chance */
        .second-chance-option {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(23, 32, 57, 0.95), rgba(12, 17, 30, 0.98));
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            z-index: 1000;
            box-shadow:
                0 0 30px rgba(255, 215, 0, 0.5),
                inset 0 0 15px rgba(255, 215, 0, 0.3);
            animation: secondChanceAppear 0.5s ease-out forwards;
            max-width: 90%;
            width: 400px;
        }

        .second-chance-title {
            font-size: 1.8rem;
            color: rgba(255, 215, 0, 0.9);
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            font-family: 'MedievalSharp', cursive;
            letter-spacing: 2px;
        }

        .second-chance-icon {
            margin-right: 10px;
            font-size: 1.5rem;
            animation: pulseIcon 2s infinite ease-in-out;
            display: inline-block;
        }

        .second-chance-desc {
            font-size: 1.2rem;
            color: var(--text-light);
            margin: 1.5rem 0;
        }

        .second-chance-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        @keyframes secondChanceAppear {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            70% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes pulseIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Effet de lueur pour la seconde chance */
        .second-chance-glow {
            animation: secondChanceGlow 1s ease-out;
        }

        @keyframes secondChanceGlow {
            0% { box-shadow: 0 0 0 rgba(255, 215, 0, 0); }
            50% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.7); }
            100% { box-shadow: 0 0 0 rgba(255, 215, 0, 0); }
        }

        /* Style pour le compteur spécial de secondes chances */
        .special-hud-item {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.2));
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
            animation: specialItemPulse 2s infinite ease-in-out;
        }

        @keyframes specialItemPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
            50% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        }

        /* Animation pour nouvelle seconde chance */
        .new-chance {
            animation: newChanceAnimation 2s ease-out;
        }

        @keyframes newChanceAnimation {
            0% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Améliorations pour la visibilité sur mobile et PC */

        /* Augmenter la taille des boutons sur mobile */
        @media (max-width: 768px) {
            .game-button {
                padding: 15px 20px;
                font-size: 1.1rem;
                min-height: 60px;
                margin-bottom: 15px;
            }

            /* Améliorer la visibilité des inputs */
            .verb-input {
                font-size: 1.2rem;
                padding: 12px 15px;
                margin-bottom: 15px;
                border-width: 2px;
            }

            /* Augmenter l'espacement pour éviter les clics accidentels */
            .verb-actions {
                gap: 15px;
                margin-top: 20px;
            }

            /* Améliorer la visibilité du HUD */
            .hud-item {
                padding: 10px;
            }

            .hud-value {
                font-size: 1.6rem;
            }

            /* Rendre la seconde chance plus visible sur mobile */
            .second-chance-option {
                width: 90%;
                padding: 20px;
            }

            .second-chance-actions {
                flex-direction: column;
            }

            .second-chance-actions button {
                width: 100%;
            }
        }

        /* Améliorations pour les très petits écrans */
        @media (max-width: 480px) {
            .verb-display {
                font-size: 1.8rem !important;
                padding: 10px 0;
            }

            .verb-translation {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }

            .input-group label {
                font-size: 1rem;
                margin-bottom: 5px;
            }

            /* Réduire la taille des notifications pour qu'elles ne prennent pas tout l'écran */
            .level-up-notification {
                width: 85%;
                padding: 15px;
            }

            .level-up-title {
                font-size: 1.5rem;
            }

            .level-up-level {
                font-size: 2.5rem;
            }

            /* Améliorer la visibilité du feedback */
            .feedback-message {
                font-size: 1.1rem;
                padding: 10px;
            }
        }

        /* Améliorations pour les grands écrans */
        @media (min-width: 1200px) {
            .game-sections {
                gap: 2rem;
            }

            .game-panel {
                padding: 2rem;
            }

            /* Améliorer la lisibilité */
            .verb-display {
                font-size: 3rem;
            }

            .verb-input {
                font-size: 1.2rem;
            }

            /* Rendre les boutons plus visibles */
            .game-button {
                padding: 15px 25px;
                font-size: 1.1rem;
            }
        }

        /* Correction spécifique pour le leaderboard */
        .leaderboard-container {
            display: block;
            width: 100%;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-scroll {
            height: auto;
            max-height: 400px;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
            padding: 0.5rem;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        .leaderboard-table thead th {
            padding: 0.75rem 0.5rem;
            text-align: left;
            color: #3b82f6;
            font-family: 'MedievalSharp', cursive;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
        }

        .leaderboard-table tbody tr {
            background: linear-gradient(to right, rgba(59, 130, 246, 0.05), rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 3px solid transparent;
        }

        .leaderboard-table tbody tr:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 3px solid rgba(59, 130, 246, 0.5);
        }

        .leaderboard-table td {
            padding: 0.75rem 0.5rem;
            color: #e5e7eb;
            font-family: 'Cinzel', serif;
        }

        .leaderboard-table .rank-cell {
            font-weight: bold;
            color: #3b82f6;
            font-size: 1.2rem;
            width: 60px;
            text-align: center;
        }

        .leaderboard-table .player-cell {
            font-weight: 600;
            color: #93c5fd;
        }

        .leaderboard-table .score-cell {
            font-weight: 600;
            color: #dbeafe;
        }

        .leaderboard-table .date-cell {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        /* Top 3 styles */
        .leaderboard-table tbody tr:nth-child(1) {
            background: linear-gradient(to right, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border-left: 3px solid gold;
        }

        .leaderboard-table tbody tr:nth-child(2) {
            background: linear-gradient(to right, rgba(192, 192, 192, 0.1), rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.1));
            border-left: 3px solid silver;
        }

        .leaderboard-table tbody tr:nth-child(3) {
            background: linear-gradient(to right, rgba(205, 127, 50, 0.1), rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.1));
            border-left: 3px solid #cd7f32;
        }

        .loading-row td {
            text-align: center;
            padding: 2rem 0;
            color: #3b82f6;
        }

        .loading-text {
            font-family: 'MedievalSharp', cursive;
            font-style: italic;
            display: inline-block;
            position: relative;
        }

        .loading-dots {
            display: inline-block;
            width: 20px;
            animation: loadingDots 1.5s infinite;
        }

        @keyframes loadingDots {
            0% { content: "."; }
            33% { content: ".."; }
            66% { content: "..."; }
            100% { content: ""; }
        }

        /* Correction pour les panneaux de jeu */
        .game-panel {
            margin-bottom: 2rem;
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }

        .panel-content {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }

        /* Correction pour la section des règles */
        .rules-panel {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }

        .quest-scroll {
            max-height: 300px !important;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
        }

        /* Styles pour la modale */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .modal.show {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .modal.persistent {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .modal-content {
            background: linear-gradient(135deg, #172039 0%, #0c111e 100%);
            color: #e5e7eb;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3), 0 0 50px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid #3b82f6;
            animation: modalGlow 3s infinite alternate;
            pointer-events: auto;
            padding: 0;
        }

        @keyframes modalGlow {
            0% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.3), 0 0 50px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 35px rgba(59, 130, 246, 0.5), 0 0 60px rgba(0, 0, 0, 0.6); }
        }

        .modal-header {
            background: linear-gradient(to right, #172039, #1e293b);
            padding: 1.5rem;
            border-bottom: 1px solid #3b82f6;
            border-radius: 15px 15px 0 0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-title {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.8rem;
            color: #3b82f6;
            text-align: center;
            margin: 0;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            letter-spacing: 1px;
        }

        .modal-close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: #3b82f6;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(59, 130, 246, 0.1);
        }

        .modal-close:hover {
            background-color: rgba(59, 130, 246, 0.2);
            transform: scale(1.1);
            color: #93c5fd;
        }

        .modal-body {
            padding: 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #d1d5db;
        }

        .modal-body h3 {
            font-family: 'MedievalSharp', cursive;
            color: #93c5fd;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 0.5rem;
        }

        .modal-body ul {
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
            position: relative;
            padding-left: 0.5rem;
        }

        .modal-body li::before {
            content: "•";
            color: #3b82f6;
            position: absolute;
            left: -1rem;
            top: 0;
            font-size: 1.2rem;
        }

        .modal-body strong {
            color: #93c5fd;
            font-weight: 600;
        }

        /* Styles spécifiques pour la modale enrichie */
        .modal-body .drop-cap {
            font-size: 2.5em;
            float: left;
            line-height: 0.8em;
            margin-right: 0.2em;
            color: #3b82f6;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }

        .modal-body .highlight-text {
            color: #93c5fd;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
        }

        .modal-body .warning-text {
            color: #f87171;
            font-weight: 600;
        }

        .modal-body .rules-list {
            list-style: none;
            padding: 0;
        }

        .modal-body .rule-item {
            display: flex;
            margin-bottom: 1.5rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .modal-body .rule-icon {
            font-size: 1.8rem;
            margin-right: 1rem;
            align-self: flex-start;
            display: inline-block;
        }

        .modal-body .animated-icon {
            animation: pulse 2s infinite ease-in-out;
        }

        .modal-body .rule-content {
            flex: 1;
        }

        .modal-body .rule-title {
            font-family: 'MedievalSharp', cursive;
            color: #3b82f6;
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .modal-body .sub-rules {
            list-style: none;
            padding-left: 0;
            margin-top: 0.5rem;
        }

        .modal-body .sub-rules li {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 4px;
            border-left: 3px solid rgba(59, 130, 246, 0.3);
        }

        .modal-body .sub-rules li::before {
            content: none;
        }

        .modal-body .path-text {
            font-weight: 600;
            color: #3b82f6;
            display: block;
            margin-bottom: 0.2rem;
        }

        .modal-body .path-description {
            display: block;
            font-size: 0.9em;
            margin-bottom: 0.2rem;
        }

        .modal-body .path-reward {
            font-size: 0.85em;
            color: #93c5fd;
            font-style: italic;
        }

        .modal-body .special-powers {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .modal-body .power-item {
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .modal-body .power-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: rgba(59, 130, 246, 0.1);
        }

        .modal-body .power-icon {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            animation: pulse 3s infinite ease-in-out;
        }

        .modal-body .power-name {
            font-weight: 600;
            color: #3b82f6;
            margin-bottom: 0.3rem;
        }

        .modal-body .power-desc {
            font-size: 0.9em;
        }

        .modal-body .cumulative-bonus {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            display: inline-block;
            margin-left: 4px;
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(59, 130, 246, 0.3);
            text-align: center;
            border-radius: 0 0 15px 15px;
        }

        /* Bouton d'aide flottant */
        .help-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #172039, #0c111e);
            border: 2px solid #3b82f6;
            color: #3b82f6;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }

        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            border-color: #93c5fd;
        }

        .help-icon {
            font-size: 2rem;
            animation: pulse 2s infinite ease-in-out;
        }

        @media (max-width: 600px) {
            .help-button {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }

            .help-icon {
                font-size: 1.5rem;
            }

            .modal-content {
                width: 95%;
            }

            .modal-body {
                padding: 1rem;
                font-size: 1rem;
            }
        }

        .game-over-actions {
            display: flex;
            gap: 1rem;
            width: 100%;
            justify-content: center;
            margin-bottom: 2rem;
        }

        /* Styles pour les scores récents */
        .recent-scores {
            border-top: 1px solid rgba(59, 130, 246, 0.3);
            padding-top: 1.5rem;
            margin-top: 1rem;
        }

        .recent-scores-title {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.2rem;
            color: #3b82f6;
            margin-bottom: 1rem;
            text-align: center;
        }

        .recent-scores-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .recent-scores-list li {
            background: rgba(59, 130, 246, 0.05);
            margin-bottom: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 3px solid rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .recent-scores-list li:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 3px solid rgba(59, 130, 246, 0.7);
        }

        .recent-scores-list .score-info {
            font-weight: 600;
            color: #93c5fd;
        }

        .recent-scores-list .score-details {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .recent-scores-list .score-date {
            font-style: italic;
        }

        .loading-recent-scores {
            text-align: center;
            color: #3b82f6;
            font-family: 'MedievalSharp', cursive;
            font-style: italic;
            padding: 1rem;
        }

        /* Mise à jour de la structure de la section de jeu */
        .game-sections {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .gameplay-panel {
            width: 100%;
            margin: 0 auto;
            max-width: 900px;
        }

        /* Ajustements pour l'écran de fin de jeu */
        .results-container {
            background: linear-gradient(135deg, rgba(23, 32, 57, 0.8), rgba(12, 17, 30, 0.9));
            border-radius: 10px;
            padding: 2rem;
            width: 100%;
            max-width: 700px;
            border: 2px solid rgba(59, 130, 246, 0.4);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.2), inset 0 0 15px rgba(59, 130, 246, 0.1);
            margin-top: 1.5rem;
        }

        /* Ajout d'un onglet pour basculer entre les scores récents et le leaderboard */
        .score-tabs {
            display: flex;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .score-tab {
            padding: 0.75rem 1.5rem;
            font-family: 'MedievalSharp', cursive;
            color: #93c5fd;
            cursor: pointer;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .score-tab.active {
            color: #3b82f6;
            border-bottom: 3px solid #3b82f6;
            font-weight: bold;
        }

        .score-tab:hover:not(.active) {
            color: #60a5fa;
            border-bottom: 3px solid rgba(59, 130, 246, 0.3);
        }

        .score-content {
            display: none;
            margin-top: 1rem;
        }

        .score-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Nouvelle barre de navigation inspirée de Word Bubbles */
        .game-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(180deg, rgba(12, 17, 30, 0.95) 0%, rgba(18, 27, 47, 0.9) 100%);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.5), 0 0 30px rgba(59, 130, 246, 0.2);
            z-index: 1000;
            padding: 0.5rem 0;
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .game-nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
        }

        .game-nav-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .game-nav-logo img {
            width: 40px;
            height: 40px;
            margin-right: 0.5rem;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }

        .game-nav-title {
            font-family: 'MedievalSharp', cursive;
            color: #3b82f6;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            margin: 0;
        }

        .game-nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .game-nav-link {
            color: #d1d5db;
            text-decoration: none;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-nav-link:hover, .game-nav-link.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .game-nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .game-nav-link:hover::after, .game-nav-link.active::after {
            width: 80%;
        }

        .game-nav-link.active {
            font-weight: 600;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }

        .game-nav-home-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .game-nav-home-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        /* Ajustement du contenu du jeu pour la barre de navigation fixe */
        .game-universe {
            padding-top: 60px; /* Espace pour la barre de navigation */
        }

        /* Styles responsives */
        @media (max-width: 600px) {
            .game-nav-title {
                font-size: 1rem;
            }

            .game-nav-links {
                gap: 0.2rem;
            }

            .game-nav-link {
                padding: 0.5rem 0.5rem;
                font-size: 0.8rem;
            }
        }

        /* Styles pour la nouvelle barre de navigation style Word Bubbles */
        .game-header {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
            position: relative;
            z-index: 10;
        }

        .header-content {
            width: 100%;
            max-width: 1200px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            height: 50px;
            width: auto;
            margin-right: 15px;
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.6));
        }

        .main-nav {
            display: flex;
            gap: 5px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #3b82f6;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .nav-link {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: #e5e7eb;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after,
        .nav-link.active::after {
            width: 80%;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .nav-icon {
            width: 18px;
            height: 18px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: brightness(0) invert(1);
            transition: all 0.3s ease;
        }

        .nav-link:hover .nav-icon,
        .nav-link.active .nav-icon {
            filter: brightness(0) saturate(100%) invert(50%) sepia(70%) saturate(5000%) hue-rotate(200deg) brightness(100%) contrast(101%);
        }

        .home-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" fill="currentColor"/></svg>');
        }

        .games-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21,6H3C1.9,6 1,6.9 1,8V16C1,17.1 1.9,18 3,18H21C22.1,18 23,17.1 23,16V8C23,6.9 22.1,6 21,6M11,13H8V16H6V13H3V11H6V8H8V11H11M15.5,15C14.67,15 14,14.33 14,13.5C14,12.67 14.67,12 15.5,12C16.33,12 17,12.67 17,13.5C17,14.33 16.33,15 15.5,15M19.5,12C18.67,12 18,11.33 18,10.5C18,9.67 18.67,9 19.5,9C20.33,9 21,9.67 21,10.5C21,11.33 20.33,12 19.5,12Z" fill="currentColor"/></svg>');
        }

        .courses-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z M11,7H13V9H11V7M11,11H13V17H11V11Z" fill="currentColor"/></svg>');
        }

        .leaderboard-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5,21H2V9H7.5M14,21H8.5V5H14M22,21H15V3H22V21Z" fill="currentColor"/></svg>');
        }

        .contact-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" fill="currentColor"/></svg>');
        }

        /* Adapter l'interface principal du jeu */
        .game-interface {
            margin-top: 0;
            padding-top: 20px;
        }

        /* Ajustements pour mobile */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .main-nav {
                overflow-x: auto;
                padding: 5px 10px;
                width: 100%;
                justify-content: center;
            }

            .nav-link {
                font-size: 0.9rem;
                padding: 6px 10px;
            }

            .logo {
                height: 40px;
            }
        }

        /* Styles pour le sous-titre du jeu */
        .game-header-content {
            text-align: center;
            width: 100%;
            margin-bottom: 2rem;
        }

        .game-subtitle {
            font-family: 'Cinzel', serif;
            color: #e5e7eb;
            font-size: 1.2rem;
            margin: 0;
            text-align: center;
            letter-spacing: 1px;
        }

        .magic-text {
            color: #3b82f6;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body class="game-body">
    <!-- En-tête et navigation exactement comme Word Bubbles -->
    <header class="game-header">
        <div class="header-content">
            <div class="logo-container">
                <img src="./images/logo.gif" alt="English Quest" class="logo">
                <h1 class="game-title">Speed Verb Challenge</h1>
            </div>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">
                    <span class="nav-icon home-icon"></span>
                    Accueil
                </a>
                <a href="all-games.html" class="nav-link active">
                    <span class="nav-icon games-icon"></span>
                    Jeux
                </a>
                <a href="courses.html" class="nav-link">
                    <span class="nav-icon courses-icon"></span>
                    Cours
                </a>
                <a href="leaderboard.html" class="nav-link">
                    <span class="nav-icon leaderboard-icon"></span>
                    Classement
                </a>
                <a href="contact.html" class="nav-link">
                    <span class="nav-icon contact-icon"></span>
                    Contact
                </a>
            </nav>
        </div>
    </header>

    <!-- Game container -->
    <div class="game-universe">
        <!-- Nouveaux éléments pour effets visuels -->
        <div class="magic-fog"></div>
        <div class="magic-particles" id="particles-js"></div>
        <div class="arcane-runes" id="arcane-runes"></div>
        <div class="enhanced-portal" id="enhanced-portal"></div>

        <!-- Fond 3D -->
        <div id="bg-scene"></div>

        <!-- Floating runes -->
        <div class="floating-runes"></div>

        <!-- Game UI -->
        <main class="game-interface">
            <!-- Game header - Sous-titre centré -->
            <div class="game-header-content">
                <p class="game-subtitle">Maîtrisez les sorts anciens du <span class="magic-text">Lexicon Arcanum</span></p>
            </div>

            <!-- Game sections -->
            <div class="game-sections">
                <!-- Game area -->
                <section class="game-panel gameplay-panel depth-card" style="width: 100%;">
                    <div class="panel-content">
                        <!-- Game state: start -->
                        <div id="game-start" class="game-state active">
                            <h2 class="panel-title">Préparez Vos Incantations</h2>

                            <div class="difficulty-selection">
                                <h3>Sélectionnez votre voie arcanique :</h3>
                                <div class="difficulty-options">
                                    <label class="difficulty-option">
                                        <input type="radio" name="difficulty" value="1" checked>
                                        <span class="option-content">
                                            <span class="option-title">Voie de l'Apprenti</span>
                                            <span class="option-description">Passé Simple uniquement</span>
                                            <span class="option-reward">1 point d'essence par sort</span>
                                            <span class="difficulty-rune">ᚠ</span>
                                        </span>
                                    </label>

                                    <label class="difficulty-option">
                                        <input type="radio" name="difficulty" value="2">
                                        <span class="option-content">
                                            <span class="option-title">Voie de l'Adepte</span>
                                            <span class="option-description">Participe Passé uniquement</span>
                                            <span class="option-reward">2 points d'essence par sort</span>
                                            <span class="difficulty-rune">ᚦ</span>
                                        </span>
                                    </label>

                                    <label class="difficulty-option">
                                        <input type="radio" name="difficulty" value="3">
                                        <span class="option-content">
                                            <span class="option-title">Voie du Maître</span>
                                            <span class="option-description">Les deux formes requises</span>
                                            <span class="option-reward">3 points d'essence par sort</span>
                                            <span class="difficulty-rune">ᛟ</span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <button id="start-game-btn" class="game-button primary-button glow-button">
                                <span class="button-glow"></span>
                                <span class="button-text">Débuter l'Épreuve</span>
                                <span class="button-runes">ᚱᚢᚾᛖᛋ</span>
                            </button>
                        </div>

                        <!-- Game state: playing -->
                        <div id="game-playing" class="game-state">
                            <!-- HUD -->
                            <div class="game-hud">
                                <div class="hud-item">
                                    <div class="hud-label">Niveau</div>
                                    <div id="player-level" class="hud-value">1</div>
                                </div>

                                <div class="hud-item">
                                    <div class="hud-label">Essence</div>
                                    <div id="player-score" class="hud-value">0</div>
                                </div>

                                <div class="hud-item">
                                    <div class="hud-label">Temps</div>
                                    <div id="time-left" class="hud-value">90</div>
                                </div>

                                <div class="hud-item">
                                    <div class="hud-label">Multiplicateur</div>
                                    <div id="combo-multiplier" class="hud-value">x1.0</div>
                                </div>

                                <!-- Nouveau compteur de secondes chances -->
                                <div id="second-chance-counter" class="hud-item special-hud-item" style="display: none;">
                                    <div class="hud-label">Secondes Chances</div>
                                    <div id="second-chance-count" class="hud-value">0</div>
                                </div>
                            </div>

                            <!-- XP Bar -->
                            <div class="xp-bar-container">
                                <div class="xp-bar-label">Énergie Arcanique</div>
                                <div class="xp-bar">
                                    <div id="xp-progress" class="xp-bar-fill"></div>
                                </div>
                            </div>

                            <!-- Verb challenge -->
                            <div class="verb-challenge">
                                <div class="verb-card">
                                    <div class="verb-info">
                                        <div class="verb-prompt">Lancez le sort de :</div>
                                        <div id="current-verb" class="verb-display floating-verb">begin</div>
                                        <div id="verb-translation" class="verb-translation">(commencer)</div>
                                    </div>

                                    <div id="verb-form-inputs" class="verb-inputs">
                                        <!-- Inputs will be generated based on difficulty -->
                                    </div>

                                    <!-- Verb actions -->
                                    <div class="verb-actions">
                                        <button id="check-answer-btn" class="game-button action-button glow-button">
                                            <span class="button-text">Lancer le Sort</span>
                                            <span class="action-icon">✦</span>
                                        </button>

                                        <button id="skip-verb-btn" class="game-button secondary-button glow-button">
                                            <span class="button-text">Bannir</span>
                                            <span class="action-icon">✧</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Feedback message -->
                            <div id="feedback-message" class="feedback-message"></div>
                        </div>

                        <!-- Game state: game over -->
                        <div id="game-over" class="game-state">
                            <h2 class="panel-title">Énergie Arcanique Épuisée</h2>

                            <div class="results-container">
                                <div class="final-score">
                                    <div class="score-label">Essence Collectée</div>
                                    <div id="final-score-value" class="score-value">0</div>
                                </div>

                                <div class="stats-container">
                                    <div class="stat-item">
                                        <div class="stat-label">Niveau Atteint</div>
                                        <div id="final-level" class="stat-value">1</div>
                                    </div>

                                    <div class="stat-item">
                                        <div class="stat-label">Sorts Lancés</div>
                                        <div id="verbs-completed" class="stat-value">0</div>
                                    </div>

                                    <div class="stat-item">
                                        <div class="stat-label">Meilleur Combo</div>
                                        <div id="highest-combo" class="stat-value">x1.0</div>
                                    </div>
                                </div>

                                <div class="name-entry">
                                    <label for="player-name">Inscrivez votre nom dans les Annales Arcaniques :</label>
                                    <input type="text" id="player-name" class="name-input" maxlength="15" placeholder="Votre nom">
                                </div>

                                <div class="game-over-actions">
                                    <button id="save-score-btn" class="game-button primary-button glow-button">
                                        <span class="button-glow"></span>
                                        <span class="button-text">Inscrire mon score</span>
                                    </button>

                                    <button id="play-again-btn" class="game-button secondary-button glow-button">
                                        <span class="button-text">Nouveau Rituel</span>
                                    </button>
                                </div>

                                <!-- Onglets pour les scores récents et le leaderboard -->
                                <div class="score-tabs">
                                    <button class="score-tab active" data-tab="recent">Mes scores récents</button>
                                    <button class="score-tab" data-tab="leaderboard">Légendes Arcaniques</button>
                                </div>

                                <!-- Contenu des onglets -->
                                <div id="recent-scores-content" class="score-content active">
                                    <ul id="recent-scores-list" class="recent-scores-list">
                                        <li class="loading-recent-scores">Chargement de vos scores récents...</li>
                                    </ul>
                                </div>

                                <div id="leaderboard-content" class="score-content">
                                    <div class="leaderboard-scroll">
                                        <table class="leaderboard-table">
                                            <thead>
                                                <tr>
                                                    <th>Rang</th>
                                                    <th>Lanceur de sorts</th>
                                                    <th>Essence</th>
                                                    <th>Date</th>
                                                </tr>
                                            </thead>
                                            <tbody id="leaderboard-body">
                                                <!-- Leaderboard entries will be loaded here -->
                                                <tr class="loading-row">
                                                    <td colspan="4"><span class="loading-text">Invocation des archives ancestrales<span class="loading-dots">...</span></span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- 3D Floating Objects -->
        <div id="floating-objects-container"></div>

        <!-- Achievement notifications -->
        <div id="achievements-container"></div>

        <!-- Particle effects container -->
        <div id="particles-container"></div>

        <!-- Magic portal effect -->
        <div id="magic-portal"></div>
    </div>

    <!-- SCRIPTS CORRIGÉS - CHARGEMENT UNIQUE -->
    <!-- Firebase depuis CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Scripts du jeu dans le bon ordre -->
    <script src="./src/js/firebase-polyfill.js"></script>
    <script src="./src/js/firebase-init.js"></script>
    <script src="./src/js/verb-data.js"></script>
    <script src="./src/js/game-effects.js"></script>
    <script src="./src/js/speed-verb-leaderboard.js"></script>
    <script src="./src/js/speed-verb-challenge.js"></script>

    <!-- Scripts additionnels -->
    <script src="./src/js/consolidated-fix.js"></script>
    <script src="visit-counter.js"></script>

    <!-- Nouveau script pour les effets visuels améliorés -->
    <script>
        // Créer les runes flottantes
        function createFloatingRunes() {
            const runeContainer = document.getElementById('arcane-runes');
            const runes = ['ᚠ', 'ᚢ', 'ᚦ', 'ᚨ', 'ᚱ', 'ᚲ', 'ᚷ', 'ᚹ', 'ᚺ', 'ᚾ', 'ᛁ', 'ᛃ', 'ᛇ', 'ᛈ', 'ᛉ', 'ᛊ', 'ᛏ', 'ᛒ', 'ᛖ', 'ᛗ', 'ᛚ', 'ᛜ', 'ᛞ', 'ᛟ'];

            for (let i = 0; i < 20; i++) {
                const rune = document.createElement('div');
                rune.className = 'rune';
                rune.textContent = runes[Math.floor(Math.random() * runes.length)];
                rune.style.left = `${Math.random() * 100}%`;
                rune.style.fontSize = `${Math.random() * 2 + 1}rem`;
                rune.style.animationDelay = `${Math.random() * 15}s`;
                rune.style.animationDuration = `${Math.random() * 10 + 15}s`;
                runeContainer.appendChild(rune);
            }
        }

        // Initialiser les particules
        function initParticles() {
            particlesJS('particles-js', {
                "particles": {
                    "number": {
                        "value": 80,
                        "density": {
                            "enable": true,
                            "value_area": 800
                        }
                    },
                    "color": {
                        "value": "#3b82f6"
                    },
                    "shape": {
                        "type": "circle",
                        "stroke": {
                            "width": 0,
                            "color": "#000000"
                        },
                        "polygon": {
                            "nb_sides": 5
                        }
                    },
                    "opacity": {
                        "value": 0.5,
                        "random": true,
                        "anim": {
                            "enable": true,
                            "speed": 1,
                            "opacity_min": 0.1,
                            "sync": false
                        }
                    },
                    "size": {
                        "value": 3,
                        "random": true,
                        "anim": {
                            "enable": true,
                            "speed": 2,
                            "size_min": 0.1,
                            "sync": false
                        }
                    },
                    "line_linked": {
                        "enable": true,
                        "distance": 150,
                        "color": "#3b82f6",
                        "opacity": 0.2,
                        "width": 1
                    },
                    "move": {
                        "enable": true,
                        "speed": 1,
                        "direction": "none",
                        "random": true,
                        "straight": false,
                        "out_mode": "out",
                        "bounce": false,
                        "attract": {
                            "enable": true,
                            "rotateX": 600,
                            "rotateY": 1200
                        }
                    }
                },
                "interactivity": {
                    "detect_on": "canvas",
                    "events": {
                        "onhover": {
                            "enable": true,
                            "mode": "grab"
                        },
                        "onclick": {
                            "enable": true,
                            "mode": "push"
                        },
                        "resize": true
                    },
                    "modes": {
                        "grab": {
                            "distance": 140,
                            "line_linked": {
                                "opacity": 0.5
                            }
                        },
                        "bubble": {
                            "distance": 400,
                            "size": 40,
                            "duration": 2,
                            "opacity": 8,
                            "speed": 3
                        },
                        "repulse": {
                            "distance": 200,
                            "duration": 0.4
                        },
                        "push": {
                            "particles_nb": 4
                        },
                        "remove": {
                            "particles_nb": 2
                        }
                    }
                },
                "retina_detect": true
            });
        }

        // Ajouter des effets 3D aux cartes
        function enhance3DCards() {
            const cards = document.querySelectorAll('.depth-card');

            // Désactivation de l'effet de mouvement au survol de la souris
            // Les cartes restent statiques pour une meilleure expérience utilisateur
            cards.forEach(card => {
                // Suppression des écouteurs d'événements qui causent le mouvement
                card.removeEventListener('mousemove', null);
                card.removeEventListener('mouseleave', null);

                // Réinitialisation de la transformation pour s'assurer qu'il n'y a pas d'effet résiduel
                card.style.transform = 'none';
            });
        }

        // Initialiser les effets visuels améliorés
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingRunes();
            initParticles();
            enhance3DCards();

            // Ajouter des écouteurs d'événements pour les effets spéciaux
            const startButton = document.getElementById('start-game-btn');
            const portal = document.getElementById('enhanced-portal');

            if (startButton && portal) {
                startButton.addEventListener('click', function() {
                    portal.classList.add('active');
                    setTimeout(() => {
                        portal.classList.remove('active');
                    }, 2000);
                });
            }
        });
    </script>

    <!-- Script pour les effets améliorés -->
    <script src="src/js/enhanced-effects.js"></script>

    <!-- Script pour améliorer le défilement sur mobile -->
    <script>
        // Améliorer le défilement sur mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Gérer le focus des inputs sur mobile
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    // Faire défiler la page pour s'assurer que l'input est visible
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });

                // Ajouter un padding supplémentaire pour les inputs sur mobile
                if (window.innerWidth <= 768) {
                    input.style.fontSize = '16px'; // Empêcher le zoom automatique sur iOS
                }
            });

            // Empêcher le zoom sur double-tap pour les boutons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    // Simuler un clic après un court délai pour éviter les problèmes de double-tap
                    setTimeout(() => {
                        this.click();
                    }, 10);
                }, { passive: false });
            });

            // Améliorer le défilement des panneaux de jeu
            const gamePanel = document.querySelector('.game-panel');
            if (gamePanel && window.innerWidth <= 768) {
                gamePanel.style.overflowY = 'auto';
                gamePanel.style.webkitOverflowScrolling = 'touch'; // Défilement fluide sur iOS
            }

            // Ajuster la hauteur de la vue sur mobile pour éviter les problèmes avec la barre d'adresse
            function adjustViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            // Appeler la fonction au chargement et au redimensionnement
            adjustViewportHeight();
            window.addEventListener('resize', adjustViewportHeight);

            // Afficher la modale des règles après un court délai pour s'assurer que tout est chargé
            setTimeout(function() {
                const rulesModal = document.getElementById('rulesModal');
                if (rulesModal) {
                    console.log("Affichage automatique de la modale des règles");
                    rulesModal.classList.add('show');
                    rulesModal.style.display = 'flex';
                    rulesModal.style.opacity = '1';
                    rulesModal.style.visibility = 'visible';
                    rulesModal.style.zIndex = '9999';
                } else {
                    console.error("La modale des règles n'a pas été trouvée");
                }
            }, 800);
        });
    </script>

    <!-- Modale des règles du jeu -->
    <div class="modal rules-modal" id="rulesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Règles du jeu</h2>
                <button class="modal-close" onclick="document.getElementById('rulesModal').classList.remove('show'); document.getElementById('rulesModal').style.opacity = '0'; document.getElementById('rulesModal').style.visibility = 'hidden'; setTimeout(() => { document.getElementById('rulesModal').style.display = 'none'; }, 500);">&times;</button>
            </div>
            <div class="modal-body">
                <p><span class="drop-cap">B</span>rave lanceur de sorts, vous vous tenez devant l'<span class="highlight-text">Épreuve des Verbes</span>, un défi ancestral qui a mis à l'épreuve les plus dignes linguistes arcanes depuis des éons.</p>

                <h3>Votre Mission</h3>
                <p>Conjuguez correctement les sorts de verbes qui apparaissent depuis le portail arcanique. Chaque incantation correcte renforce vos pouvoirs magiques et vous rapporte des points d'essence.</p>

                <h3>Les Règles</h3>
                <ul class="rules-list">
                    <li class="rule-item">
                        <span class="rule-icon animated-icon">⏳</span>
                        <div class="rule-content">
                            <h4 class="rule-title">Temps Limité</h4>
                            <p>Votre magie ne dure que <span class="highlight-text">90 secondes</span>. Utilisez-les sagement.</p>
                        </div>
                    </li>

                    <li class="rule-item">
                        <span class="rule-icon animated-icon">🎯</span>
                        <div class="rule-content">
                            <h4 class="rule-title">Voies Arcaniques</h4>
                            <p>Choisissez une des voies suivantes:</p>
                            <ul class="sub-rules">
                                <li>
                                    <span class="path-text">Voie de l'Apprenti ⚔️</span>
                                    <span class="path-description">Conjuration du Passé Simple uniquement</span>
                                    <span class="path-reward">(1 point d'essence)</span>
                                </li>
                                <li>
                                    <span class="path-text">Voie de l'Adepte ⚔️⚔️</span>
                                    <span class="path-description">Invocation du Participe Passé uniquement</span>
                                    <span class="path-reward">(2 points d'essence)</span>
                                </li>
                                <li>
                                    <span class="path-text">Voie du Maître ⚔️⚔️⚔️</span>
                                    <span class="path-description">Enchantement complet du verbe - les deux formes</span>
                                    <span class="path-reward">(3 points d'essence)</span>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="rule-item">
                        <span class="rule-icon animated-icon">🔄</span>
                        <div class="rule-content">
                            <h4 class="rule-title">Bannissement</h4>
                            <p>Vous pouvez bannir les sorts difficiles, mais <span class="warning-text">aucune essence n'est récoltée</span> pour ces sorts.</p>
                        </div>
                    </li>
                </ul>

                <h3>Comment jouer</h3>
                <ul>
                    <li>Un verbe à l'infinitif s'affiche au centre</li>
                    <li>Entrez les formes du <strong>prétérit</strong> et du <strong>participe passé</strong></li>
                    <li>Utilisez TAB pour passer d'un champ à l'autre</li>
                    <li>Validez avec ENTRÉE pour passer au verbe suivant</li>
                </ul>

                <h3>Récompenses</h3>
                <p>Enchaînez les sorts corrects pour construire des <span class="highlight-text">combos arcaniques</span> ! Chaque incantation correcte consécutive amplifie votre multiplicateur d'essence.</p>
                <p>Montez en niveau pour prolonger votre temps et débloquer des <span class="highlight-text">capacités spéciales</span> !</p>

                <div class="special-powers">
                    <div class="power-item">
                        <div class="power-icon">🔮</div>
                        <div class="power-name">Dilatation Temporelle</div>
                        <div class="power-desc">Niveau 2 : +10 secondes</div>
                    </div>
                    <div class="power-item">
                        <div class="power-icon">✨</div>
                        <div class="power-name">Amplificateur d'Essence</div>
                        <div class="power-desc">Niveau 3 : +0.2 au multiplicateur <span class="cumulative-bonus">(+10 secondes)</span></div>
                    </div>
                    <div class="power-item">
                        <div class="power-icon">🌟</div>
                        <div class="power-name">Récupération de Sort</div>
                        <div class="power-desc">Niveau 5 : seconde chance <span class="cumulative-bonus">(+0.2 au multiplicateur, +10 secondes)</span></div>
                    </div>
                    <div class="power-item">
                        <div class="power-icon">⚡</div>
                        <div class="power-name">Maîtrise Arcanique</div>
                        <div class="power-desc">Niveau 7 : +0.3 au multiplicateur <span class="cumulative-bonus">(+seconde chance, +0.2 au multiplicateur, +10 secondes)</span></div>
                    </div>
                    <div class="power-item">
                        <div class="power-icon">🕰️</div>
                        <div class="power-name">Distorsion Temporelle</div>
                        <div class="power-desc">Niveau 10 : +15 secondes <span class="cumulative-bonus">(+tous les bonus précédents)</span></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="mmorpg-button modal-close-btn" onclick="document.getElementById('rulesModal').classList.remove('show'); document.getElementById('rulesModal').style.opacity = '0'; document.getElementById('rulesModal').style.visibility = 'hidden'; setTimeout(() => { document.getElementById('rulesModal').style.display = 'none'; }, 500);">J'ai compris</button>
            </div>
        </div>
    </div>

    <!-- Bouton d'aide flottant -->
    <button id="help-button" class="help-button" onclick="const rulesModal = document.getElementById('rulesModal'); rulesModal.classList.add('show'); rulesModal.style.display = 'flex'; rulesModal.style.opacity = '1'; rulesModal.style.visibility = 'visible'; rulesModal.style.zIndex = '9999';">
        <span class="help-icon">?</span>
    </button>

    <!-- Script final pour garantir l'affichage de la modale -->
    <script>
        // Afficher la modale des règles avec un délai pour s'assurer que tout est bien chargé
        window.onload = function() {
            setTimeout(function() {
                const rulesModal = document.getElementById('rulesModal');
                if (rulesModal) {
                    console.log("Affichage de la modale des règles depuis window.onload");
                    rulesModal.classList.add('show');
                    rulesModal.style.display = 'flex';
                    rulesModal.style.opacity = '1';
                    rulesModal.style.visibility = 'visible';
                    rulesModal.style.zIndex = '9999';
                }
            }, 1000);

            // Gestion des onglets de scores
            document.querySelectorAll('.score-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Retirer la classe active de tous les onglets
                    document.querySelectorAll('.score-tab').forEach(t => t.classList.remove('active'));
                    // Ajouter la classe active à l'onglet cliqué
                    this.classList.add('active');

                    // Cacher tous les contenus d'onglet
                    document.querySelectorAll('.score-content').forEach(content => content.classList.remove('active'));
                    // Afficher le contenu correspondant à l'onglet
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-scores-content').classList.add('active');

                    // Si l'onglet leaderboard est activé, forcer le rechargement du tableau des scores
                    if (tabId === 'leaderboard' && typeof loadTopScores === 'function') {
                        loadTopScores();
                    }
                });
            });

            // Observer les changements d'affichage de l'écran de fin de jeu
            const gameOverObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'class') {
                        const gameOver = document.getElementById('game-over');
                        if (gameOver && gameOver.classList.contains('active')) {
                            console.log("Fin de jeu detectée, chargement des scores...");
                            // Charger les scores récents et les top scores quand le game over est affiché
                            if (typeof loadTopScores === 'function') {
                                setTimeout(function() {
                                    loadTopScores();
                                    console.log("Top scores chargés");
                                }, 500);
                            } else {
                                console.error("La fonction loadTopScores n'est pas définie");
                            }
                        }
                    }
                });
            });

            const gameOver = document.getElementById('game-over');
            if (gameOver) {
                gameOverObserver.observe(gameOver, { attributes: true });
            }
        };
    </script>

    <!-- Ajout d'un script de secours pour le chargement des top scores -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Définir la fonction de chargement des top scores si elle n'existe pas déjà
            if (typeof window.loadTopScores !== 'function') {
                window.loadTopScores = function() {
                    console.log("Chargement des meilleurs scores...");
                    const leaderboardBody = document.getElementById('leaderboard-body');

                    if (!leaderboardBody) {
                        console.error("Le tableau des scores n'a pas été trouvé");
                        return;
                    }

                    // Afficher un message de chargement
                    leaderboardBody.innerHTML = '<tr class="loading-row"><td colspan="4"><span class="loading-text">Invocation des archives ancestrales<span class="loading-dots">...</span></span></td></tr>';

                    // Vérifier si Firebase est disponible
                    if (typeof firebase !== 'undefined' && firebase.firestore) {
                        const db = firebase.firestore();

                        db.collection("speed-verb-scores")
                            .orderBy("score", "desc")
                            .limit(10)
                            .get()
                            .then((querySnapshot) => {
                                if (querySnapshot.empty) {
                                    leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Aucun score trouvé. Soyez le premier à inscrire votre nom !</td></tr>';
                                    return;
                                }

                                let html = '';
                                let rank = 1;

                                querySnapshot.forEach((doc) => {
                                    const data = doc.data();
                                    const date = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleDateString() : 'Date inconnue';

                                    html += `
                                    <tr>
                                        <td class="rank-cell">${rank}</td>
                                        <td class="player-cell">${data.name || 'Anonyme'}</td>
                                        <td class="score-cell">${data.score}</td>
                                        <td class="date-cell">${date}</td>
                                    </tr>
                                    `;
                                    rank++;
                                });

                                leaderboardBody.innerHTML = html;
                            })
                            .catch((error) => {
                                console.error("Erreur lors du chargement des scores: ", error);
                                leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Erreur lors du chargement des scores.</td></tr>';
                            });
                    } else {
                        console.error("Firebase n'est pas disponible");
                        leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Service de scores indisponible.</td></tr>';
                    }
                };
            }

            // Surveiller l'état du jeu
            const checkGameOver = setInterval(function() {
                const gameOver = document.getElementById('game-over');
                if (gameOver && window.getComputedStyle(gameOver).display !== 'none') {
                    console.log("Fin de jeu détectée (interval)");
                    if (typeof loadTopScores === 'function') {
                        loadTopScores();
                    }
                    clearInterval(checkGameOver);
                }
            }, 2000);
        });
    </script>

    <!-- Nouveau système de notation simplifié -->
    <script src="scripts/simple-rating-system.js" defer></script>
    <script src="scripts/update-rating-system.js" defer></script>
</body>
</html>