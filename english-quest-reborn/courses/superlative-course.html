<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Le Superlatif - English Quest</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RMCQTMKDVP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RMCQTMKDVP');
  </script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="../styles/new-design.css">
  <link rel="stylesheet" href="../styles/animations.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <!-- Script pour le menu mobile -->
  <script src="../scripts/new-design.js"></script>
  
  <style>
    /* Styles spécifiques au cours superlatif */
    .course-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: var(--spacing-lg);
    }
    
    .course-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-xl);
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
      border-radius: var(--border-radius-lg);
      border: 1px solid rgba(46, 204, 113, 0.2);
    }
    
    .course-title {
      font-size: 3rem;
      font-family: var(--font-family-secondary);
      background: linear-gradient(135deg, var(--color-primary), var(--color-info));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--spacing-md);
    }
    
    .course-subtitle {
      font-size: 1.2rem;
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-lg);
    }
    
    .course-meta {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      flex-wrap: wrap;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--color-text-secondary);
    }
    
    .meta-item i {
      color: var(--color-primary);
    }
    
    /* Système de progression par étapes */
    .game-progress-bar {
      background: var(--color-surface);
      border-radius: var(--border-radius-lg);
      height: 20px;
      margin: var(--spacing-lg) 0;
      overflow: hidden;
      position: relative;
      border: 2px solid rgba(46, 204, 113, 0.3);
    }
    
    .game-progress-fill {
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      height: 100%;
      width: 0%;
      transition: width 0.8s ease;
      position: relative;
    }
    
    .game-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s infinite;
    }
    
    .game-progress-text {
      text-align: center;
      margin-top: var(--spacing-sm);
      font-weight: bold;
      color: var(--color-primary);
    }
    
    .course-section {
      background: var(--color-surface);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }
    
    /* États des sections */
    .course-section.locked {
      opacity: 0.5;
      pointer-events: none;
      background: var(--color-surface-hover);
      border-color: rgba(149, 165, 166, 0.3);
    }
    
    .course-section.current {
      border-color: rgba(46, 204, 113, 0.5);
      box-shadow: 0 8px 32px rgba(46, 204, 113, 0.2);
      animation: currentSectionGlow 2s infinite alternate;
    }
    
    .course-section.completed {
      border-color: rgba(46, 204, 113, 0.7);
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
    }
    
    @keyframes currentSectionGlow {
      0% { box-shadow: 0 8px 32px rgba(46, 204, 113, 0.2); }
      100% { box-shadow: 0 12px 40px rgba(46, 204, 113, 0.4); }
    }
    
    .course-section:hover:not(.locked) {
      border-color: rgba(46, 204, 113, 0.3);
      box-shadow: 0 8px 32px rgba(46, 204, 113, 0.1);
    }
    
    .section-title {
      font-size: 1.8rem;
      color: var(--color-primary);
      margin-bottom: var(--spacing-lg);
      font-family: var(--font-family-secondary);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }
    
    .section-number {
      background: var(--color-primary);
      color: var(--color-background);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      position: relative;
      transition: all var(--transition-fast);
    }
    
    .section-number.locked {
      background: #95a5a6;
      color: #7f8c8d;
    }
    
    .section-number.completed {
      background: var(--color-primary);
      color: white;
    }
    
    .section-number.completed::after {
      content: "✓";
      position: absolute;
      font-size: 1.5rem;
      color: white;
      font-weight: bold;
    }
    
    .lock-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      border-radius: var(--border-radius-lg);
    }
    
    .lock-overlay i {
      font-size: 3rem;
      color: #95a5a6;
      margin-bottom: var(--spacing-md);
    }
    
    .lock-overlay p {
      color: #95a5a6;
      text-align: center;
      margin: 0;
    }
    
    /* Boîtes d'information */
    .note-box {
      background: rgba(52, 152, 219, 0.1);
      border-left: 4px solid var(--color-info);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
    }
    
    .structure-box {
      background: rgba(142, 68, 173, 0.1);
      border: 2px solid var(--color-secondary);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--border-radius-md);
      font-family: 'Courier New', monospace;
      font-weight: bold;
    }
    
    .example-box {
      background: rgba(46, 204, 113, 0.1);
      border: 2px solid var(--color-primary);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--border-radius-md);
    }
    
    .warning-box {
      background: rgba(231, 76, 60, 0.1);
      border: 2px solid var(--color-danger);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--border-radius-md);
    }
    
    /* Types de superlatifs */
    .superlative-type {
      background: var(--color-surface-hover);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border: 1px solid rgba(46, 204, 113, 0.2);
    }
    
    .superlative-title {
      color: var(--color-primary);
      font-size: 1.3rem;
      margin-bottom: var(--spacing-md);
      font-family: var(--font-family-secondary);
    }
    
    /* Boutons de section */
    .section-complete-btn {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--border-radius-md);
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin: var(--spacing-xl) auto 0;
    }
    
    .section-complete-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
    }
    
    .section-complete-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* Quiz de validation */
    .section-validation-quiz {
      display: none;
      background: var(--color-surface-hover);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin-top: var(--spacing-xl);
      border: 2px solid rgba(46, 204, 113, 0.3);
    }
    
    .validation-quiz-title {
      color: var(--color-primary);
      font-size: 1.4rem;
      margin-bottom: var(--spacing-lg);
      text-align: center;
      font-family: var(--font-family-secondary);
    }
    
    .validation-question {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--color-surface);
      border-radius: var(--border-radius-md);
    }
    
    .validation-question-text {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: var(--spacing-md);
      color: var(--color-primary);
    }
    
    .validation-options {
      display: grid;
      gap: var(--spacing-sm);
    }
    
    .validation-option {
      background: var(--color-surface-hover);
      border: 2px solid transparent;
      border-radius: var(--border-radius-md);
      padding: var(--spacing-md);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .validation-option:hover {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.1);
    }
    
    .validation-option.selected {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.2);
    }
    
    .validation-option.correct {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.3);
    }
    
    .validation-option.incorrect {
      border-color: var(--color-danger);
      background: rgba(231, 76, 60, 0.2);
    }
    
    .validation-feedback {
      margin-top: var(--spacing-sm);
      font-style: italic;
      min-height: 20px;
    }
    
    .validation-controls {
      text-align: center;
      margin-top: var(--spacing-lg);
    }
    
    .validation-btn {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--border-radius-md);
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-fast);
      margin: 0 var(--spacing-sm);
    }
    
    .validation-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
    }
    
    .validation-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .validation-btn.success {
      background: linear-gradient(135deg, var(--color-primary), #27ae60);
    }
    
    .validation-score {
      text-align: center;
      margin-top: var(--spacing-lg);
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    /* Quiz styles */
    .quiz-options {
      display: grid;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }
    
    .quiz-option {
      background: var(--color-surface);
      border: 2px solid transparent;
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-size: 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .quiz-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(46, 204, 113, 0.1), transparent);
      transition: left 0.5s ease;
    }
    
    .quiz-option:hover {
      border-color: var(--color-primary);
      background: var(--color-surface-hover);
      transform: translateX(5px);
    }
    
    .quiz-option:hover::before {
      left: 100%;
    }
    
    .quiz-option.selected {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.2);
    }
    
    .quiz-option.correct {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.3);
      animation: correctAnswer 0.5s ease;
    }
    
    .quiz-option.incorrect {
      border-color: var(--color-danger);
      background: rgba(231, 76, 60, 0.2);
      animation: incorrectAnswer 0.5s ease;
    }
    
    @keyframes correctAnswer {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes incorrectAnswer {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
      100% { transform: translateX(0); }
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--spacing-lg);
      gap: var(--spacing-md);
    }
    
    .quiz-nav-btn {
      background: var(--color-surface);
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-weight: 600;
    }
    
    .quiz-nav-btn:hover:not(:disabled) {
      background: var(--color-primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
    }
    
    .quiz-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .quiz-nav-btn.primary {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: white;
      border-color: var(--color-primary);
    }
    
    .quiz-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
    }
    
    .quiz-header h3 {
      color: var(--color-primary);
      font-family: var(--font-family-secondary);
      margin-bottom: var(--spacing-lg);
    }
    
    .quiz-progress {
      margin: var(--spacing-lg) 0;
    }
    
    .quiz-progress-bar {
      background: var(--color-surface);
      border-radius: var(--border-radius-lg);
      height: 12px;
      overflow: hidden;
      border: 2px solid rgba(46, 204, 113, 0.3);
    }
    
    .quiz-progress-fill {
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      position: relative;
    }
    
    .quiz-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s infinite;
    }
    
    .quiz-question {
      background: var(--color-surface-hover);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin: var(--spacing-lg) 0;
      border: 1px solid rgba(46, 204, 113, 0.2);
    }
    
    .quiz-question-text {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--color-primary);
      margin-bottom: var(--spacing-lg);
      text-align: center;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .course-container {
        padding: var(--spacing-md);
      }
      
      .course-title {
        font-size: 2.2rem;
      }
      
      .section-title {
        font-size: 1.5rem;
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
      }
      
      .course-meta {
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .validation-options {
        gap: var(--spacing-xs);
      }
      
      .validation-option {
        padding: var(--spacing-sm);
        font-size: 0.9rem;
      }
    }
    
    /* Styles spéciaux pour le Quiz Final */
    .final-quiz-section {
      background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1)) !important;
      border: 2px solid rgba(155, 89, 182, 0.5) !important;
      position: relative !important;
      border-radius: var(--border-radius-lg) !important;
      padding: var(--spacing-xl) !important;
      margin-top: var(--spacing-xl) !important;
    }
    
    .superlative-type.final-quiz-section::before {
      content: '' !important;
      position: absolute !important;
      top: -2px !important;
      left: -2px !important;
      right: -2px !important;
      bottom: -2px !important;
      background: linear-gradient(45deg, #9b59b6, #e74c3c, #f39c12, #2ecc71, #3498db, #9b59b6) !important;
      background-size: 300% 300% !important;
      border-radius: var(--border-radius-lg) !important;
      z-index: -1 !important;
      animation: finalQuizBorder 3s linear infinite !important;
      display: block !important;
      opacity: 1 !important;
    }
    
    @keyframes finalQuizBorder {
      0% { background-position: 0% 50% !important; }
      100% { background-position: 100% 50% !important; }
    }

    .final-quiz-title {
      font-size: 2rem;
      text-align: center;
      background: linear-gradient(135deg, #9b59b6, #e74c3c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--spacing-lg);
      font-family: var(--font-family-secondary);
    }
    
    .quiz-info-final {
      background: rgba(155, 89, 182, 0.2);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
      text-align: center;
      border: 1px solid rgba(155, 89, 182, 0.4);
    }
    
    .quiz-info-final h4 {
      color: #9b59b6;
      margin-bottom: var(--spacing-md);
      font-size: 1.3rem;
    }
    
    .quiz-info-final p {
      margin: var(--spacing-sm) 0;
      color: var(--color-text-secondary);
    }
    
    .final-quiz-requirements {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
    }
    
    .final-quiz-requirements h5 {
      color: #e74c3c;
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .quiz-final-container {
      background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
      border: 2px solid rgba(155, 89, 182, 0.4);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin-top: var(--spacing-xl);
      position: relative;
      overflow: hidden;
    }
    
    .quiz-final-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(155, 89, 182, 0.1), transparent);
      animation: finalQuizShine 3s infinite;
      z-index: 1;
    }
    
    @keyframes finalQuizShine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .quiz-final-container > * {
      position: relative;
      z-index: 2;
    }
    
    .final-quiz-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: rgba(155, 89, 182, 0.1);
      border-radius: var(--border-radius-md);
      border: 1px solid rgba(155, 89, 182, 0.3);
    }
    
    .final-quiz-subtitle {
      color: var(--color-text-secondary);
      font-size: 1rem;
      margin: 0;
    }
    
    .final-progress-container {
      margin: var(--spacing-lg) 0;
      position: relative;
    }
    
    .final-progress-bar {
      background: var(--color-surface);
      border-radius: var(--border-radius-lg);
      height: 16px;
      overflow: hidden;
      border: 2px solid rgba(155, 89, 182, 0.3);
      position: relative;
    }
    
    .final-progress-fill {
      background: linear-gradient(90deg, #9b59b6, #e74c3c, #9b59b6);
      background-size: 200% 100%;
      height: 100%;
      width: 0%;
      transition: width 0.8s ease;
      position: relative;
      animation: finalProgressGradient 2s infinite;
    }
    
    @keyframes finalProgressGradient {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 0%; }
      100% { background-position: 0% 0%; }
    }
    
    .final-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: finalProgressShine 1.5s infinite;
    }
    
    @keyframes finalProgressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .final-progress-text {
      text-align: center;
      margin-top: var(--spacing-sm);
      font-weight: bold;
      color: #9b59b6;
      font-size: 1.1rem;
    }
    
    .final-question-container {
      background: var(--color-surface-hover);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin: var(--spacing-lg) 0;
      border: 2px solid rgba(155, 89, 182, 0.2);
      position: relative;
      transition: all var(--transition-normal);
    }
    
    .final-question-container:hover {
      border-color: rgba(155, 89, 182, 0.4);
      box-shadow: 0 8px 32px rgba(155, 89, 182, 0.2);
    }
    
    .final-question-text {
      font-size: 1.3rem;
      font-weight: bold;
      color: #9b59b6;
      margin-bottom: var(--spacing-lg);
      text-align: center;
      line-height: 1.4;
    }
    
    .final-quiz-options {
      display: grid;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }
    
    .final-quiz-option {
      background: var(--color-surface);
      border: 2px solid transparent;
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-size: 1.1rem;
      position: relative;
      overflow: hidden;
      min-height: 60px;
      display: flex;
      align-items: center;
    }
    
    .final-quiz-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(155, 89, 182, 0.15), transparent);
      transition: left 0.6s ease;
    }
    
    .final-quiz-option:hover {
      border-color: #9b59b6;
      background: var(--color-surface-hover);
      transform: translateX(8px);
      box-shadow: 0 4px 16px rgba(155, 89, 182, 0.2);
    }
    
    .final-quiz-option:hover::before {
      left: 100%;
    }
    
    .final-quiz-option.selected {
      border-color: #9b59b6;
      background: rgba(155, 89, 182, 0.2);
      transform: translateX(5px);
      box-shadow: 0 4px 16px rgba(155, 89, 182, 0.3);
    }
    
    .final-quiz-option.correct {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.3);
      animation: finalCorrectAnswer 0.8s ease;
    }
    
    .final-quiz-option.incorrect {
      border-color: var(--color-danger);
      background: rgba(231, 76, 60, 0.2);
      animation: finalIncorrectAnswer 0.6s ease;
    }
    
    @keyframes finalCorrectAnswer {
      0% { transform: scale(1); }
      30% { transform: scale(1.08); }
      60% { transform: scale(0.98); }
      100% { transform: scale(1); }
    }
    
    @keyframes finalIncorrectAnswer {
      0% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }
    
    .final-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--spacing-xl);
      gap: var(--spacing-md);
      flex-wrap: wrap;
    }
    
    .final-nav-btn {
      background: var(--color-surface);
      border: 2px solid #9b59b6;
      color: #9b59b6;
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-weight: 600;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .final-nav-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(155, 89, 182, 0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .final-nav-btn:hover:not(:disabled) {
      background: #9b59b6;
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
    }
    
    .final-nav-btn:hover:not(:disabled)::before {
      left: 100%;
    }
    
    .final-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .final-nav-btn.primary {
      background: linear-gradient(135deg, #9b59b6, #e74c3c);
      color: white;
      border-color: #9b59b6;
      font-weight: bold;
      animation: finalButtonPulse 2s infinite;
    }
    
    @keyframes finalButtonPulse {
      0% { box-shadow: 0 4px 16px rgba(155, 89, 182, 0.3); }
      50% { box-shadow: 0 8px 32px rgba(155, 89, 182, 0.5); }
      100% { box-shadow: 0 4px 16px rgba(155, 89, 182, 0.3); }
    }
    
    .final-nav-btn.primary:hover {
      background: linear-gradient(135deg, #8e44ad, #c0392b);
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(155, 89, 182, 0.6);
    }
    
    /* Résultats finaux avec célébration */
    .final-celebration {
      position: relative;
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
      border-radius: var(--border-radius-lg);
      padding: 3rem;
      margin: 2rem 0;
      text-align: center;
      overflow: hidden;
      animation: finalCelebration 3s ease-in-out;
    }
    
    @keyframes finalCelebration {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .final-celebration::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: finalCelebrationShine 4s infinite;
    }
    
    @keyframes finalCelebrationShine {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .final-celebration-content {
      position: relative;
      z-index: 2;
    }
    
    .final-celebration h2 {
      font-size: 2.8rem;
      margin-bottom: 1rem;
      animation: finalTitleBounce 1s ease-out 0.5s both;
    }
    
    @keyframes finalTitleBounce {
      0% { transform: translateY(-100px); opacity: 0; }
      60% { transform: translateY(10px); }
      100% { transform: translateY(0); opacity: 1; }
    }
    
    .final-score-display {
      font-size: 2rem;
      font-weight: bold;
      margin: 1.5rem 0;
      animation: finalScoreCountUp 2s ease-out 1s both;
    }
    
    @keyframes finalScoreCountUp {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    .final-certification-badge {
      background: rgba(255,255,255,0.2);
      border-radius: var(--border-radius-md);
      padding: 1.5rem;
      margin-top: 2rem;
      border: 2px solid rgba(255,255,255,0.3);
      animation: finalBadgeSlideIn 1s ease-out 2s both;
    }
    
    @keyframes finalBadgeSlideIn {
      0% { transform: translateY(50px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    
    /* Responsive pour quiz final */
    @media (max-width: 768px) {
      .final-navigation {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .final-nav-btn {
        width: 100%;
        padding: var(--spacing-md);
      }
      
      .final-quiz-option {
        padding: var(--spacing-md);
        font-size: 1rem;
        min-height: 50px;
      }
      
      .final-question-text {
        font-size: 1.1rem;
      }
      
      .final-celebration {
        padding: 2rem;
      }
      
      .final-celebration h2 {
        font-size: 2rem;
      }
      
      .final-score-display {
        font-size: 1.5rem;
      }
    }
    
    /* Animation d'entrée pour le quiz final */
    .final-quiz-enter {
      animation: finalQuizEnter 0.8s ease-out;
    }
    
    @keyframes finalQuizEnter {
      0% { 
        transform: translateY(50px); 
        opacity: 0; 
        filter: blur(10px);
      }
      100% { 
        transform: translateY(0); 
        opacity: 1; 
        filter: blur(0);
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .course-container {
        padding: var(--spacing-md);
      }
      
      .course-title {
        font-size: 2.2rem;
      }
      
      .section-title {
        font-size: 1.5rem;
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
      }
      
      .course-meta {
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .validation-options {
        gap: var(--spacing-xs);
      }
      
      .validation-option {
        padding: var(--spacing-sm);
        font-size: 0.9rem;
      }
    }
    
    /* Styles simplifiés et fonctionnels */
    .quiz-question-container {
      background: var(--color-surface-hover);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xl);
      margin: var(--spacing-lg) 0;
      border: 1px solid rgba(155, 89, 182, 0.2);
    }
    
    .quiz-question h4 {
      color: #9b59b6;
      font-family: var(--font-family-secondary);
      margin-bottom: var(--spacing-md);
    }
    
    .quiz-question p {
      color: var(--color-text);
      margin-bottom: var(--spacing-lg);
      font-size: 1.1rem;
    }
    
    .quiz-nav-btn.finish {
      background: linear-gradient(135deg, #9b59b6, #e74c3c);
      color: white;
      border: none;
    }
    
    .quiz-nav-btn.finish:hover:not(:disabled) {
      background: linear-gradient(135deg, #8e44ad, #c0392b);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
    }

    /* Styles pour les résultats du quiz final */
    .quiz-final-results {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }

    .result-badge {
      text-align: center;
      margin-bottom: var(--spacing-xl);
    }

    .badge-master {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      font-size: 1.5rem;
      font-weight: bold;
      animation: badgeGlow 2s infinite alternate;
      box-shadow: 0 8px 32px rgba(155, 89, 182, 0.4);
    }

    .badge-good {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      font-size: 1.5rem;
      font-weight: bold;
      animation: badgeGlow 2s infinite alternate;
      box-shadow: 0 8px 32px rgba(46, 204, 113, 0.3);
    }

    .badge-retry {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 8px 32px rgba(231, 76, 60, 0.3);
    }

    @keyframes badgeGlow {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }

    .result-details {
      margin: var(--spacing-xl) 0;
    }

    .result-details h4 {
      color: #9b59b6;
      font-family: var(--font-family-secondary);
      margin-bottom: var(--spacing-lg);
      text-align: center;
    }

    .result-actions {
      display: flex;
      justify-content: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-xl);
      flex-wrap: wrap;
    }

    .quiz-btn {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--border-radius-md);
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-fast);
      font-size: 1rem;
    }

    .quiz-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
    }

    .quiz-btn.secondary {
      background: var(--color-surface);
      border: 2px solid #9b59b6;
      color: #9b59b6;
    }

    .quiz-btn.secondary:hover {
      background: #9b59b6;
      color: white;
    }

    .question-text {
      font-size: 1.2rem;
      font-weight: bold;
      color: #9b59b6;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-lg);
      background: var(--color-surface);
      border-radius: var(--border-radius-md);
      border-left: 4px solid #9b59b6;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .course-container {
        padding: var(--spacing-md);
      }
      
      .course-title {
        font-size: 2.2rem;
      }
      
      .section-title {
        font-size: 1.5rem;
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
      }
      
      .course-meta {
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .validation-options {
        gap: var(--spacing-xs);
      }
      
      .validation-option {
        padding: var(--spacing-sm);
        font-size: 0.9rem;
      }
    }

    /* Badge de completion du cours */
    .course-completion-badge {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      text-align: center;
      margin: var(--spacing-xl) 0;
      box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
      animation: completionBadgeGlow 2s infinite alternate;
    }
    
    @keyframes completionBadgeGlow {
      0% { box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4); }
      100% { box-shadow: 0 12px 35px rgba(155, 89, 182, 0.6); }
    }
    
    .course-completion-badge h3 {
      font-size: 2rem;
      margin-bottom: var(--spacing-md);
      font-family: var(--font-family-secondary);
    }

    /* FORCER LE FOND MULTICOLORE - RÈGLE FINALE */
    body div.main-content section#section-6 div.superlative-type.final-quiz-section::before {
      content: '' !important;
      position: absolute !important;
      top: -2px !important;
      left: -2px !important;
      right: -2px !important;
      bottom: -2px !important;
      background: linear-gradient(45deg, #9b59b6, #e74c3c, #f39c12, #2ecc71, #3498db, #9b59b6) !important;
      background-size: 300% 300% !important;
      border-radius: var(--border-radius-lg) !important;
      z-index: -1 !important;
      animation: finalQuizBorder 3s linear infinite !important;
      display: block !important;
      opacity: 1 !important;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-container">
      <a href="../index.html" class="logo">ENGLISH<span>QUEST</span></a>

      <nav class="nav">
        <ul class="nav-list">
          <li><a href="../index.html" class="nav-link">Accueil</a></li>
          <li><a href="../games.html" class="nav-link">Jeux</a></li>
          <li><a href="../courses.html" class="nav-link active">Cours</a></li>
          <li><a href="../gallery.html" class="nav-link">Galerie</a></li>
          <li><a href="../leaderboard.html" class="nav-link">Classement</a></li>
          <!-- Éléments user-menu intégrés dans la navigation mobile -->
          <li class="mobile-only"><a href="../login.html" class="nav-link" id="mobileLoginButton">Connexion</a></li>
          <li class="mobile-only"><a href="../profile.html" class="nav-link" id="mobileProfileButton" style="display: none;">Mon Profil</a></li>
          <li class="mobile-only"><a href="#" class="nav-link" id="mobileLogoutButton" style="display: none;">Déconnexion</a></li>
        </ul>
      </nav>

      <div class="user-menu" id="userMenu">
        <a href="../login.html" class="btn-login" id="loginButton">Connexion</a>
        <a href="../profile.html" class="btn-login" id="profileButton" style="display: none;">Mon Profil</a>
        <button class="menu-toggle">☰</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main style="padding-top: 100px; min-height: 100vh;">
    <div class="course-container">
      <!-- Course Header -->
      <div class="course-header">
        <h1 class="course-title">Le Superlatif en Anglais</h1>
        <p class="course-subtitle">Maîtrisez l'art d'exprimer les extrêmes avec précision et élégance</p>
        
        <div class="course-meta">
          <div class="meta-item">
            <i class="fas fa-clock"></i>
            <span>35 minutes</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-signal"></i>
            <span>Niveau Intermédiaire</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-gamepad"></i>
            <span>Mode Jeu Activé</span>
          </div>
        </div>
        
        <div class="game-progress-bar">
          <div class="game-progress-fill" id="gameProgressFill"></div>
        </div>
        <div class="game-progress-text" id="gameProgressText">Progression : 0/6 étapes complétées</div>
      </div>

      <!-- Section 1: Introduction -->
      <section class="course-section current" id="section-1" data-section="1">
        <h2 class="section-title">
          <span class="section-number" id="number-1">1</span>
          Introduction au Superlatif
        </h2>
        
        <p>Le superlatif en anglais est l'outil grammatical essentiel pour exprimer les extrêmes et comparer une chose ou une personne à toutes les autres d'un même groupe. C'est l'une des structures les plus importantes pour communiquer avec précision et nuance.</p>
        
        <div class="note-box">
          <strong>Pourquoi maîtriser le superlatif ?</strong><br>
          ✓ Exprimer les extrêmes (le plus grand, le plus petit, le meilleur...)<br>
          ✓ Faire des comparaisons avec tout un groupe<br>
          ✓ Décrire des records et des caractéristiques exceptionnelles<br>
          ✓ Enrichir votre expression orale et écrite<br>
          ✓ Éviter les erreurs très communes des francophones<br>
          ✓ Maîtriser les nuances stylistiques et contextuelles
        </div>
        
        <p>Nous allons étudier <strong>6 aspects essentiels</strong> du superlatif anglais :</p>
        
        <ul style="margin-left: var(--spacing-lg); color: var(--color-text-secondary);">
          <li><strong style="color: var(--color-primary);">Formation des superlatifs</strong> - Les règles de construction (-est vs most)</li>
          <li><strong style="color: var(--color-primary);">Superlatifs irréguliers</strong> - Les formes spéciales à connaître absolument</li>
          <li><strong style="color: var(--color-primary);">Usage avec prépositions</strong> - "in", "of", "at" et leurs contextes</li>
          <li><strong style="color: var(--color-primary);">Erreurs communes</strong> - Les pièges typiques des francophones</li>
          <li><strong style="color: var(--color-primary);">Nuances stylistiques</strong> - Registres formels et informels</li>
          <li><strong style="color: var(--color-primary);">Applications pratiques</strong> - Contextes réels d'utilisation</li>
        </ul>
        
        <button class="section-complete-btn" id="complete-1" onclick="showValidationQuiz(1)">
          <i class="fas fa-question-circle"></i>
          Passer le Quiz de Validation
        </button>
        
        <!-- Quiz de Validation Section 1 -->
        <div class="section-validation-quiz" id="validation-quiz-1">
          <h3 class="validation-quiz-title">
            <i class="fas fa-question-circle"></i>
            Quiz de Validation - Introduction aux Superlatifs
          </h3>
          
          <div class="validation-question" data-question="1">
            <div class="validation-question-text">
              Question 1: Quel est le rôle principal du superlatif en anglais ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">Comparer deux éléments</div>
              <div class="validation-option" data-answer="1">Exprimer les extrêmes dans un groupe</div>
              <div class="validation-option" data-answer="2">Décrire des actions</div>
              <div class="validation-option" data-answer="3">Former des questions</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-question" data-question="2">
            <div class="validation-question-text">
              Question 2: Combien d'aspects essentiels du superlatif allons-nous étudier ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">4 aspects</div>
              <div class="validation-option" data-answer="1">5 aspects</div>
              <div class="validation-option" data-answer="2">6 aspects</div>
              <div class="validation-option" data-answer="3">7 aspects</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-controls">
            <button class="validation-btn" id="check-validation-1" onclick="checkValidationQuiz(1)" disabled>
              <i class="fas fa-check"></i> Vérifier mes Réponses
            </button>
            <button class="validation-btn success" id="continue-validation-1" onclick="continueAfterValidation(1)" style="display: none;">
              <i class="fas fa-arrow-right"></i> Continuer vers la Section 2
            </button>
          </div>
          
          <div class="validation-score" id="validation-score-1">
            <span class="score-text"></span>
          </div>
        </div>
      </section>

      <!-- Section 2: Formation des Superlatifs -->
      <section class="course-section locked" id="section-2" data-section="2">
        <div class="lock-overlay" id="lock-2">
          <i class="fas fa-lock"></i>
          <p>Terminez la section précédente pour débloquer cette section</p>
        </div>
        
        <h2 class="section-title">
          <span class="section-number locked" id="number-2">2</span>
          Formation des Superlatifs
        </h2>
        
        <p>La formation du superlatif en anglais suit des règles précises selon la longueur et la terminaison de l'adjectif. Maîtriser ces règles vous évitera les erreurs les plus communes.</p>

        <!-- Adjectifs courts avec -est -->
        <div class="superlative-type">
          <h3 class="superlative-title">📏 Adjectifs Courts (1-2 syllabes) avec -EST</h3>
          
          <div class="structure-box">
            <strong>Règle de base :</strong> the + adjectif + est
          </div>
          
          <div class="example-box">
            <strong>Exemples simples :</strong><br>
            • tall → the tallest (le plus grand)<br>
            • fast → the fastest (le plus rapide)<br>
            • old → the oldest (le plus âgé)<br>
            • small → the smallest (le plus petit)
          </div>
          
          <div class="warning-box">
            <strong>Règles d'orthographe importantes :</strong><br>
            ✓ Consonne finale doublée : big → the biggest<br>
            ✓ Y devient IE : happy → the happiest<br>
            ✓ E muet supprimé : large → the largest
          </div>
        </div>

        <!-- Adjectifs longs avec most -->
        <div class="superlative-type">
          <h3 class="superlative-title">📖 Adjectifs Longs (3+ syllabes) avec MOST</h3>
          
          <div class="structure-box">
            <strong>Règle de base :</strong> the most + adjectif
          </div>
          
          <div class="example-box">
            <strong>Exemples :</strong><br>
            • beautiful → the most beautiful<br>
            • expensive → the most expensive<br>
            • intelligent → the most intelligent<br>
            • comfortable → the most comfortable
          </div>
        </div>

        <!-- Cas particuliers -->
        <div class="superlative-type">
          <h3 class="superlative-title">⚡ Cas Particuliers (2 syllabes)</h3>
          
          <div class="note-box">
            Pour les adjectifs de 2 syllabes, les deux formes sont souvent possibles :<br>
            • clever → the cleverest / the most clever<br>
            • gentle → the gentlest / the most gentle<br>
            • narrow → the narrowest / the most narrow
          </div>
        </div>
        
        <button class="section-complete-btn" id="complete-2" onclick="showValidationQuiz(2)">
          <i class="fas fa-question-circle"></i>
          Passer le Quiz de Validation
        </button>
        
        <!-- Quiz de Validation Section 2 -->
        <div class="section-validation-quiz" id="validation-quiz-2">
          <h3 class="validation-quiz-title">
            <i class="fas fa-question-circle"></i>
            Quiz de Validation - Formation des Superlatifs
          </h3>
          
          <div class="validation-question" data-question="1">
            <div class="validation-question-text">
              Question 1: Quelle est la forme superlative de "tall" ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">the most tall</div>
              <div class="validation-option" data-answer="1">the tallest</div>
              <div class="validation-option" data-answer="2">tallest</div>
              <div class="validation-option" data-answer="3">the taller</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-question" data-question="2">
            <div class="validation-question-text">
              Question 2: Comment forme-t-on le superlatif de "beautiful" ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">the beautifulest</div>
              <div class="validation-option" data-answer="1">the most beautiful</div>
              <div class="validation-option" data-answer="2">beautifulest</div>
              <div class="validation-option" data-answer="3">beautiful</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-controls">
            <button class="validation-btn" id="check-validation-2" onclick="checkValidationQuiz(2)" disabled>
              <i class="fas fa-check"></i> Vérifier mes Réponses
            </button>
            <button class="validation-btn success" id="continue-validation-2" onclick="continueAfterValidation(2)" style="display: none;">
              <i class="fas fa-arrow-right"></i> Continuer vers la Section 3
            </button>
          </div>
          
          <div class="validation-score" id="validation-score-2">
            <span class="score-text"></span>
          </div>
        </div>
      </section>

      <!-- Section 3: Superlatifs Irréguliers -->
      <section class="course-section locked" id="section-3" data-section="3">
        <div class="lock-overlay" id="lock-3">
          <i class="fas fa-lock"></i>
          <p>Terminez la section précédente pour débloquer cette section</p>
        </div>
        
        <h2 class="section-title">
          <span class="section-number locked" id="number-3">3</span>
          Superlatifs Irréguliers
        </h2>
        
        <p>Certains adjectifs très courants ont des formes superlatives complètement irrégulières. Ces formes sont essentielles à connaître car elles sont utilisées quotidiennement.</p>

        <div class="superlative-type">
          <h3 class="superlative-title">⭐ Les Superlatifs Irréguliers Essentiels</h3>
          
          <div class="structure-box">
            <strong>Formes à mémoriser absolument :</strong><br>
            • good → the best (le meilleur)<br>
            • bad → the worst (le pire)<br>
            • far → the farthest/furthest (le plus loin)<br>
            • much/many → the most (le plus)<br>
            • little → the least (le moins)
          </div>
          
          <div class="example-box">
            <strong>Exemples en contexte :</strong><br>
            • This is the <strong>best</strong> pizza in town.<br>
            • It was the <strong>worst</strong> day of my life.<br>
            • She lives the <strong>farthest</strong> from school.<br>
            • He has the <strong>most</strong> experience.<br>
            • This requires the <strong>least</strong> effort.
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">🎯 Distinction Far/Further</h3>
          
          <div class="note-box">
            <strong>Farthest vs Furthest :</strong><br>
            • <strong>Farthest</strong> = distance physique mesurable<br>
            • <strong>Furthest</strong> = distance abstraite, métaphorique<br><br>
            "The farthest planet" (distance physique)<br>
            "The furthest idea from my mind" (distance abstraite)
          </div>
        </div>

        <div class="warning-box">
          <strong>Erreur commune à éviter :</strong><br>
          ❌ "the goodest", "the baddest", "the bestest"<br>
          ✅ "the best", "the worst"<br><br>
          Ces formes irrégulières ne prennent jamais -est !
        </div>
        
        <button class="section-complete-btn" id="complete-3" onclick="showValidationQuiz(3)">
          <i class="fas fa-question-circle"></i>
          Passer le Quiz de Validation
        </button>
        
        <!-- Quiz de Validation Section 3 -->
        <div class="section-validation-quiz" id="validation-quiz-3">
          <h3 class="validation-quiz-title">
            <i class="fas fa-question-circle"></i>
            Quiz de Validation - Superlatifs Irréguliers
          </h3>
          
          <div class="validation-question" data-question="1">
            <div class="validation-question-text">
              Question 1: Quelle est la forme superlative de "good" ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">the goodest</div>
              <div class="validation-option" data-answer="1">the best</div>
              <div class="validation-option" data-answer="2">the most good</div>
              <div class="validation-option" data-answer="3">goodest</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-question" data-question="2">
            <div class="validation-question-text">
              Question 2: Quelle est la différence entre "farthest" et "furthest" ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">Aucune différence</div>
              <div class="validation-option" data-answer="1">Farthest = distance physique, Furthest = distance abstraite</div>
              <div class="validation-option" data-answer="2">Furthest = distance physique, Farthest = distance abstraite</div>
              <div class="validation-option" data-answer="3">Farthest est britannique, Furthest américain</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-controls">
            <button class="validation-btn" id="check-validation-3" onclick="checkValidationQuiz(3)" disabled>
              <i class="fas fa-check"></i> Vérifier mes Réponses
            </button>
            <button class="validation-btn success" id="continue-validation-3" onclick="continueAfterValidation(3)" style="display: none;">
              <i class="fas fa-arrow-right"></i> Continuer vers la Section 4
            </button>
          </div>
          
          <div class="validation-score" id="validation-score-3">
            <span class="score-text"></span>
          </div>
        </div>
      </section>

      <!-- Section 4: Usage avec Prépositions -->
      <section class="course-section locked" id="section-4" data-section="4">
        <div class="lock-overlay" id="lock-4">
          <i class="fas fa-lock"></i>
          <p>Terminez la section précédente pour débloquer cette section</p>
        </div>
        
        <h2 class="section-title">
          <span class="section-number locked" id="number-4">4</span>
          Usage avec Prépositions
        </h2>
        
        <p>L'usage correct des prépositions avec le superlatif est crucial pour une expression naturelle. Chaque préposition a ses contextes d'usage spécifiques.</p>

        <div class="superlative-type">
          <h3 class="superlative-title">🏢 Préposition "IN" - Lieux et Groupes</h3>
          
          <div class="structure-box">
            <strong>Usage :</strong> the + superlatif + in + lieu/groupe
          </div>
          
          <div class="example-box">
            <strong>Exemples :</strong><br>
            • The tallest building <strong>in</strong> the city<br>
            • The best restaurant <strong>in</strong> Paris<br>
            • The smartest student <strong>in</strong> the class<br>
            • The most beautiful beach <strong>in</strong> France
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">👥 Préposition "OF" - Ensembles et Collections</h3>
          
          <div class="structure-box">
            <strong>Usage :</strong> the + superlatif + of + ensemble défini
          </div>
          
          <div class="example-box">
            <strong>Exemples :</strong><br>
            • The oldest <strong>of</strong> my friends<br>
            • The most expensive <strong>of</strong> all cars<br>
            • The best <strong>of</strong> the three options<br>
            • The worst <strong>of</strong> his movies
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">🎯 Préposition "AT" - Compétences et Activités</h3>
          
          <div class="structure-box">
            <strong>Usage :</strong> the + superlatif + at + activité/compétence
          </div>
          
          <div class="example-box">
            <strong>Exemples :</strong><br>
            • The best <strong>at</strong> playing tennis<br>
            • The worst <strong>at</strong> cooking<br>
            • The fastest <strong>at</strong> running<br>
            • The most skilled <strong>at</strong> programming
          </div>
        </div>

        <div class="warning-box">
          <strong>Erreurs communes des francophones :</strong><br>
          ❌ "The best of the city" → ✅ "The best in the city"<br>
          ❌ "The tallest in my friends" → ✅ "The tallest of my friends"<br>
          ❌ "The best in tennis" → ✅ "The best at tennis"
        </div>
        
        <button class="section-complete-btn" id="complete-4" onclick="showValidationQuiz(4)">
          <i class="fas fa-question-circle"></i>
          Passer le Quiz de Validation
        </button>
        
        <!-- Quiz de Validation Section 4 -->
        <div class="section-validation-quiz" id="validation-quiz-4">
          <h3 class="validation-quiz-title">
            <i class="fas fa-question-circle"></i>
            Quiz de Validation - Usage avec Prépositions
          </h3>
          
          <div class="validation-question" data-question="1">
            <div class="validation-question-text">
              Question 1: Quelle préposition utilise-t-on avec un lieu ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">"The best restaurant OF Paris"</div>
              <div class="validation-option" data-answer="1">"The best restaurant IN Paris"</div>
              <div class="validation-option" data-answer="2">"The best restaurant AT Paris"</div>
              <div class="validation-option" data-answer="3">"The best restaurant ON Paris"</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-question" data-question="2">
            <div class="validation-question-text">
              Question 2: Complétez : "The best ___ playing tennis"
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">in</div>
              <div class="validation-option" data-answer="1">at</div>
              <div class="validation-option" data-answer="2">of</div>
              <div class="validation-option" data-answer="3">on</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-controls">
            <button class="validation-btn" id="check-validation-4" onclick="checkValidationQuiz(4)" disabled>
              <i class="fas fa-check"></i> Vérifier mes Réponses
            </button>
            <button class="validation-btn success" id="continue-validation-4" onclick="continueAfterValidation(4)" style="display: none;">
              <i class="fas fa-arrow-right"></i> Continuer vers la Section 5
            </button>
          </div>
          
          <div class="validation-score" id="validation-score-4">
            <span class="score-text"></span>
          </div>
        </div>
      </section>

      <!-- Section 5: Erreurs Communes et Nuances -->
      <section class="course-section locked" id="section-5" data-section="5">
        <div class="lock-overlay" id="lock-5">
          <i class="fas fa-lock"></i>
          <p>Terminez la section précédente pour débloquer cette section</p>
        </div>
        
        <h2 class="section-title">
          <span class="section-number locked" id="number-5">5</span>
          Erreurs Communes et Nuances
        </h2>
        
        <p>Cette section vous aidera à éviter les erreurs typiques des francophones et à maîtriser les nuances stylistiques du superlatif anglais.</p>

        <div class="superlative-type">
          <h3 class="superlative-title">❌ Erreurs Communes des Francophones</h3>
          
          <div class="warning-box">
            <strong>1. Oubli de l'article "THE" :</strong><br>
            ❌ "Mount Everest is tallest mountain"<br>
            ✅ "Mount Everest is <strong>the</strong> tallest mountain"
          </div>
          
          <div class="warning-box">
            <strong>2. Mauvaise formation avec adjectifs courts :</strong><br>
            ❌ "the most big", "the most fast"<br>
            ✅ "the biggest", "the fastest"
          </div>
          
          <div class="warning-box">
            <strong>3. Double superlatif :</strong><br>
            ❌ "the most biggest", "the most best"<br>
            ✅ "the biggest", "the best"
          </div>
          
          <div class="warning-box">
            <strong>4. Confusion avec le comparatif :</strong><br>
            ❌ "She is the taller" (comparatif)<br>
            ✅ "She is the tallest" (superlatif)
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">🎭 Nuances Stylistiques</h3>
          
          <div class="note-box">
            <strong>Registre formel :</strong><br>
            • "The most sophisticated approach"<br>
            • "The most comprehensive analysis"<br>
            • "The most distinguished guest"
          </div>
          
          <div class="note-box">
            <strong>Registre informel :</strong><br>
            • "The coolest guy"<br>
            • "The weirdest thing"<br>
            • "The craziest idea"
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">🔄 Alternatives et Variantes</h3>
          
          <div class="example-box">
            <strong>Renforcement avec "by far" :</strong><br>
            • "This is <strong>by far</strong> the best solution"<br>
            • "She is <strong>by far</strong> the smartest student"<br><br>
            
            <strong>Atténuation avec "one of the" :</strong><br>
            • "One of the most beautiful cities"<br>
            • "One of the best restaurants"
          </div>
        </div>
        
        <button class="section-complete-btn" id="complete-5" onclick="showValidationQuiz(5)">
          <i class="fas fa-question-circle"></i>
          Passer le Quiz de Validation
        </button>
        
        <!-- Quiz de Validation Section 5 -->
        <div class="section-validation-quiz" id="validation-quiz-5">
          <h3 class="validation-quiz-title">
            <i class="fas fa-question-circle"></i>
            Quiz de Validation - Erreurs et Nuances
          </h3>
          
          <div class="validation-question" data-question="1">
            <div class="validation-question-text">
              Question 1: Quelle phrase est correcte ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">"This is most beautiful place"</div>
              <div class="validation-option" data-answer="1">"This is the most beautiful place"</div>
              <div class="validation-option" data-answer="2">"This is most beautifulest place"</div>
              <div class="validation-option" data-answer="3">"This is the most beautifulest place"</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-question" data-question="2">
            <div class="validation-question-text">
              Question 2: Comment dit-on "de loin le meilleur" ?
            </div>
            <div class="validation-options">
              <div class="validation-option" data-answer="0">"far the best"</div>
              <div class="validation-option" data-answer="1">"by far the best"</div>
              <div class="validation-option" data-answer="2">"from far the best"</div>
              <div class="validation-option" data-answer="3">"the far best"</div>
            </div>
            <div class="validation-feedback">
              <span class="feedback-text"></span>
            </div>
          </div>
          
          <div class="validation-controls">
            <button class="validation-btn" id="check-validation-5" onclick="checkValidationQuiz(5)" disabled>
              <i class="fas fa-check"></i> Vérifier mes Réponses
            </button>
            <button class="validation-btn success" id="continue-validation-5" onclick="continueAfterValidation(5)" style="display: none;">
              <i class="fas fa-arrow-right"></i> Continuer vers la Section 6
            </button>
          </div>
          
          <div class="validation-score" id="validation-score-5">
            <span class="score-text"></span>
          </div>
        </div>
      </section>

      <!-- Section 6: Applications Pratiques et Quiz Final -->
      <section class="course-section locked" id="section-6" data-section="6">
        <div class="lock-overlay" id="lock-6">
          <i class="fas fa-lock"></i>
          <p>Terminez la section précédente pour débloquer cette section</p>
        </div>
        
        <h2 class="section-title">
          <span class="section-number locked" id="number-6">6</span>
          Applications Pratiques et Certification
        </h2>
        
        <p>Cette section finale vous propose des exercices pratiques et le quiz de certification pour valider votre maîtrise du superlatif anglais.</p>

        <div class="superlative-type">
          <h3 class="superlative-title">🎯 Contextes d'Usage Réels</h3>
          
          <div class="example-box">
            <strong>En voyage :</strong><br>
            • "What's the best way to get to the airport?"<br>
            • "This is the most beautiful view I've ever seen."<br>
            • "Where's the nearest restaurant?"<br><br>
            
            <strong>Au travail :</strong><br>
            • "This is the most efficient solution."<br>
            • "She's the most experienced member of our team."<br>
            • "What's the fastest way to complete this project?"<br><br>
            
            <strong>Dans la vie quotidienne :</strong><br>
            • "This is the best coffee in town."<br>
            • "He's the tallest player on the team."<br>
            • "What's the cheapest option available?"
          </div>
        </div>

        <div class="superlative-type">
          <h3 class="superlative-title">🏆 Quiz d'Entraînement</h3>
          
          <p>Avant le quiz final, testez vos connaissances avec notre quiz d'entraînement interactif !</p>
          
          <button class="section-complete-btn" id="start-practice-quiz" onclick="startPracticeQuiz()">
            <i class="fas fa-dumbbell"></i>
            Démarrer le Quiz d'Entraînement
          </button>
          
          <!-- Container du quiz d'entraînement -->
          <div id="practiceQuizContainer" style="display: none; margin-top: var(--spacing-xl);">
            <div class="quiz-header">
              <h3>Quiz d'Entraînement - Question <span id="practiceCurrentQ">1</span>/10</h3>
              <div class="quiz-progress">
                <div class="quiz-progress-bar">
                  <div class="quiz-progress-fill" id="practiceProgressFill"></div>
                </div>
              </div>
            </div>

            <div class="quiz-question">
              <div class="quiz-question-text" id="practiceQuestionText"></div>
              <div class="quiz-options" id="practiceQuestionOptions"></div>
            </div>

            <div class="quiz-navigation">
              <button class="quiz-nav-btn" id="practicePrevQuestion" onclick="practicePrevQuestion()">
                <i class="fas fa-arrow-left"></i> Précédent
              </button>
              <button class="quiz-nav-btn" id="practiceNextQuestion" onclick="practiceNextQuestion()">
                Suivant <i class="fas fa-arrow-right"></i>
              </button>
              <button class="quiz-nav-btn primary" id="practiceFinishQuiz" onclick="finishPracticeQuiz()" style="display: none;">
                <i class="fas fa-check"></i> Voir les Résultats
              </button>
            </div>
          </div>

          <!-- Résultats du quiz d'entraînement -->
          <div id="practiceQuizResults" style="display: none;">
            <div id="practiceResultsContent"></div>
          </div>
        </div>

        <div class="superlative-type final-quiz-section">
          <div class="final-quiz-title">
            🎯 DÉFI FINAL : MAÎTRE DU SUPERLATIF
          </div>

          <div class="quiz-info-final">
            <h4>🏆 Quiz de Certification</h4>
            <p><strong>🎯 Format :</strong> 20 questions sélectionnées sur tous les aspects étudiés</p>
            <p><strong>⏱️ Temps :</strong> Pas de limite, prenez votre temps</p>
            <p><strong>🎖️ Certification :</strong> 16/20 minimum pour valider le cours</p>
            <p><strong>🏅 Excellence :</strong> 18/20 pour le titre de "Maître du Superlatif"</p>
          </div>
          
          <div class="final-quiz-requirements">
            <h5><i class="fas fa-exclamation-triangle"></i> Conditions de Validation</h5>
            <ul>
              <li>✓ Toutes les sections précédentes doivent être complétées</li>
              <li>🎯 Score minimum : 16/20 (80%)</li>
              <li>🏆 Une seule tentative pour la certification officielle</li>
              <li>📜 Certificat de réussite délivré automatiquement</li>
            </ul>
          </div>
          
          <div class="interactive-exercise">
            <div class="quiz-controls">
              <button id="start-final-quiz" class="quiz-btn" style="font-size: 1.2rem; padding: var(--spacing-lg) var(--spacing-xl);" onclick="startFinalQuiz()">
                🚀 COMMENCER LE DÉFI FINAL
              </button>
              <button id="resetFinalQuiz" class="quiz-btn secondary" style="display: none;">🔄 Recommencer (Entraînement)</button>
            </div>

            <!-- Container du quiz final -->
            <div id="finalQuizContainer" style="display: none;">
              <div class="quiz-header">
                <div class="quiz-progress">
                  <span id="finalQuestionCounter">Question 1/20</span>
                  <div class="quiz-progress-bar">
                    <div class="quiz-progress-fill" id="finalQuizProgressFill"></div>
                  </div>
                </div>
                <div class="quiz-score">
                  <span id="finalCurrentScore">Score: 0/0</span>
                </div>
              </div>

              <div id="finalCurrentQuestion" class="quiz-question-container">
                <!-- Questions will be inserted here dynamically -->
              </div>

              <div class="quiz-navigation">
                <button id="finalPrevQuestion" class="quiz-nav-btn" disabled>⬅️ Précédent</button>
                <button id="finalNextQuestion" class="quiz-nav-btn" disabled>Suivant ➡️</button>
                <button id="finalFinishQuiz" class="quiz-nav-btn finish" style="display: none;">🏁 VALIDER LE COURS</button>
              </div>
            </div>

            <!-- Résultats du quiz final -->
            <div id="finalQuizResults" style="display: none;">
              <div class="quiz-final-results">
                <div id="finalResultBadge" class="result-badge">
                  <!-- Badge will be inserted here -->
                </div>
                <div class="result-details">
                  <h4>📊 Résultats de Certification</h4>
                  <div id="finalResultBreakdown"></div>
                </div>
                <div class="result-actions">
                  <button id="finalReviewAnswers" class="quiz-btn">📝 Revoir les Réponses</button>
                  <button id="downloadCertificate" class="quiz-btn" style="display: none;">📜 Télécharger le Certificat</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Section de Completion du Cours -->
      <div id="courseCompletionSection" style="display: none;">
        <div class="course-completion-badge">
          <h3>🎉 FÉLICITATIONS ! 🎉</h3>
          <p>Vous avez officiellement terminé le cours sur le Superlatif en Anglais !</p>
          <div style="margin-top: var(--spacing-lg);">
            <div style="display: inline-block; background: white; color: #2c3e50; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--border-radius-md); margin: 0 var(--spacing-sm);">
              <strong>Score Final :</strong> <span id="finalCourseScore">--/20</span>
            </div>
            <div style="display: inline-block; background: white; color: #2c3e50; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--border-radius-md); margin: 0 var(--spacing-sm);">
              <strong>Titre :</strong> <span id="finalCourseTitle">Maître du Superlatif</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer" style="background-color: var(--color-surface); padding: var(--spacing-xl) 0; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: var(--spacing-xl);">
    <div class="container">
      <div class="footer-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
        <div class="footer-brand">
          <a href="../index.html" class="logo" style="margin-bottom: var(--spacing-md); display: inline-block;">ENGLISH<span>QUEST</span></a>
          <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">Une nouvelle approche de l'apprentissage de l'anglais, plus immersive et compétitive.</p>
        </div>

        <div class="footer-links">
          <h4 style="color: var(--color-primary); margin-bottom: var(--spacing-md);">Navigation</h4>
          <ul style="display: flex; flex-direction: column; gap: var(--spacing-xs);">
            <li><a href="../index.html" style="color: var(--color-text-secondary); transition: color 0.3s ease;">Accueil</a></li>
            <li><a href="../games.html" style="color: var(--color-text-secondary); transition: color 0.3s ease;">Jeux</a></li>
            <li><a href="../courses.html" style="color: var(--color-text-secondary); transition: color 0.3s ease;">Cours</a></li>
            <li><a href="../gallery.html" style="color: var(--color-text-secondary); transition: color 0.3s ease;">Galerie</a></li>
            <li><a href="../leaderboard.html" style="color: var(--color-text-secondary); transition: color 0.3s ease;">Classement</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom" style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid rgba(255, 255, 255, 0.1); text-align: center; color: var(--color-text-secondary);">
        <p>&copy; 2025 English Quest - Tous droits réservés</p>
      </div>
    </div>
  </footer>

  <script>
    // Configuration du cours
    const COURSE_CONFIG = {
      courseName: "Le Superlatif",
      courseId: "superlative-course",
      totalSections: 6,
      practiceQuestions: 10,
      finalQuestions: 20,
      finalPassingScore: 16
    };

    // État du jeu
    let gameState = {
      completedSections: [],
      currentSection: 1,
      practiceQuizCompleted: false,
      practiceScore: 0,
      finalQuizCompleted: false,
      finalScore: 0,
      rewardsGiven: {
        sections: [], // Sections pour lesquelles les récompenses ont été données
        finalQuiz: false // Si les récompenses du quiz final ont été données
      }
    };

    // Réponses correctes pour chaque quiz de validation
    const VALIDATION_ANSWERS = {
      1: [1, 2], // Section 1: questions 1 et 2
      2: [1, 1], // Section 2: questions 1 et 2
      3: [1, 1], // Section 3: questions 1 et 2
      4: [1, 1], // Section 4: questions 1 et 2
      5: [1, 1], // Section 5: questions 1 et 2
    };

    // Questions du quiz d'entraînement
    const PRACTICE_QUESTIONS = [
      {
        question: "Quelle est la forme superlative de 'tall' ?",
        options: ["the most tall", "the tallest", "the taller", "tallest"],
        correct: 1,
        explanation: "Les adjectifs courts (1-2 syllabes) prennent -est au superlatif."
      },
      {
        question: "Comment forme-t-on le superlatif de 'beautiful' ?",
        options: ["the beautifulest", "the most beautiful", "beautifulest", "beautiful"],
        correct: 1,
        explanation: "Les adjectifs longs (3+ syllabes) utilisent 'the most'."
      },
      {
        question: "Quelle est la forme correcte pour 'good' ?",
        options: ["the goodest", "the most good", "the best", "goodest"],
        correct: 2,
        explanation: "'Good' a une forme superlative irrégulière : 'the best'."
      },
      {
        question: "Complétez : 'The tallest building ___ the city'",
        options: ["of", "in", "at", "on"],
        correct: 1,
        explanation: "On utilise 'in' avec les lieux géographiques."
      },
      {
        question: "Quelle est l'erreur dans : 'This is most beautiful place' ?",
        options: ["Rien", "Manque 'the'", "Manque 'a'", "Mauvais adjectif"],
        correct: 1,
        explanation: "Le superlatif requiert toujours l'article 'the'."
      },
      {
        question: "Comment dit-on 'le pire' ?",
        options: ["the baddest", "the most bad", "the worst", "worst"],
        correct: 2,
        explanation: "'Bad' a une forme superlative irrégulière : 'the worst'."
      },
      {
        question: "Quelle préposition : 'The best ___ playing tennis' ?",
        options: ["in", "at", "of", "on"],
        correct: 1,
        explanation: "On utilise 'at' avec les compétences et activités."
      },
      {
        question: "Comment renforcer : 'This is the best solution' ?",
        options: ["very the best", "the most best", "by far the best", "really best"],
        correct: 2,
        explanation: "'By far' renforce le superlatif."
      },
      {
        question: "Quelle est la forme superlative de 'big' ?",
        options: ["the bigest", "the biggest", "the most big", "biggest"],
        correct: 1,
        explanation: "La consonne finale se double avant -est."
      },
      {
        question: "Complétez : 'The oldest ___ my friends'",
        options: ["in", "at", "of", "on"],
        correct: 2,
        explanation: "On utilise 'of' avec un ensemble défini de personnes."
      }
    ];

    // Questions du quiz final (20 questions)
    const FINAL_QUESTIONS = [
      {
        question: "Quelle est la règle de formation du superlatif pour les adjectifs courts ?",
        options: ["the + most + adjectif", "the + adjectif + est", "adjectif + est", "most + adjectif"],
        correct: 1
      },
      {
        question: "Comment forme-t-on le superlatif de 'expensive' ?",
        options: ["the expensivest", "the most expensive", "expensivest", "most expensive"],
        correct: 1
      },
      {
        question: "Quelle est la forme superlative irrégulière de 'good' ?",
        options: ["the goodest", "the most good", "the best", "goodest"],
        correct: 2
      },
      {
        question: "Quelle est la forme superlative irrégulière de 'bad' ?",
        options: ["the baddest", "the most bad", "the worst", "worst"],
        correct: 2
      },
      {
        question: "Comment dit-on 'le plus loin' (distance physique) ?",
        options: ["the furthest", "the farthest", "the most far", "farthest"],
        correct: 1
      },
      {
        question: "Comment dit-on 'le plus loin' (distance abstraite) ?",
        options: ["the furthest", "the farthest", "the most far", "furthest"],
        correct: 0
      },
      {
        question: "Quelle préposition : 'The best restaurant ___ Paris' ?",
        options: ["of", "in", "at", "on"],
        correct: 1
      },
      {
        question: "Quelle préposition : 'The oldest ___ my friends' ?",
        options: ["in", "at", "of", "on"],
        correct: 2
      },
      {
        question: "Quelle préposition : 'The best ___ playing piano' ?",
        options: ["in", "at", "of", "on"],
        correct: 1
      },
      {
        question: "Quelle est l'erreur : 'Mount Everest is tallest mountain' ?",
        options: ["Rien", "Manque 'the'", "Mauvais superlatif", "Manque 'a'"],
        correct: 1
      },
      {
        question: "Quelle est l'erreur : 'This is the most biggest house' ?",
        options: ["Double superlatif", "Manque 'the'", "Rien", "Mauvais adjectif"],
        correct: 0
      },
      {
        question: "Comment renforce-t-on un superlatif ?",
        options: ["very the best", "the most best", "by far the best", "really best"],
        correct: 2
      },
      {
        question: "Comment atténue-t-on un superlatif ?",
        options: ["a little the best", "one of the best", "quite the best", "rather best"],
        correct: 1
      },
      {
        question: "Quelle est la forme superlative de 'happy' ?",
        options: ["the happyest", "the happiest", "the most happy", "happiest"],
        correct: 1
      },
      {
        question: "Quelle est la forme superlative de 'large' ?",
        options: ["the larggest", "the largest", "the most large", "largest"],
        correct: 1
      },
      {
        question: "Quel registre : 'The most sophisticated approach' ?",
        options: ["Informel", "Formel", "Neutre", "Familier"],
        correct: 1
      },
      {
        question: "Quel registre : 'The coolest guy' ?",
        options: ["Informel", "Formel", "Neutre", "Académique"],
        correct: 0
      },
      {
        question: "Comment dit-on 'le moins' ?",
        options: ["the leastest", "the least", "the most less", "least"],
        correct: 1
      },
      {
        question: "Quelle phrase est correcte ?",
        options: ["She is the taller", "She is the tallest", "She is taller", "She is most tall"],
        correct: 1
      },
      {
        question: "Dans quel contexte : 'What's the nearest restaurant?' ?",
        options: ["Travail", "Voyage", "École", "Sport"],
        correct: 1
      }
    ];

    // Variables pour les quiz
    let practiceQuizData = {
      questions: [],
      currentIndex: 0,
      userAnswers: {},
      score: 0,
      isActive: false
    };

    let finalQuizData = {
      questions: [],
      currentIndex: 0,
      userAnswers: {},
      score: 0,
      isActive: false
    };

    // État des quiz de validation
    let validationStates = {};

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      loadGameState();
      updateCourseInterface();
      initializeValidationQuizzes();
      initializeRewardService();
    });

    // === GESTION DES SECTIONS ===

    function updateCourseInterface() {
      const totalSections = COURSE_CONFIG.totalSections;
      const completedCount = gameState.completedSections.length;
      
      // Mettre à jour la barre de progression globale
      const progressFill = document.getElementById('gameProgressFill');
      const progressText = document.getElementById('gameProgressText');
      
      if (progressFill && progressText) {
        const progressPercentage = (completedCount / totalSections) * 100;
        progressFill.style.width = `${progressPercentage}%`;
        progressText.textContent = `Progression : ${completedCount}/${totalSections} étapes complétées`;
      }
      
      // Mettre à jour l'état des sections
      for (let i = 1; i <= totalSections; i++) {
        const section = document.getElementById(`section-${i}`);
        const number = document.getElementById(`number-${i}`);
        const lockOverlay = document.getElementById(`lock-${i}`);
        
        if (section && number) {
          // Section complétée
          if (gameState.completedSections.includes(i)) {
            section.classList.remove('locked', 'current');
            section.classList.add('completed');
            number.classList.remove('locked');
            number.classList.add('completed');
            if (lockOverlay) lockOverlay.style.display = 'none';
          }
          // Section actuelle (disponible)
          else if (i === 1 || gameState.completedSections.includes(i - 1)) {
            section.classList.remove('locked', 'completed');
            section.classList.add('current');
            number.classList.remove('locked', 'completed');
            if (lockOverlay) lockOverlay.style.display = 'none';
          }
          // Section verrouillée
          else {
            section.classList.remove('current', 'completed');
            section.classList.add('locked');
            number.classList.remove('completed');
            number.classList.add('locked');
            if (lockOverlay) lockOverlay.style.display = 'flex';
          }
        }
      }
    }

    // === QUIZ DE VALIDATION ===

    function initializeValidationQuizzes() {
      for (let section = 1; section <= 5; section++) {
        validationStates[section] = {
          answers: {},
          completed: false,
          score: 0
        };
        
        // Activer les listeners pour cette section
        const options = document.querySelectorAll(`#validation-quiz-${section} .validation-option`);
        options.forEach(option => {
          option.addEventListener('click', function() {
            selectValidationAnswer(section, option);
          });
        });
      }
    }

    function showValidationQuiz(section) {
      document.getElementById(`complete-${section}`).style.display = 'none';
      document.getElementById(`validation-quiz-${section}`).style.display = 'block';
      
      // Scroll vers le quiz
      document.getElementById(`validation-quiz-${section}`).scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }

    function selectValidationAnswer(section, clickedOption) {
      const questionDiv = clickedOption.parentElement.parentElement;
      const questionNumber = parseInt(questionDiv.dataset.question);
      const answerValue = parseInt(clickedOption.dataset.answer);
      
      // Désélectionner toutes les options de cette question
      const allOptions = questionDiv.querySelectorAll('.validation-option');
      allOptions.forEach(opt => opt.classList.remove('selected'));
      
      // Sélectionner l'option cliquée
      clickedOption.classList.add('selected');
      
      // Sauvegarder la réponse
      validationStates[section].answers[questionNumber] = answerValue;
      
      // Vérifier si toutes les questions ont une réponse
      const totalQuestions = document.querySelectorAll(`#validation-quiz-${section} .validation-question`).length;
      const answeredQuestions = Object.keys(validationStates[section].answers).length;
      
      if (answeredQuestions === totalQuestions) {
        document.getElementById(`check-validation-${section}`).disabled = false;
      }
    }

    function checkValidationQuiz(section) {
      const correctAnswers = VALIDATION_ANSWERS[section];
      let score = 0;
      
      // Vérifier chaque réponse
      for (let questionNum = 1; questionNum <= correctAnswers.length; questionNum++) {
        const userAnswer = validationStates[section].answers[questionNum];
        const correctAnswer = correctAnswers[questionNum - 1];
        const questionDiv = document.querySelector(`#validation-quiz-${section} .validation-question[data-question="${questionNum}"]`);
        const options = questionDiv.querySelectorAll('.validation-option');
        const feedbackSpan = questionDiv.querySelector('.feedback-text');
        
        if (userAnswer === correctAnswer) {
          score++;
          options[userAnswer].classList.add('correct');
          feedbackSpan.innerHTML = '<span style="color: #2ecc71;"><i class="fas fa-check"></i> Correct !</span>';
        } else {
          options[userAnswer].classList.add('incorrect');
          options[correctAnswer].classList.add('correct');
          feedbackSpan.innerHTML = '<span style="color: #e74c3c;"><i class="fas fa-times"></i> Incorrect. La bonne réponse est surlignée.</span>';
        }
      }
      
      validationStates[section].score = score;
      validationStates[section].completed = true;
      
      // Afficher le score
      const scoreDiv = document.getElementById(`validation-score-${section}`);
      const percentage = Math.round((score / correctAnswers.length) * 100);
      
      if (score === correctAnswers.length) {
        scoreDiv.innerHTML = `<span style="color: #2ecc71; font-size: 1.1rem;"><i class="fas fa-trophy"></i> Score parfait : ${score}/${correctAnswers.length} (${percentage}%)</span>`;
        document.getElementById(`continue-validation-${section}`).style.display = 'inline-block';
      } else {
        scoreDiv.innerHTML = `<span style="color: #f39c12;"><i class="fas fa-info-circle"></i> Score : ${score}/${correctAnswers.length} (${percentage}%)</span>`;
        document.getElementById(`continue-validation-${section}`).style.display = 'inline-block';
      }
      
      document.getElementById(`check-validation-${section}`).style.display = 'none';
    }

    function continueAfterValidation(section) {
      if (!gameState.completedSections.includes(section)) {
        gameState.completedSections.push(section);
        gameState.currentSection = section + 1;
        
        // 🎁 DONNER LES RÉCOMPENSES DE SECTION
        giveSectionReward(section);
      }
      
      updateCourseInterface();
      saveGameState();
      
      // Scroll vers la prochaine section
      if (section < COURSE_CONFIG.totalSections) {
        setTimeout(() => {
          document.getElementById(`section-${section + 1}`).scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }, 500);
      }
    }

    // === QUIZ D'ENTRAINEMENT ===

    function startPracticeQuiz() {
      practiceQuizData.questions = [...PRACTICE_QUESTIONS];
      practiceQuizData.currentIndex = 0;
      practiceQuizData.userAnswers = {};
      practiceQuizData.isActive = true;
      
      document.getElementById('start-practice-quiz').style.display = 'none';
      document.getElementById('practiceQuizContainer').style.display = 'block';
      
      showPracticeQuestion();
    }

    function showPracticeQuestion() {
      const currentQuestion = practiceQuizData.questions[practiceQuizData.currentIndex];
      const questionText = document.getElementById('practiceQuestionText');
      const questionOptions = document.getElementById('practiceQuestionOptions');
      const currentQ = document.getElementById('practiceCurrentQ');
      const progressFill = document.getElementById('practiceProgressFill');
      
      currentQ.textContent = practiceQuizData.currentIndex + 1;
      questionText.textContent = currentQuestion.question;
      progressFill.style.width = `${((practiceQuizData.currentIndex + 1) / PRACTICE_QUESTIONS.length) * 100}%`;
      
      questionOptions.innerHTML = '';
      currentQuestion.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'quiz-option';
        optionElement.textContent = option;
        optionElement.addEventListener('click', () => selectPracticeAnswer(index));
        
        if (practiceQuizData.userAnswers[practiceQuizData.currentIndex] === index) {
          optionElement.classList.add('selected');
        }
        
        questionOptions.appendChild(optionElement);
      });
      
      updatePracticeNavigation();
    }

    function selectPracticeAnswer(answerIndex) {
      practiceQuizData.userAnswers[practiceQuizData.currentIndex] = answerIndex;
      
      const options = document.querySelectorAll('#practiceQuestionOptions .quiz-option');
      options.forEach((option, index) => {
        option.classList.toggle('selected', index === answerIndex);
      });
      
      updatePracticeNavigation();
    }

    function updatePracticeNavigation() {
      const prevBtn = document.getElementById('practicePrevQuestion');
      const nextBtn = document.getElementById('practiceNextQuestion');
      const finishBtn = document.getElementById('practiceFinishQuiz');
      
      prevBtn.style.display = practiceQuizData.currentIndex > 0 ? 'inline-block' : 'none';
      
      const isLastQuestion = practiceQuizData.currentIndex === PRACTICE_QUESTIONS.length - 1;
      const allAnswered = Object.keys(practiceQuizData.userAnswers).length === PRACTICE_QUESTIONS.length;
      
      if (isLastQuestion) {
        nextBtn.style.display = 'none';
        finishBtn.style.display = allAnswered ? 'inline-block' : 'none';
        } else {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
      }
    }

    function practicePrevQuestion() {
      if (practiceQuizData.currentIndex > 0) {
        practiceQuizData.currentIndex--;
        showPracticeQuestion();
      }
    }

    function practiceNextQuestion() {
      if (practiceQuizData.currentIndex < PRACTICE_QUESTIONS.length - 1) {
        practiceQuizData.currentIndex++;
        showPracticeQuestion();
      }
    }

    function finishPracticeQuiz() {
      let correctAnswers = 0;
      
      practiceQuizData.questions.forEach((question, index) => {
        if (practiceQuizData.userAnswers[index] === question.correct) {
          correctAnswers++;
        }
      });
      
      practiceQuizData.score = correctAnswers;
      practiceQuizData.isActive = false;
      gameState.practiceScore = correctAnswers;
      gameState.practiceQuizCompleted = true;
      
      showPracticeResults();
          saveGameState();
    }

    function showPracticeResults() {
      document.getElementById('practiceQuizContainer').style.display = 'none';
      document.getElementById('practiceQuizResults').style.display = 'block';
      
      const score = practiceQuizData.score;
      const total = PRACTICE_QUESTIONS.length;
      const percentage = Math.round((score / total) * 100);
      
      const resultsContent = document.getElementById('practiceResultsContent');
      
      let resultsHTML = `
        <div style="text-align: center; padding: 2rem; background: var(--color-surface-hover); border-radius: 1rem; margin: 1rem 0;">
          <h3>Résultats du Quiz d'Entraînement</h3>
          <p style="font-size: 1.5rem; margin: 1rem 0;">Score : ${score}/${total} (${percentage}%)</p>
      `;
      
      if (percentage >= 80) {
        resultsHTML += `
          <p style="color: #2ecc71; font-weight: bold;">🎉 Excellent ! Vous êtes prêt pour le quiz final !</p>
        `;
      } else if (percentage >= 60) {
        resultsHTML += `
          <p style="color: #f39c12; font-weight: bold;">📚 Bon travail ! Révisez les points faibles avant le quiz final.</p>
        `;
      } else {
        resultsHTML += `
          <p style="color: #e74c3c; font-weight: bold;">💪 Continuez à étudier ! Reprenez les sections difficiles.</p>
        `;
      }
      
      resultsHTML += `</div>`;
      
      // Ajouter les explications détaillées
      resultsHTML += `<div style="margin-top: 2rem;"><h4>Explications détaillées :</h4>`;
      
      practiceQuizData.questions.forEach((question, index) => {
        const userAnswer = practiceQuizData.userAnswers[index];
        const isCorrect = userAnswer === question.correct;
        
        resultsHTML += `
          <div style="margin: 1rem 0; padding: 1rem; background: var(--color-surface); border-radius: 0.5rem; border-left: 4px solid ${isCorrect ? '#2ecc71' : '#e74c3c'};">
            <p><strong>Question ${index + 1}:</strong> ${question.question}</p>
            <p><strong>Votre réponse:</strong> ${question.options[userAnswer]} ${isCorrect ? '✅' : '❌'}</p>
            ${!isCorrect ? `<p><strong>Bonne réponse:</strong> ${question.options[question.correct]}</p>` : ''}
            <p><strong>Explication:</strong> ${question.explanation}</p>
          </div>
        `;
      });
      
      resultsHTML += `</div>`;
      resultsContent.innerHTML = resultsHTML;
    }

    // === QUIZ FINAL ===

    // Variables globales pour le quiz final
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let score = 0;

    function startFinalQuiz() {
      // Réinitialiser les variables
      currentQuestionIndex = 0;
      userAnswers = Array(FINAL_QUESTIONS.length).fill(null);
      score = 0;
      
      document.getElementById('start-final-quiz').style.display = 'none';
      document.getElementById('finalQuizContainer').style.display = 'block';
      
      displayQuestion(false); // false = final quiz (pas training)
      updateQuizProgress(false);
    }

    function displayQuestion(isTraining) {
      const questions = FINAL_QUESTIONS;
      const question = questions[currentQuestionIndex];
      const container = document.getElementById('finalCurrentQuestion');
      
      container.innerHTML = `
        <div class="question-text">
          <strong>Question ${currentQuestionIndex + 1}:</strong> ${question.question}
          </div>
        <div class="quiz-options">
          ${question.options.map((option, index) => `
            <div class="quiz-option" data-option="${index}" onclick="selectOption(${index}, ${isTraining})">
              ${String.fromCharCode(65 + index)}. ${option}
            </div>
          `).join('')}
        </div>
      `;

      // Restaurer la sélection précédente si elle existe
      if (userAnswers[currentQuestionIndex] !== null) {
        const selectedOption = container.querySelector(`[data-option="${userAnswers[currentQuestionIndex]}"]`);
        if (selectedOption) {
          selectedOption.classList.add('selected');
        }
      }

      updateNavigationButtons(false);
    }

    function selectOption(optionIndex, isTraining) {
      // Retirer la sélection précédente
      document.querySelectorAll('#finalCurrentQuestion .quiz-option').forEach(option => {
        option.classList.remove('selected');
      });

      // Ajouter la nouvelle sélection
      const selectedOption = document.querySelector(`#finalCurrentQuestion [data-option="${optionIndex}"]`);
      selectedOption.classList.add('selected');

      // Sauvegarder la réponse
      userAnswers[currentQuestionIndex] = optionIndex;

      updateNavigationButtons(false);
      updateQuizProgress(false);
    }

    function updateNavigationButtons(isTraining) {
      const questions = FINAL_QUESTIONS;
      
      const prevBtn = document.getElementById('finalPrevQuestion');
      const nextBtn = document.getElementById('finalNextQuestion');
      const finishBtn = document.getElementById('finalFinishQuiz');

      prevBtn.disabled = currentQuestionIndex === 0;
      prevBtn.onclick = () => previousQuestion(false);
      
      if (currentQuestionIndex === questions.length - 1) {
        nextBtn.style.display = 'none';
        finishBtn.style.display = 'inline-block';
        finishBtn.disabled = userAnswers[currentQuestionIndex] === null;
        finishBtn.onclick = () => finishQuiz(false);
      } else {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
        nextBtn.disabled = userAnswers[currentQuestionIndex] === null;
        nextBtn.onclick = () => nextQuestion(false);
      }
    }

    function previousQuestion(isTraining) {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        displayQuestion(false);
        updateQuizProgress(false);
      }
    }

    function nextQuestion(isTraining) {
      const questions = FINAL_QUESTIONS;
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        displayQuestion(false);
        updateQuizProgress(false);
      }
    }

    function updateQuizProgress(isTraining) {
      const questions = FINAL_QUESTIONS;
      
      const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
      document.getElementById('finalQuizProgressFill').style.width = progress + '%';
      document.getElementById('finalQuestionCounter').textContent = `Question ${currentQuestionIndex + 1}/${questions.length}`;
      
      const answeredQuestions = userAnswers.filter(answer => answer !== null).length;
      document.getElementById('finalCurrentScore').textContent = `Répondu: ${answeredQuestions}/${questions.length}`;
    }

    function finishQuiz(isTraining) {
      const questions = FINAL_QUESTIONS;
      
      // Calculer le score
      score = 0;
      for (let i = 0; i < questions.length; i++) {
        if (userAnswers[i] === questions[i].correct) {
          score++;
        }
      }

      // Marquer le quiz comme terminé
      finalQuizData.score = score;
      finalQuizData.isActive = false;
      gameState.finalScore = score;
      gameState.finalQuizCompleted = true;
      
      // 🏆 DONNER LES RÉCOMPENSES DU QUIZ FINAL
      giveFinalQuizReward(score, questions.length);
      
      displayResults(false);
      saveGameState();
      
      // Sauvegarder la réussite dans Firebase si connecté
      if (typeof saveUserProgress === 'function') {
        saveUserProgress(COURSE_CONFIG.courseId, {
          completed: score >= COURSE_CONFIG.finalPassingScore,
          score: score,
          maxScore: FINAL_QUESTIONS.length,
          completedAt: new Date().toISOString()
        });
      }
    }

    function displayResults(isTraining) {
      const questions = FINAL_QUESTIONS;
      
      document.getElementById('finalQuizContainer').style.display = 'none';
      document.getElementById('finalQuizResults').style.display = 'block';

      const percentage = (score / questions.length) * 100;
      let badgeClass, badgeText, badgeIcon;

      if (score >= 18) {
        badgeClass = 'badge-master';
        badgeText = `🏆 MAÎTRE DU SUPERLATIF ! ${score}/${questions.length}`;
        badgeIcon = '👑';
      } else if (score >= 16) {
        badgeClass = 'badge-good';
        badgeText = `🎉 COURS VALIDÉ ! ${score}/${questions.length}`;
        badgeIcon = '🎉';
      } else {
        badgeClass = 'badge-retry';
        badgeText = `📚 Score Insuffisant ${score}/${questions.length}`;
        badgeIcon = '💪';
      }

      document.getElementById('finalResultBadge').innerHTML = `
        <div class="${badgeClass}">
          ${badgeIcon} ${badgeText}
        </div>
      `;

      // Détails des résultats
      const breakdown = questions.map((question, index) => {
        const userAnswer = userAnswers[index];
        const isCorrect = userAnswer === question.correct;
        const userAnswerText = userAnswer !== null ? question.options[userAnswer] : 'Non répondu';
        const correctAnswerText = question.options[question.correct];

        return `
          <div style="margin: 1rem 0; padding: 1rem; border-radius: 8px; background: ${isCorrect ? 'rgba(46, 204, 113, 0.1)' : 'rgba(231, 76, 60, 0.1)'};">
            <strong>Q${index + 1}:</strong> ${question.question}<br>
            <span style="color: ${isCorrect ? '#2ecc71' : '#e74c3c'};">
              Votre réponse: ${userAnswerText} ${isCorrect ? '✅' : '❌'}
            </span><br>
            ${!isCorrect ? `<span style="color: #2ecc71;">Bonne réponse: ${correctAnswerText}</span><br>` : ''}
          </div>
        `;
      }).join('');

      document.getElementById('finalResultBreakdown').innerHTML = breakdown;
      
      // Afficher le bouton de certificat si quiz final réussi
      if (score >= 16) {
        document.getElementById('downloadCertificate').style.display = 'inline-block';
      }
      
      // Setup review button
      document.getElementById('finalReviewAnswers').onclick = () => reviewAnswers(false);
    }

    function reviewAnswers(isTraining) {
      document.getElementById('finalQuizResults').style.display = 'none';
      document.getElementById('finalQuizContainer').style.display = 'block';
      
      currentQuestionIndex = 0;
      displayQuestionWithAnswers(false);
    }

    function displayQuestionWithAnswers(isTraining) {
      const questions = FINAL_QUESTIONS;
      const question = questions[currentQuestionIndex];
      const container = document.getElementById('finalCurrentQuestion');
      
      container.innerHTML = `
        <div class="question-text">
          <strong>Question ${currentQuestionIndex + 1}:</strong> ${question.question}
        </div>
        <div class="quiz-options">
          ${question.options.map((option, index) => {
            let className = 'quiz-option';
            if (index === question.correct) className += ' correct';
            else if (index === userAnswers[currentQuestionIndex] && index !== question.correct) className += ' incorrect';
            else if (index === userAnswers[currentQuestionIndex]) className += ' selected';
            
            return `<div class="${className}">${String.fromCharCode(65 + index)}. ${option}</div>`;
          }).join('')}
        </div>
      `;

      // Mettre à jour les boutons de navigation pour la révision
      const prevBtn = document.getElementById('finalPrevQuestion');
      const nextBtn = document.getElementById('finalNextQuestion');
      const finishBtn = document.getElementById('finalFinishQuiz');

      prevBtn.disabled = currentQuestionIndex === 0;
      prevBtn.onclick = () => {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          displayQuestionWithAnswers(false);
        }
      };

      if (currentQuestionIndex === questions.length - 1) {
        nextBtn.style.display = 'none';
        finishBtn.style.display = 'inline-block';
        finishBtn.textContent = '🔙 Retour aux Résultats';
        finishBtn.disabled = false;
        finishBtn.onclick = () => displayResults(false);
      } else {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
        nextBtn.disabled = false;
        nextBtn.onclick = () => {
          currentQuestionIndex++;
          displayQuestionWithAnswers(false);
        };
      }
    }

    // === SAUVEGARDE ET CHARGEMENT ===

    function saveGameState() {
      localStorage.setItem('superlative-course-game-state', JSON.stringify(gameState));
    }

    function loadGameState() {
      const savedState = localStorage.getItem('superlative-course-game-state');
      if (savedState) {
        try {
          const loadedState = JSON.parse(savedState);
          gameState = { ...gameState, ...loadedState };
          
          // S'assurer que la structure rewardsGiven existe (rétrocompatibilité)
          if (!gameState.rewardsGiven) {
            gameState.rewardsGiven = {
              sections: [],
              finalQuiz: false
            };
          }
          if (!gameState.rewardsGiven.sections) {
            gameState.rewardsGiven.sections = [];
          }
          if (gameState.rewardsGiven.finalQuiz === undefined) {
            gameState.rewardsGiven.finalQuiz = false;
          }
        } catch (e) {
          console.error('Erreur lors du chargement de l\'état du jeu:', e);
        }
      }
    }

    // Charger l'état au démarrage
    loadGameState();

    // Import du service de récompenses
    let rewardService = null;
    
    // Initialiser le service de récompenses quand il est disponible
    async function initializeRewardService() {
      try {
        const module = await import('../scripts/reward-service.js');
        rewardService = module.rewardService;
        console.log('✅ [Superlative Course] Service de récompenses initialisé');
      } catch (error) {
        console.warn('⚠️ [Superlative Course] Impossible de charger le service de récompenses:', error);
      }
    }

    // Fonction pour donner des récompenses de section
    async function giveSectionReward(sectionNumber) {
      if (!rewardService || !rewardService.canGiveRewards()) {
        console.log('🔒 [Superlative Course] Pas d\'utilisateur connecté pour les récompenses de section');
        return;
      }

      // Vérifier si les récompenses ont déjà été données pour cette section
      if (gameState.rewardsGiven.sections.includes(sectionNumber)) {
        console.log(`🚫 [Superlative Course] Récompenses déjà données pour la section ${sectionNumber}`);
        showCourseRewardMessage(`🎓 Section ${sectionNumber} terminée ! (Récompenses déjà reçues)`, false, 'info');
        return;
      }

      try {
        console.log(`🎁 [Superlative Course] Attribution des récompenses pour la section ${sectionNumber}`);
        
        const rewards = { xp: 1, coins: 1 }; // 1 XP et 1 or par section
        const result = await rewardService.giveRewards(rewards, false, 'superlative-course');
        
        if (result.success) {
          // Marquer les récompenses comme données
          gameState.rewardsGiven.sections.push(sectionNumber);
          saveGameState();
          
          console.log(`✅ [Superlative Course] Récompenses de section ${sectionNumber} attribuées: +1 XP, +1 or`);
          showCourseRewardMessage(`🎓 Section ${sectionNumber} terminée ! +1 ⭐ XP et +1 🪙 or`);
        }
      } catch (error) {
        console.error('❌ [Superlative Course] Erreur lors de l\'attribution des récompenses de section:', error);
      }
    }

    // Fonction pour donner des récompenses de quiz final
    async function giveFinalQuizReward(score, totalQuestions) {
      if (!rewardService || !rewardService.canGiveRewards()) {
        console.log('🔒 [Superlative Course] Pas d\'utilisateur connecté pour les récompenses du quiz final');
        return;
      }

      // Vérifier si les récompenses du quiz final ont déjà été données
      if (gameState.rewardsGiven.finalQuiz) {
        console.log('🚫 [Superlative Course] Récompenses du quiz final déjà données');
        if (score >= 16) {
          const message = score >= 18 ? 
            '🏆 MAÎTRE DU SUPERLATIF ! (Récompenses déjà reçues)' : 
            '🎉 COURS VALIDÉ ! (Récompenses déjà reçues)';
          showCourseRewardMessage(message, score >= 18, 'info');
        }
        return;
      }

      try {
        console.log(`🏆 [Superlative Course] Attribution des récompenses pour le quiz final: ${score}/${totalQuestions}`);
        
        let rewards = { xp: 0, coins: 0 };
        let message = '';
        
        if (score >= 18) {
          // 18-20: Maître du Superlatif
          rewards = { xp: 20, coins: 20 };
          message = `🏆 MAÎTRE DU SUPERLATIF ! +20 ⭐ XP et +20 🪙 or !`;
        } else if (score >= 16) {
          // 16-17: Cours validé
          rewards = { xp: 10, coins: 10 };
          message = `🎉 COURS VALIDÉ ! +10 ⭐ XP et +10 🪙 or !`;
        } else {
          // Score insuffisant, pas de récompenses
          console.log('📚 [Superlative Course] Score insuffisant pour les récompenses du quiz final');
          return;
        }
        
        const result = await rewardService.giveRewards(rewards, score >= 18, 'superlative-course-final');
        
        if (result.success) {
          // Marquer les récompenses du quiz final comme données
          gameState.rewardsGiven.finalQuiz = true;
          saveGameState();
          
          console.log(`✅ [Superlative Course] Récompenses du quiz final attribuées: +${rewards.xp} XP, +${rewards.coins} or`);
          showCourseRewardMessage(message, score >= 18);
        }
      } catch (error) {
        console.error('❌ [Superlative Course] Erreur lors de l\'attribution des récompenses du quiz final:', error);
      }
    }

    // Fonction pour afficher les messages de récompense du cours
    function showCourseRewardMessage(message, isTopReward = false, type = 'success') {
      // Créer un élément de notification
      const notification = document.createElement('div');
      notification.className = `course-reward-notification ${isTopReward ? 'top-reward' : ''} ${type}`;
      notification.innerHTML = `
        <div class="reward-content">
          <div class="reward-icon">
            ${type === 'info' ? 'ℹ️' : isTopReward ? '🏆' : '🎓'}
          </div>
          <div class="reward-text">${message}</div>
        </div>
      `;

      // Couleurs selon le type
      let backgroundColor;
      if (type === 'info') {
        backgroundColor = 'linear-gradient(135deg, #3498db, #2980b9)';
      } else if (isTopReward) {
        backgroundColor = 'linear-gradient(135deg, #f39c12, #e67e22)';
      } else {
        backgroundColor = 'linear-gradient(135deg, #9b59b6, #8e44ad)';
      }

      // Styles pour la notification
      notification.style.cssText = `
        position: fixed;
        top: 120px;
        right: 20px;
        background: ${backgroundColor};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 10000;
        font-family: 'Exo 2', sans-serif;
        font-weight: 600;
        max-width: 350px;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        border: 2px solid rgba(255,255,255,0.2);
      `;

      // Ajouter au DOM
      document.body.appendChild(notification);

      // Animation d'entrée
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);

      // Animation de sortie et suppression
      setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, type === 'info' ? 3000 : isTopReward ? 6000 : 4000);
    }
  </script>

  <!-- Scripts d'authentification - exactement comme les jeux -->
  <script type="module" src="../scripts/auth-service.js"></script>
  <script type="module" src="../scripts/auth-header.js"></script>
  
  <!-- Désactiver le menu mobile de new-design.js pour éviter les conflits -->
  <script>
    window.disableNewDesignMobileMenu = true;
  </script>
  <script src="../scripts/new-design.js"></script>
  
  <!-- Gestion universelle du menu mobile et synchronisation auth -->
  <script src="../scripts/universal-mobile-auth.js" defer></script>
</body>
</html> 