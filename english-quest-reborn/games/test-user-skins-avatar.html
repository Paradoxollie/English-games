<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Test Avatar Utilisateur - Enigma Scroll</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        .test-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .test-section h2 {
            color: #ffeb3b;
            margin-bottom: 15px;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .skin-selector {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .skin-selector h3 {
            margin: 0 0 10px 0;
            color: #4fc3f7;
        }
        
        .skin-selector select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: none;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(145deg, #FF9800, #F57C00);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(145deg, #f44336, #d32f2f);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .status {
            background: rgba(0,255,0,0.1);
            border: 2px solid rgba(0,255,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .current-user-info {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .current-user-info pre {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 12px;
        }
        
        .avatar-preview {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }
        
        .avatar-preview h3 {
            margin: 0 0 10px 0;
            text-align: center;
            color: #ffeb3b;
        }
        
        .logs {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(0,123,255,0.2); }
        .log-success { background: rgba(40,167,69,0.2); }
        .log-warning { background: rgba(255,193,7,0.2); }
        .log-error { background: rgba(220,53,69,0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Test Avatar Utilisateur - Enigma Scroll</h1>
        
        <div class="test-section">
            <h2>üîß Configuration Utilisateur Simul√©</h2>
            <p>Configurez un profil utilisateur simul√© avec diff√©rents skins pour tester l'avatar du jeu.</p>
            
            <div class="control-panel">
                <div class="skin-selector">
                    <h3>üë® T√™te</h3>
                    <select id="head-selector">
                        <option value="default_boy">Gar√ßon (d√©faut)</option>
                        <option value="default_girl">Fille</option>
                        <option value="bear">Ours</option>
                        <option value="wizard">Sorcier</option>
                        <option value="knight">Chevalier</option>
                    </select>
                </div>
                
                <div class="skin-selector">
                    <h3>üëï Corps</h3>
                    <select id="body-selector">
                        <option value="default_boy">Corps Gar√ßon (d√©faut)</option>
                        <option value="default_girl">Corps Fille</option>
                        <option value="bear">Corps Ours</option>
                        <option value="wizard">Robe Sorcier</option>
                        <option value="knight">Armure Chevalier</option>
                    </select>
                </div>
                
                <div class="skin-selector">
                    <h3>üé≠ Accessoire</h3>
                    <select id="accessory-selector">
                        <option value="default">Accessoire Anim√© (d√©faut)</option>
                        <option value="none">Aucun</option>
                        <option value="glasses">Lunettes</option>
                        <option value="hat">Chapeau</option>
                        <option value="crown">Couronne</option>
                    </select>
                </div>
                
                <div class="skin-selector">
                    <h3>üåÑ Arri√®re-plan</h3>
                    <select id="background-selector">
                        <option value="default">D√©faut</option>
                        <option value="forest">For√™t</option>
                        <option value="castle">Ch√¢teau</option>
                        <option value="space">Espace</option>
                        <option value="underwater">Sous-marin</option>
                    </select>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="applyUserSkins()">
                    üé® Appliquer Skins
                </button>
                <button class="btn btn-secondary" onclick="simulateProfileSave()">
                    üíæ Simuler Sauvegarde Profil
                </button>
                <button class="btn btn-warning" onclick="resetToDefaults()">
                    üîÑ Reset D√©fauts
                </button>
                <button class="btn btn-danger" onclick="clearUserData()">
                    üóëÔ∏è Effacer Donn√©es
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìä √âtat Actuel</h2>
            <div class="current-user-info">
                <h3>Utilisateur dans localStorage :</h3>
                <pre id="current-user-data">Chargement...</pre>
            </div>
            
            <div class="status">
                <strong>Status :</strong> <span id="status-text">Pr√™t</span>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üéÆ Actions Test Avatar</h2>
            <div class="buttons">
                <button class="btn btn-primary" onclick="testAvatarMessage()">
                    üí¨ Test Message
                </button>
                <button class="btn btn-secondary" onclick="testAvatarAnimation()">
                    üé≠ Test Animation
                </button>
                <button class="btn btn-warning" onclick="testAvatarReaction()">
                    ‚ö° Test R√©action
                </button>
                <button class="btn btn-primary" onclick="forceRefreshAvatar()">
                    üîÑ Forcer Refresh
                </button>
                <button class="btn btn-danger" onclick="forceInitAvatar()">
                    üöÄ Forcer Initialisation
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìù Logs Syst√®me</h2>
            <div class="logs" id="system-logs">
                <div class="log-entry log-info">Syst√®me de test initialis√©...</div>
            </div>
        </div>
    </div>
    
    <div class="avatar-preview">
        <h3>üéØ Avatar Actuel</h3>
        <p>L'avatar appara√Ætra ici ‚Üí</p>
        <small>Position fixe en haut √† droite</small>
    </div>

    <!-- Inclure le syst√®me d'avatar -->
    <script src="enigma-scroll-avatar-simple.js"></script>
    
    <script>
        // Variables globales
        let testUser = {
            username: "TestUser",
            avatar: {
                head: "default_boy",
                body: "default_boy", 
                accessory: "default",
                background: "default"
            }
        };
        
        // Variables pour √©viter la boucle infinie
        const originalConsoleLog = console.log;
        
        // Fonctions de test
        function logMessage(message, type = 'info') {
            const logs = document.getElementById('system-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
            // Utiliser originalConsoleLog pour √©viter la boucle infinie
            originalConsoleLog(`[Test] ${message}`);
        }
        
        function updateStatus(text) {
            document.getElementById('status-text').textContent = text;
        }
        
        function updateUserDisplay() {
            document.getElementById('current-user-data').textContent = 
                JSON.stringify(testUser, null, 2);
        }
        
        function applyUserSkins() {
            const head = document.getElementById('head-selector').value;
            const body = document.getElementById('body-selector').value;
            const accessory = document.getElementById('accessory-selector').value;
            const background = document.getElementById('background-selector').value;
            
            testUser.avatar = { head, body, accessory, background };
            
            // Mettre √† jour le localStorage
            localStorage.setItem('english_quest_current_user', JSON.stringify(testUser));
            
            logMessage(`Skins appliqu√©s: ${head}, ${body}, ${accessory}, ${background}`, 'success');
            updateStatus('Skins appliqu√©s');
            updateUserDisplay();
            
            // Forcer la mise √† jour de l'avatar
            if (typeof window.updateEnigmaAvatarFromProfile === 'function') {
                const success = window.updateEnigmaAvatarFromProfile(testUser.avatar);
                if (success) {
                    logMessage('Avatar mis √† jour avec succ√®s', 'success');
                } else {
                    logMessage('√âchec de la mise √† jour avatar', 'error');
                }
            } else {
                logMessage('Fonction updateEnigmaAvatarFromProfile non disponible', 'warning');
            }
        }
        
        function simulateProfileSave() {
            applyUserSkins();
            logMessage('Simulation de sauvegarde profil termin√©e', 'info');
            updateStatus('Profil sauvegard√© (simul√©)');
        }
        
        function resetToDefaults() {
            document.getElementById('head-selector').value = 'default_boy';
            document.getElementById('body-selector').value = 'default_boy';
            document.getElementById('accessory-selector').value = 'default';
            document.getElementById('background-selector').value = 'default';
            
            applyUserSkins();
            logMessage('Reset aux valeurs par d√©faut', 'info');
            updateStatus('Reset effectu√©');
        }
        
        function clearUserData() {
            localStorage.removeItem('english_quest_current_user');
            testUser = {
                username: "TestUser",
                avatar: {
                    head: "default_boy",
                    body: "default_boy",
                    accessory: "default", 
                    background: "default"
                }
            };
            updateUserDisplay();
            logMessage('Donn√©es utilisateur effac√©es', 'warning');
            updateStatus('Donn√©es effac√©es');
        }
        
        function testAvatarMessage() {
            if (window.enigmaAvatar) {
                window.enigmaAvatar.testMessage();
                logMessage('Test message avatar lanc√©', 'info');
            } else {
                logMessage('Avatar non disponible pour test message', 'error');
            }
        }
        
        function testAvatarAnimation() {
            if (window.enigmaAvatar) {
                window.enigmaAvatar.testAnimation();
                logMessage('Test animation avatar lanc√©', 'info');
            } else {
                logMessage('Avatar non disponible pour test animation', 'error');
            }
        }
        
        function testAvatarReaction() {
            if (window.enigmaAvatar) {
                window.enigmaAvatar.testReaction();
                logMessage('Test r√©action avatar lanc√©', 'info');
            } else {
                logMessage('Avatar non disponible pour test r√©action', 'error');
            }
        }
        
        function forceRefreshAvatar() {
            if (typeof window.refreshEnigmaAvatarSkins === 'function') {
                const success = window.refreshEnigmaAvatarSkins();
                logMessage('Refresh avatar forc√©: ' + (success ? 'succ√®s' : '√©chec'), success ? 'success' : 'warning');
            } else {
                logMessage('Fonction refresh non disponible', 'error');
            }
        }
        
        function forceInitAvatar() {
            if (typeof window.forceInitEnigmaAvatar === 'function') {
                const success = window.forceInitEnigmaAvatar();
                logMessage('Initialisation forc√©e: ' + (success ? 'succ√®s' : '√©chec'), success ? 'success' : 'error');
                updateStatus(success ? 'Avatar initialis√©' : '√âchec initialisation');
            } else {
                logMessage('Fonction d\'initialisation forc√©e non disponible', 'error');
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            logMessage('Page de test charg√©e', 'success');
            
            // Mettre en place l'utilisateur de test
            localStorage.setItem('english_quest_current_user', JSON.stringify(testUser));
            updateUserDisplay();
            updateStatus('Pr√™t pour tests');
            
            // V√©rifier p√©riodiquement l'√©tat de l'avatar
            setInterval(() => {
                updateUserDisplay();
                
                if (window.enigmaAvatar && window.enigmaAvatar.isInitialized) {
                    updateStatus('Avatar actif et initialis√©');
                } else if (window.enigmaAvatar) {
                    updateStatus('Avatar cr√©√© mais non initialis√©');
                } else {
                    updateStatus('Avatar non disponible');
                }
            }, 2000);
            
            logMessage('Syst√®me de test initialis√© avec succ√®s', 'success');
        });
        
        // Capturer les logs de l'avatar (CORRIG√â - pas de boucle infinie)
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            
            const message = args.join(' ');
            if (message.includes('[EnigmaAvatar]')) {
                // Utiliser originalConsoleLog directement pour √©viter la boucle infinie
                const logs = document.getElementById('system-logs');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry log-info';
                logEntry.textContent = `[${timestamp}] ${message}`;
                logs.appendChild(logEntry);
                logs.scrollTop = logs.scrollHeight;
            }
        };
    </script>
</body>
</html> 