<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Speed Verb Challenge - Ma√Ætrisez les verbes irr√©guliers anglais">
    <meta name="theme-color" content="#121212">
    <title>Speed Verb Challenge | English Quest</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Exo+2:wght@300;400;600;700&family=Spectral:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Firebase v8 pour compatibilit√© avec le syst√®me existant -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Scripts d'authentification -->
    <script type="module" src="../scripts/auth-service.js"></script>
    <script type="module" src="../scripts/auth-header.js"></script>
    <script type="module" src="../scripts/reward-service.js"></script>

    <style>
        :root {
            --color-primary: #f39c12;
            --color-secondary: #e67e22;
            --color-accent: #3498db;
            --color-background: #121212;
            --color-surface: #1e1e1e;
            --color-surface-hover: #2a2a2a;
            --color-text-primary: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --verb-correct: #27ae60;
            --verb-incorrect: #e74c3c;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 1rem;
            --transition-normal: 0.3s ease;
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: 1.5;
            min-height: 100vh;
            padding-top: 80px;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(243, 156, 18, 0.2);
            z-index: 1000;
            padding: 1rem 0;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-primary);
            text-decoration: none;
            letter-spacing: 1px;
        }

        .logo span {
            color: var(--color-text-primary);
        }

        .nav-list {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all var(--transition-normal);
            padding: 0.5rem 0;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--color-primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-login {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-md);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-normal);
            border: none;
            cursor: pointer;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            width: 100%;
        }

        .game-interface {
            width: 100%;
            text-align: center;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .section-title {
            background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
            font-size: 3rem;
            margin-bottom: 1rem;
            font-family: 'Cinzel', serif;
        }

        .game-subtitle {
            color: var(--color-text-secondary);
            font-size: 1.2rem;
            margin-bottom: 2rem;
            font-family: 'Spectral', serif;
        }

        .difficulty-selection {
            margin: 2rem 0;
        }

        .difficulty-selection h3 {
            color: var(--color-text-primary);
            margin-bottom: 1.5rem;
            font-family: 'Cinzel', serif;
        }

        .difficulty-options {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem 1rem;
            background: var(--color-surface);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            color: var(--color-text-primary);
            min-width: 120px;
        }

        .difficulty-btn:hover {
            background: var(--color-surface-hover);
            border-color: var(--color-primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .difficulty-btn.active {
            background: var(--color-primary);
            color: var(--color-background);
        }

        .difficulty-icon {
            font-size: 1.5rem;
            color: var(--color-primary);
        }

        .difficulty-btn.active .difficulty-icon {
            color: var(--color-background);
        }

        .game-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .game-button {
            padding: 1rem 2rem;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            font-family: 'Exo 2', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .primary-button {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: var(--color-background);
        }

        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .secondary-button {
            background: transparent;
            border: 1px solid var(--color-primary);
            color: var(--color-primary);
        }

        .secondary-button:hover {
            background-color: rgba(243, 156, 18, 0.1);
        }

        .game-hud {
            display: flex;
            justify-content: space-around;
            background: var(--color-surface);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .hud-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .hud-icon {
            color: var(--color-primary);
            font-size: 1.2rem;
        }

        .hud-label {
            font-size: 0.8rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hud-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-text-primary);
        }

        .verb-challenge {
            background: var(--color-surface);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
        }

        .verb-challenge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(243, 156, 18, 0.05) 50%, transparent 70%);
            animation: energyFlow 3s ease-in-out infinite;
        }

        @keyframes energyFlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }

        .verb-card {
            position: relative;
            z-index: 2;
        }

        .verb-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--color-primary);
            margin: 1rem 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: verbPulse 2s ease-in-out infinite;
        }

        @keyframes verbPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .verb-translation {
            font-size: 1rem;
            color: var(--color-text-secondary);
            font-style: italic;
            font-family: 'Spectral', serif;
        }

        .verb-inputs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }

        .verb-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .verb-input-label {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .verb-input {
            padding: 1rem;
            background: var(--color-background);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-md);
            color: var(--color-text-primary);
            font-size: 1.2rem;
            text-align: center;
            transition: all var(--transition-normal);
            font-family: 'Exo 2', sans-serif;
        }

        .verb-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);
        }

        .verb-input.correct {
            border-color: var(--verb-correct);
            background-color: rgba(39, 174, 96, 0.1);
            animation: correctFlash 0.5s ease;
        }

        .verb-input.incorrect {
            border-color: var(--verb-incorrect);
            background-color: rgba(231, 76, 60, 0.1);
            animation: incorrectShake 0.5s ease;
        }

        @keyframes correctFlash {
            0%, 100% { background-color: rgba(39, 174, 96, 0.1); }
            50% { background-color: rgba(39, 174, 96, 0.3); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .verb-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .feedback-message {
            text-align: center;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-normal);
        }

        .feedback-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .feedback-message.success {
            background-color: rgba(39, 174, 96, 0.2);
            border: 1px solid var(--verb-correct);
            color: var(--verb-correct);
        }

        .feedback-message.error {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--verb-incorrect);
            color: var(--verb-incorrect);
        }

        .leaderboard-panel {
            background: var(--color-surface);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            height: fit-content;
        }

        .leaderboard-panel h2 {
            color: var(--color-primary);
            margin-bottom: 1rem;
            font-family: 'Cinzel', serif;
            text-align: center;
        }

        .leaderboard-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .leaderboard-btn {
            flex: 1;
            padding: 0.5rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--color-text-secondary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .leaderboard-btn.active {
            background: var(--color-primary);
            color: var(--color-background);
            border-color: var(--color-primary);
        }

        .leaderboard-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table th {
            color: var(--color-primary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .leaderboard-table td {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .rank-gold { background: rgba(255, 215, 0, 0.1); }
        .rank-silver { background: rgba(192, 192, 192, 0.1); }
        .rank-bronze { background: rgba(205, 127, 50, 0.1); }

        .game-state {
            display: none;
        }

        .game-state.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-content {
            text-align: center;
            padding: 2rem;
        }

        .panel-title {
            font-size: 2rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            font-family: 'Cinzel', serif;
        }

        .welcome-text {
            color: var(--color-text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
            font-family: 'Spectral', serif;
        }

        .results-container {
            text-align: center;
            padding: 2rem;
        }

        .final-score {
            margin-bottom: 2rem;
        }

        .score-label {
            font-size: 1rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.5rem;
        }

        .score-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--color-primary);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-item {
            background: var(--color-background);
            padding: 1rem;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-text-primary);
        }

        @media (max-width: 1024px) {
            .game-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .section-title {
                font-size: 2rem;
            }

            .verb-display {
                font-size: 2rem;
            }

            .difficulty-options {
                flex-direction: column;
                align-items: center;
            }

            .difficulty-btn {
                width: 100%;
                max-width: 300px;
            }

            .verb-actions {
                flex-direction: column;
                align-items: center;
            }

            .game-button {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="../index.html" class="logo">ENGLISH<span>QUEST</span></a>

            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="../index.html" class="nav-link">Accueil</a></li>
                    <li><a href="../games.html" class="nav-link active">Jeux</a></li>
                    <li><a href="../courses.html" class="nav-link">Cours</a></li>
                    <li><a href="../gallery.html" class="nav-link">Galerie</a></li>
                    <li><a href="../leaderboard.html" class="nav-link">Classement</a></li>
                </ul>
            </nav>

            <div class="user-menu" id="userMenu">
                <a href="../login.html" class="btn-login" id="loginButton">Connexion</a>
                <a href="../profile.html" class="btn-login" id="profileButton" style="display: none;">Mon Profil</a>
            </div>
        </div>
    </header>

    <!-- Game container -->
    <div class="container">
        <div class="game-content">
            <!-- Interface de jeu principale -->
            <main class="game-interface">
                <!-- En-t√™te du jeu -->
                <div class="game-header-content">
                    <h1 class="section-title">Speed Verb Challenge</h1>
                    <p class="game-subtitle">Ma√Ætrisez les verbes irr√©guliers anglais dans une course contre la montre</p>
                </div>

                <!-- √âtats du jeu -->
                <div class="game-states">
                    <!-- √âtat: √©cran de bienvenue -->
                    <div id="welcome-screen" class="game-state active">
                        <div class="welcome-content">
                            <h2 class="panel-title">Bienvenue, Ma√Ætre des Verbes</h2>
                            <p class="welcome-text">
                                Pr√©parez-vous √† tester votre connaissance des verbes irr√©guliers anglais dans une course effr√©n√©e contre la montre.
                                Chaque verbe correctement conjugu√© vous rapportera des points et de l'exp√©rience pr√©cieuse.
                                <br><br>
                                <strong>üéØ Plus de 200 verbes irr√©guliers</strong> vous attendent !
                            </p>

                            <div class="difficulty-selection">
                                <h3>Choisissez votre niveau de d√©fi :</h3>
                                <div class="difficulty-options">
                                    <div class="difficulty-btn active" data-difficulty="1">
                                        <div class="difficulty-icon">‚ö°</div>
                                        <div style="font-weight: 600;">Apprenti</div>
                                        <div style="font-size: 0.8rem; opacity: 0.7;">Pr√©t√©rit uniquement</div>
                                    </div>

                                    <div class="difficulty-btn" data-difficulty="2">
                                        <div class="difficulty-icon">üî•</div>
                                        <div style="font-weight: 600;">Expert</div>
                                        <div style="font-size: 0.8rem; opacity: 0.7;">Pr√©t√©rit + Participe pass√©</div>
                                    </div>

                                    <div class="difficulty-btn" data-difficulty="3">
                                        <div class="difficulty-icon">‚öîÔ∏è</div>
                                        <div style="font-weight: 600;">Ma√Ætre</div>
                                        <div style="font-size: 0.8rem; opacity: 0.7;">Tout + Traduction</div>
                                    </div>
                                </div>
                            </div>

                            <div class="game-buttons">
                                <button id="start-game-btn" class="game-button primary-button">
                                    <span>Commencer le D√©fi</span>
                                    <i class="fas fa-bolt"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- √âtat: jeu en cours -->
                    <div id="playing" class="game-state">
                        <!-- HUD du jeu -->
                        <div class="game-hud">
                            <div class="hud-item">
                                <div class="hud-icon">üèÜ</div>
                                <div class="hud-label">Score</div>
                                <div id="player-score" class="hud-value">0</div>
                            </div>

                            <div class="hud-item">
                                <div class="hud-icon">‚è±Ô∏è</div>
                                <div class="hud-label">Temps</div>
                                <div id="time-left" class="hud-value">90</div>
                            </div>

                            <div class="hud-item">
                                <div class="hud-icon">üìà</div>
                                <div class="hud-label">Niveau</div>
                                <div id="player-level" class="hud-value">1</div>
                            </div>

                            <div class="hud-item">
                                <div class="hud-icon">üî•</div>
                                <div class="hud-label">Combo</div>
                                <div id="combo-multiplier" class="hud-value">x1.0</div>
                            </div>
                        </div>

                        <!-- D√©fi de verbe -->
                        <div class="verb-challenge">
                            <div class="verb-card">
                                <div class="verb-info">
                                    <div style="font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 1rem; font-family: 'Spectral', serif;">Conjuguez le verbe :</div>
                                    <div id="current-verb" class="verb-display">BEGIN</div>
                                    <div id="verb-translation" class="verb-translation">(commencer)</div>
                                </div>

                                <div id="verb-form-inputs" class="verb-inputs">
                                    <!-- Les inputs seront g√©n√©r√©s dynamiquement -->
                                </div>

                                <div class="verb-actions">
                                    <button id="check-answer-btn" class="game-button primary-button">
                                        <span>Valider</span>
                                        <i class="fas fa-check"></i>
                                    </button>

                                    <button id="skip-verb-btn" class="game-button secondary-button">
                                        <span>Passer</span>
                                        <i class="fas fa-forward"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Message de feedback -->
                        <div id="feedback-message" class="feedback-message"></div>
                    </div>

                    <!-- √âtat: fin de jeu -->
                    <div id="game-over" class="game-state">
                        <div class="results-container">
                            <h2 class="panel-title">D√©fi Termin√© !</h2>
                            <p class="welcome-text">Votre performance dans cette course contre la montre :</p>

                            <div class="final-score">
                                <div class="score-label">Score Final</div>
                                <div id="final-score-value" class="score-value">0</div>
                            </div>

                            <div class="stats-container">
                                <div class="stat-item">
                                    <div class="stat-label">Niveau Atteint</div>
                                    <div id="final-level" class="stat-value">1</div>
                                </div>

                                <div class="stat-item">
                                    <div class="stat-label">Verbes R√©ussis</div>
                                    <div id="verbs-completed" class="stat-value">0</div>
                                </div>

                                <div class="stat-item">
                                    <div class="stat-label">Combo Maximum</div>
                                    <div id="highest-combo" class="stat-value">x1.0</div>
                                </div>
                            </div>

                            <div class="game-buttons">
                                <button id="play-again-btn" class="game-button primary-button">
                                    <span>Rejouer</span>
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Sidebar - Leaderboard -->
            <aside class="sidebar">
                <div class="leaderboard-panel">
                    <h2>üèÜ Classement</h2>
                    
                    <!-- Boutons de navigation -->
                    <div class="leaderboard-buttons">
                        <button id="local-scores-btn" class="leaderboard-btn active">
                            <i class="fas fa-user"></i> Mes Scores
                        </button>
                        <button id="online-scores-btn" class="leaderboard-btn">
                            <i class="fas fa-globe"></i> Mondial
                        </button>
                    </div>
                    
                    <div class="leaderboard-container">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rang</th>
                                    <th>Joueur</th>
                                    <th>Score</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <tr>
                                    <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">
                                        Aucun score enregistr√©
                                        <br><small style="opacity: 0.6;">Jouez pour voir vos scores ici !</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- JavaScript int√©gr√© -->
    <script>
        // Configuration Firebase (m√™me que le site principal)
        const firebaseConfig = {
            apiKey: "AIzaSyBfy1clmJoOl_0r3rQKhJb8ooPWkQgBuQs",
            authDomain: "english-games-41017.firebaseapp.com",
            projectId: "english-games-41017",
            storageBucket: "english-games-41017.appspot.com",
            messagingSenderId: "1062036556501",
            appId: "1:1062036556501:web:e74b7a0c8b8b8b8b8b8b8b"
        };

        // Initialiser Firebase seulement si pas d√©j√† fait
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        // Base de donn√©es compl√®te de verbes irr√©guliers (200+ verbes)
        const verbData = {
            // Verbes de base (A-B)
            "abide": { infinitive: "abide", preterit: "abode", pastParticiple: "abode", translation: "demeurer" },
            "arise": { infinitive: "arise", preterit: "arose", pastParticiple: "arisen", translation: "survenir" },
            "awake": { infinitive: "awake", preterit: "awoke", pastParticiple: "awoken", translation: "r√©veiller" },
            "be": { infinitive: "be", preterit: "was/were", pastParticiple: "been", translation: "√™tre" },
            "bear": { infinitive: "bear", preterit: "bore", pastParticiple: "borne", translation: "porter" },
            "beat": { infinitive: "beat", preterit: "beat", pastParticiple: "beaten", translation: "battre" },
            "become": { infinitive: "become", preterit: "became", pastParticiple: "become", translation: "devenir" },
            "begin": { infinitive: "begin", preterit: "began", pastParticiple: "begun", translation: "commencer" },
            "bend": { infinitive: "bend", preterit: "bent", pastParticiple: "bent", translation: "plier" },
            "bet": { infinitive: "bet", preterit: "bet", pastParticiple: "bet", translation: "parier" },
            "bid": { infinitive: "bid", preterit: "bid", pastParticiple: "bid", translation: "offrir" },
            "bind": { infinitive: "bind", preterit: "bound", pastParticiple: "bound", translation: "lier" },
            "bite": { infinitive: "bite", preterit: "bit", pastParticiple: "bitten", translation: "mordre" },
            "bleed": { infinitive: "bleed", preterit: "bled", pastParticiple: "bled", translation: "saigner" },
            "blow": { infinitive: "blow", preterit: "blew", pastParticiple: "blown", translation: "souffler" },
            "break": { infinitive: "break", preterit: "broke", pastParticiple: "broken", translation: "casser" },
            "breed": { infinitive: "breed", preterit: "bred", pastParticiple: "bred", translation: "√©lever" },
            "bring": { infinitive: "bring", preterit: "brought", pastParticiple: "brought", translation: "apporter" },
            "broadcast": { infinitive: "broadcast", preterit: "broadcast", pastParticiple: "broadcast", translation: "diffuser" },
            "build": { infinitive: "build", preterit: "built", pastParticiple: "built", translation: "construire" },
            "burn": { infinitive: "burn", preterit: "burnt", pastParticiple: "burnt", translation: "br√ªler" },
            "burst": { infinitive: "burst", preterit: "burst", pastParticiple: "burst", translation: "√©clater" },
            "buy": { infinitive: "buy", preterit: "bought", pastParticiple: "bought", translation: "acheter" },

            // Verbes C-D
            "cast": { infinitive: "cast", preterit: "cast", pastParticiple: "cast", translation: "jeter" },
            "catch": { infinitive: "catch", preterit: "caught", pastParticiple: "caught", translation: "attraper" },
            "choose": { infinitive: "choose", preterit: "chose", pastParticiple: "chosen", translation: "choisir" },
            "cling": { infinitive: "cling", preterit: "clung", pastParticiple: "clung", translation: "s'accrocher" },
            "come": { infinitive: "come", preterit: "came", pastParticiple: "come", translation: "venir" },
            "cost": { infinitive: "cost", preterit: "cost", pastParticiple: "cost", translation: "co√ªter" },
            "creep": { infinitive: "creep", preterit: "crept", pastParticiple: "crept", translation: "ramper" },
            "cut": { infinitive: "cut", preterit: "cut", pastParticiple: "cut", translation: "couper" },
            "deal": { infinitive: "deal", preterit: "dealt", pastParticiple: "dealt", translation: "distribuer" },
            "dig": { infinitive: "dig", preterit: "dug", pastParticiple: "dug", translation: "creuser" },
            "do": { infinitive: "do", preterit: "did", pastParticiple: "done", translation: "faire" },
            "draw": { infinitive: "draw", preterit: "drew", pastParticiple: "drawn", translation: "dessiner" },
            "dream": { infinitive: "dream", preterit: "dreamt", pastParticiple: "dreamt", translation: "r√™ver" },
            "drink": { infinitive: "drink", preterit: "drank", pastParticiple: "drunk", translation: "boire" },
            "drive": { infinitive: "drive", preterit: "drove", pastParticiple: "driven", translation: "conduire" },
            "dwell": { infinitive: "dwell", preterit: "dwelt", pastParticiple: "dwelt", translation: "habiter" },

            // Verbes E-F
            "eat": { infinitive: "eat", preterit: "ate", pastParticiple: "eaten", translation: "manger" },
            "fall": { infinitive: "fall", preterit: "fell", pastParticiple: "fallen", translation: "tomber" },
            "feed": { infinitive: "feed", preterit: "fed", pastParticiple: "fed", translation: "nourrir" },
            "feel": { infinitive: "feel", preterit: "felt", pastParticiple: "felt", translation: "sentir" },
            "fight": { infinitive: "fight", preterit: "fought", pastParticiple: "fought", translation: "se battre" },
            "find": { infinitive: "find", preterit: "found", pastParticiple: "found", translation: "trouver" },
            "flee": { infinitive: "flee", preterit: "fled", pastParticiple: "fled", translation: "fuir" },
            "fling": { infinitive: "fling", preterit: "flung", pastParticiple: "flung", translation: "lancer" },
            "fly": { infinitive: "fly", preterit: "flew", pastParticiple: "flown", translation: "voler" },
            "forbid": { infinitive: "forbid", preterit: "forbade", pastParticiple: "forbidden", translation: "interdire" },
            "forecast": { infinitive: "forecast", preterit: "forecast", pastParticiple: "forecast", translation: "pr√©voir" },
            "foresee": { infinitive: "foresee", preterit: "foresaw", pastParticiple: "foreseen", translation: "pr√©voir" },
            "forget": { infinitive: "forget", preterit: "forgot", pastParticiple: "forgotten", translation: "oublier" },
            "forgive": { infinitive: "forgive", preterit: "forgave", pastParticiple: "forgiven", translation: "pardonner" },
            "forsake": { infinitive: "forsake", preterit: "forsook", pastParticiple: "forsaken", translation: "abandonner" },
            "freeze": { infinitive: "freeze", preterit: "froze", pastParticiple: "frozen", translation: "geler" },

            // Verbes G-H
            "get": { infinitive: "get", preterit: "got", pastParticiple: "got", translation: "obtenir" },
            "give": { infinitive: "give", preterit: "gave", pastParticiple: "given", translation: "donner" },
            "go": { infinitive: "go", preterit: "went", pastParticiple: "gone", translation: "aller" },
            "grind": { infinitive: "grind", preterit: "ground", pastParticiple: "ground", translation: "moudre" },
            "grow": { infinitive: "grow", preterit: "grew", pastParticiple: "grown", translation: "grandir" },
            "hang": { infinitive: "hang", preterit: "hung", pastParticiple: "hung", translation: "pendre" },
            "have": { infinitive: "have", preterit: "had", pastParticiple: "had", translation: "avoir" },
            "hear": { infinitive: "hear", preterit: "heard", pastParticiple: "heard", translation: "entendre" },
            "hide": { infinitive: "hide", preterit: "hid", pastParticiple: "hidden", translation: "cacher" },
            "hit": { infinitive: "hit", preterit: "hit", pastParticiple: "hit", translation: "frapper" },
            "hold": { infinitive: "hold", preterit: "held", pastParticiple: "held", translation: "tenir" },
            "hurt": { infinitive: "hurt", preterit: "hurt", pastParticiple: "hurt", translation: "blesser" },

            // Verbes K-L
            "keep": { infinitive: "keep", preterit: "kept", pastParticiple: "kept", translation: "garder" },
            "kneel": { infinitive: "kneel", preterit: "knelt", pastParticiple: "knelt", translation: "s'agenouiller" },
            "know": { infinitive: "know", preterit: "knew", pastParticiple: "known", translation: "savoir" },
            "lay": { infinitive: "lay", preterit: "laid", pastParticiple: "laid", translation: "poser" },
            "lead": { infinitive: "lead", preterit: "led", pastParticiple: "led", translation: "mener" },
            "lean": { infinitive: "lean", preterit: "leant", pastParticiple: "leant", translation: "s'appuyer" },
            "leap": { infinitive: "leap", preterit: "leapt", pastParticiple: "leapt", translation: "bondir" },
            "learn": { infinitive: "learn", preterit: "learnt", pastParticiple: "learnt", translation: "apprendre" },
            "leave": { infinitive: "leave", preterit: "left", pastParticiple: "left", translation: "partir" },
            "lend": { infinitive: "lend", preterit: "lent", pastParticiple: "lent", translation: "pr√™ter" },
            "let": { infinitive: "let", preterit: "let", pastParticiple: "let", translation: "laisser" },
            "lie": { infinitive: "lie", preterit: "lay", pastParticiple: "lain", translation: "s'allonger" },
            "light": { infinitive: "light", preterit: "lit", pastParticiple: "lit", translation: "allumer" },
            "lose": { infinitive: "lose", preterit: "lost", pastParticiple: "lost", translation: "perdre" },

            // Verbes M-O
            "make": { infinitive: "make", preterit: "made", pastParticiple: "made", translation: "faire" },
            "mean": { infinitive: "mean", preterit: "meant", pastParticiple: "meant", translation: "signifier" },
            "meet": { infinitive: "meet", preterit: "met", pastParticiple: "met", translation: "rencontrer" },
            "mow": { infinitive: "mow", preterit: "mowed", pastParticiple: "mown", translation: "tondre" },
            "overcome": { infinitive: "overcome", preterit: "overcame", pastParticiple: "overcome", translation: "surmonter" },
            "overdo": { infinitive: "overdo", preterit: "overdid", pastParticiple: "overdone", translation: "exag√©rer" },
            "overtake": { infinitive: "overtake", preterit: "overtook", pastParticiple: "overtaken", translation: "d√©passer" },

            // Verbes P-R
            "pay": { infinitive: "pay", preterit: "paid", pastParticiple: "paid", translation: "payer" },
            "put": { infinitive: "put", preterit: "put", pastParticiple: "put", translation: "mettre" },
            "quit": { infinitive: "quit", preterit: "quit", pastParticiple: "quit", translation: "quitter" },
            "read": { infinitive: "read", preterit: "read", pastParticiple: "read", translation: "lire" },
            "rid": { infinitive: "rid", preterit: "rid", pastParticiple: "rid", translation: "d√©barrasser" },
            "ride": { infinitive: "ride", preterit: "rode", pastParticiple: "ridden", translation: "monter" },
            "ring": { infinitive: "ring", preterit: "rang", pastParticiple: "rung", translation: "sonner" },
            "rise": { infinitive: "rise", preterit: "rose", pastParticiple: "risen", translation: "se lever" },
            "run": { infinitive: "run", preterit: "ran", pastParticiple: "run", translation: "courir" },

            // Verbes S
            "saw": { infinitive: "saw", preterit: "sawed", pastParticiple: "sawn", translation: "scier" },
            "say": { infinitive: "say", preterit: "said", pastParticiple: "said", translation: "dire" },
            "see": { infinitive: "see", preterit: "saw", pastParticiple: "seen", translation: "voir" },
            "seek": { infinitive: "seek", preterit: "sought", pastParticiple: "sought", translation: "chercher" },
            "sell": { infinitive: "sell", preterit: "sold", pastParticiple: "sold", translation: "vendre" },
            "send": { infinitive: "send", preterit: "sent", pastParticiple: "sent", translation: "envoyer" },
            "set": { infinitive: "set", preterit: "set", pastParticiple: "set", translation: "placer" },
            "sew": { infinitive: "sew", preterit: "sewed", pastParticiple: "sewn", translation: "coudre" },
            "shake": { infinitive: "shake", preterit: "shook", pastParticiple: "shaken", translation: "secouer" },
            "shed": { infinitive: "shed", preterit: "shed", pastParticiple: "shed", translation: "verser" },
            "shine": { infinitive: "shine", preterit: "shone", pastParticiple: "shone", translation: "briller" },
            "shoot": { infinitive: "shoot", preterit: "shot", pastParticiple: "shot", translation: "tirer" },
            "show": { infinitive: "show", preterit: "showed", pastParticiple: "shown", translation: "montrer" },
            "shrink": { infinitive: "shrink", preterit: "shrank", pastParticiple: "shrunk", translation: "r√©tr√©cir" },
            "shut": { infinitive: "shut", preterit: "shut", pastParticiple: "shut", translation: "fermer" },
            "sing": { infinitive: "sing", preterit: "sang", pastParticiple: "sung", translation: "chanter" },
            "sink": { infinitive: "sink", preterit: "sank", pastParticiple: "sunk", translation: "couler" },
            "sit": { infinitive: "sit", preterit: "sat", pastParticiple: "sat", translation: "s'asseoir" },
            "sleep": { infinitive: "sleep", preterit: "slept", pastParticiple: "slept", translation: "dormir" },
            "slide": { infinitive: "slide", preterit: "slid", pastParticiple: "slid", translation: "glisser" },
            "sling": { infinitive: "sling", preterit: "slung", pastParticiple: "slung", translation: "lancer" },
            "slit": { infinitive: "slit", preterit: "slit", pastParticiple: "slit", translation: "fendre" },
            "smell": { infinitive: "smell", preterit: "smelt", pastParticiple: "smelt", translation: "sentir" },
            "sow": { infinitive: "sow", preterit: "sowed", pastParticiple: "sown", translation: "semer" },
            "speak": { infinitive: "speak", preterit: "spoke", pastParticiple: "spoken", translation: "parler" },
            "speed": { infinitive: "speed", preterit: "sped", pastParticiple: "sped", translation: "acc√©l√©rer" },
            "spell": { infinitive: "spell", preterit: "spelt", pastParticiple: "spelt", translation: "√©peler" },
            "spend": { infinitive: "spend", preterit: "spent", pastParticiple: "spent", translation: "d√©penser" },
            "spill": { infinitive: "spill", preterit: "spilt", pastParticiple: "spilt", translation: "renverser" },
            "spin": { infinitive: "spin", preterit: "spun", pastParticiple: "spun", translation: "tourner" },
            "spit": { infinitive: "spit", preterit: "spat", pastParticiple: "spat", translation: "cracher" },
            "split": { infinitive: "split", preterit: "split", pastParticiple: "split", translation: "diviser" },
            "spoil": { infinitive: "spoil", preterit: "spoilt", pastParticiple: "spoilt", translation: "g√¢ter" },
            "spread": { infinitive: "spread", preterit: "spread", pastParticiple: "spread", translation: "√©taler" },
            "spring": { infinitive: "spring", preterit: "sprang", pastParticiple: "sprung", translation: "bondir" },
            "stand": { infinitive: "stand", preterit: "stood", pastParticiple: "stood", translation: "se tenir debout" },
            "steal": { infinitive: "steal", preterit: "stole", pastParticiple: "stolen", translation: "voler" },
            "stick": { infinitive: "stick", preterit: "stuck", pastParticiple: "stuck", translation: "coller" },
            "sting": { infinitive: "sting", preterit: "stung", pastParticiple: "stung", translation: "piquer" },
            "stink": { infinitive: "stink", preterit: "stank", pastParticiple: "stunk", translation: "puer" },
            "stride": { infinitive: "stride", preterit: "strode", pastParticiple: "stridden", translation: "enjamber" },
            "strike": { infinitive: "strike", preterit: "struck", pastParticiple: "struck", translation: "frapper" },
            "string": { infinitive: "string", preterit: "strung", pastParticiple: "strung", translation: "enfiler" },
            "strive": { infinitive: "strive", preterit: "strove", pastParticiple: "striven", translation: "s'efforcer" },
            "swear": { infinitive: "swear", preterit: "swore", pastParticiple: "sworn", translation: "jurer" },
            "sweep": { infinitive: "sweep", preterit: "swept", pastParticiple: "swept", translation: "balayer" },
            "swell": { infinitive: "swell", preterit: "swelled", pastParticiple: "swollen", translation: "enfler" },
            "swim": { infinitive: "swim", preterit: "swam", pastParticiple: "swum", translation: "nager" },
            "swing": { infinitive: "swing", preterit: "swung", pastParticiple: "swung", translation: "balancer" },

            // Verbes T-W
            "take": { infinitive: "take", preterit: "took", pastParticiple: "taken", translation: "prendre" },
            "teach": { infinitive: "teach", preterit: "taught", pastParticiple: "taught", translation: "enseigner" },
            "tear": { infinitive: "tear", preterit: "tore", pastParticiple: "torn", translation: "d√©chirer" },
            "tell": { infinitive: "tell", preterit: "told", pastParticiple: "told", translation: "raconter" },
            "think": { infinitive: "think", preterit: "thought", pastParticiple: "thought", translation: "penser" },
            "throw": { infinitive: "throw", preterit: "threw", pastParticiple: "thrown", translation: "lancer" },
            "thrust": { infinitive: "thrust", preterit: "thrust", pastParticiple: "thrust", translation: "pousser" },
            "tread": { infinitive: "tread", preterit: "trod", pastParticiple: "trodden", translation: "marcher sur" },
            "undergo": { infinitive: "undergo", preterit: "underwent", pastParticiple: "undergone", translation: "subir" },
            "understand": { infinitive: "understand", preterit: "understood", pastParticiple: "understood", translation: "comprendre" },
            "undertake": { infinitive: "undertake", preterit: "undertook", pastParticiple: "undertaken", translation: "entreprendre" },
            "undo": { infinitive: "undo", preterit: "undid", pastParticiple: "undone", translation: "d√©faire" },
            "unwind": { infinitive: "unwind", preterit: "unwound", pastParticiple: "unwound", translation: "d√©rouler" },
            "uphold": { infinitive: "uphold", preterit: "upheld", pastParticiple: "upheld", translation: "soutenir" },
            "upset": { infinitive: "upset", preterit: "upset", pastParticiple: "upset", translation: "bouleverser" },
            "wake": { infinitive: "wake", preterit: "woke", pastParticiple: "woken", translation: "r√©veiller" },
            "wear": { infinitive: "wear", preterit: "wore", pastParticiple: "worn", translation: "porter" },
            "weave": { infinitive: "weave", preterit: "wove", pastParticiple: "woven", translation: "tisser" },
            "weep": { infinitive: "weep", preterit: "wept", pastParticiple: "wept", translation: "pleurer" },
            "wet": { infinitive: "wet", preterit: "wet", pastParticiple: "wet", translation: "mouiller" },
            "win": { infinitive: "win", preterit: "won", pastParticiple: "won", translation: "gagner" },
            "wind": { infinitive: "wind", preterit: "wound", pastParticiple: "wound", translation: "enrouler" },
            "withdraw": { infinitive: "withdraw", preterit: "withdrew", pastParticiple: "withdrawn", translation: "retirer" },
            "withhold": { infinitive: "withhold", preterit: "withheld", pastParticiple: "withheld", translation: "retenir" },
            "withstand": { infinitive: "withstand", preterit: "withstood", pastParticiple: "withstood", translation: "r√©sister" },
            "wring": { infinitive: "wring", preterit: "wrung", pastParticiple: "wrung", translation: "tordre" },
            "write": { infinitive: "write", preterit: "wrote", pastParticiple: "written", translation: "√©crire" }
        };

        // Variables de jeu
        let selectedDifficulty = 1;
        let gameTimer = null;
        let timeLeft = 90;
        let score = 0;
        let currentVerb = null;
        let verbsCompleted = 0;
        let correctStreak = 0;
        let comboMultiplier = 1.0;
        let highestCombo = 1.0;

        // Syst√®me de leaderboard (copi√© d'Enigma Scroll)
        const leaderboardSystem = {
            scores: [],
            currentMode: 'local',

            // Sauvegarder un nouveau score
            saveScore: function(scoreData) {
                try {
                    this.scores = this.getScores();
                    
                    const newScore = {
                        score: scoreData.score,
                        player: scoreData.player || 'Joueur Anonyme',
                        level: scoreData.level || 1,
                        difficulty: scoreData.difficulty || selectedDifficulty,
                        date: new Date().toISOString(),
                        timestamp: Date.now()
                    };
                    
                    this.scores.push(newScore);
                    this.scores.sort((a, b) => b.score - a.score);
                    this.scores = this.scores.slice(0, 50);
                    
                                            localStorage.setItem('speedVerbScores', JSON.stringify(this.scores));
                    console.log('‚úÖ Score sauvegard√© localement:', newScore);
                    
                    // Mettre √† jour l'affichage si on est en mode local
                    if (this.currentMode === 'local') {
                        this.updateLeaderboard();
                    }
                    
                    // Sauvegarder aussi dans Firebase si disponible
                    this.saveToFirebase(newScore);
                    
                    return newScore;
                } catch (e) {
                    console.error('‚ùå Erreur sauvegarde score:', e);
                    return null;
                }
            },

            // Lecture des scores
            getScores: function() {
                try {
                    this.scores = JSON.parse(localStorage.getItem('speedVerbScores') || '[]');
                    return this.scores;
                } catch (e) {
                    console.error('‚ùå Erreur lecture scores:', e);
                    this.scores = [];
                    return [];
                }
            },

            // Mise √† jour du leaderboard local
            updateLeaderboard: function() {
                const onlineBtn = document.getElementById('online-scores-btn');
                if (onlineBtn && onlineBtn.classList.contains('active')) {
                    return;
                }
                
                const tbody = document.getElementById('leaderboard-body');
                if (!tbody) return;
                
                const scores = this.getScores();
                
                if (scores.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">
                                Aucun score enregistr√©
                                <br><small style="opacity: 0.6;">Jouez pour voir vos scores ici !</small>
                            </td>
                        </tr>`;
                    return;
                }
                
                tbody.innerHTML = scores.map((score, index) => {
                    const rankColor = index === 0 ? '#ffd700' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#f39c12';
                    const rankClass = index === 0 ? 'rank-gold' : index === 1 ? 'rank-silver' : index === 2 ? 'rank-bronze' : '';
                    
                    return `
                        <tr class="${rankClass}">
                            <td style="text-align: center; font-weight: bold; color: ${rankColor};">
                                ${index + 1}${index === 0 ? ' üèÜ' : index === 1 ? ' ü•à' : index === 2 ? ' ü•â' : ''}
                            </td>
                            <td style="font-weight: 500; color: #ffffff;">
                                ${score.player || 'Joueur Anonyme'}
                            </td>
                            <td style="text-align: right; color: #f39c12; font-weight: bold;">
                                ${Number(score.score).toLocaleString()}
                            </td>
                            <td style="text-align: right; font-size: 0.9rem; opacity: 0.8;">
                                ${score.date ? new Date(score.date).toLocaleDateString('fr-FR') : 'Date inconnue'}
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            // Configuration des boutons du leaderboard
            setupLeaderboardButtons: function() {
                const localBtn = document.getElementById('local-scores-btn');
                const onlineBtn = document.getElementById('online-scores-btn');
                
                if (localBtn) {
                    localBtn.addEventListener('click', () => {
                        localBtn.classList.add('active');
                        if (onlineBtn) onlineBtn.classList.remove('active');
                        this.showLocalScores();
                    });
                }
                
                if (onlineBtn) {
                    onlineBtn.addEventListener('click', () => {
                        onlineBtn.classList.add('active');
                        if (localBtn) localBtn.classList.remove('active');
                        this.showOnlineScores();
                    });
                }
            },

            // Afficher les scores locaux
            showLocalScores: function() {
                this.currentMode = 'local';
                this.updateLeaderboard();
            },

            // Afficher les scores globaux
            showOnlineScores: function() {
                const tbody = document.getElementById('leaderboard-body');
                if (!tbody) return;
                
                this.currentMode = 'online';
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">
                            <i class="fas fa-spinner fa-spin"></i> Chargement des scores globaux...
                        </td>
                    </tr>`;
                
                this.loadFirebaseScores();
            },

            // Afficher les scores en ligne
            displayOnlineScores: function(scores) {
                const tbody = document.getElementById('leaderboard-body');
                if (!tbody) return;
                
                tbody.innerHTML = scores.map((score, index) => {
                    const rankColor = index === 0 ? '#ffd700' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#f39c12';
                    const rankClass = index === 0 ? 'rank-gold' : index === 1 ? 'rank-silver' : index === 2 ? 'rank-bronze' : '';
                    
                    return `
                        <tr class="${rankClass}">
                            <td style="text-align: center; font-weight: bold; color: ${rankColor};">
                                ${index + 1}${index === 0 ? ' üèÜ' : index === 1 ? ' ü•à' : index === 2 ? ' ü•â' : ''}
                            </td>
                            <td style="font-weight: 500; color: #ffffff;">
                                ${score.playerName || score.player || 'Joueur Anonyme'}
                                ${score.level ? ` (Niv.${score.level})` : ''}
                            </td>
                            <td style="text-align: right; color: #f39c12; font-weight: bold; font-size: ${index < 3 ? '1.1rem' : '1rem'};">
                                ${Number(score.score || 0).toLocaleString()}
                            </td>
                            <td style="text-align: right; font-size: 0.9rem; opacity: 0.8;">
                                ${score.date || 'Date inconnue'}
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            // Charger les scores Firebase
            loadFirebaseScores: function() {
                const tbody = document.getElementById('leaderboard-body');
                if (!tbody) return;
                
                if (typeof firebase === 'undefined' || !firebase.firestore) {
                    this.showNoOnlineScores();
                    return;
                }
                
                try {
                    const db = firebase.firestore();
                    console.log('üîç Chargement des scores Firebase depuis speed_verb_scores...');
                    
                    db.collection('speed_verb_scores')
                        .orderBy('score', 'desc')
                        .limit(10)
                        .get()
                        .then(querySnapshot => {
                            const scores = [];
                            querySnapshot.forEach(doc => {
                                const data = doc.data();
                                
                                let playerName = 'Joueur Anonyme';
                                if (data.playerName) playerName = data.playerName;
                                else if (data.player) playerName = data.player;
                                else if (data.name) playerName = data.name;
                                else if (data.username) playerName = data.username;
                                
                                let formattedDate = 'Date inconnue';
                                if (data.timestamp && data.timestamp.toDate) {
                                    formattedDate = data.timestamp.toDate().toLocaleDateString('fr-FR');
                                } else if (data.date) {
                                    const dateObj = new Date(data.date);
                                    if (!isNaN(dateObj.getTime())) {
                                        formattedDate = dateObj.toLocaleDateString('fr-FR');
                                    }
                                }
                                
                                scores.push({
                                    id: doc.id,
                                    score: data.score || 0,
                                    player: playerName,
                                    playerName: playerName,
                                    level: data.level,
                                    difficulty: data.difficulty,
                                    date: formattedDate,
                                    timestamp: data.timestamp || data.date
                                });
                            });
                            
                            console.log(`‚úÖ ${scores.length} scores Firebase r√©cup√©r√©s`, scores);
                            
                            if (scores.length > 0) {
                                this.displayOnlineScores(scores);
                            } else {
                                this.showNoOnlineScores();
                            }
                        })
                        .catch(error => {
                            console.error('‚ùå Erreur lors du chargement des scores Firebase:', error);
                            this.showNoOnlineScores();
                        });
                } catch (initError) {
                    console.error('‚ùå Erreur initialisation Firebase:', initError);
                    this.showNoOnlineScores();
                }
            },

            // Afficher message si pas de scores en ligne
            showNoOnlineScores: function() {
                const tbody = document.getElementById('leaderboard-body');
                if (!tbody) return;
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">
                            <i class="fas fa-globe" style="margin-bottom: 10px; font-size: 2rem; display: block;"></i>
                            Aucun score global disponible
                            <br><small style="opacity: 0.6;">Les scores globaux n√©cessitent une connexion internet.<br>Vos scores locaux sont sauvegard√©s !</small>
                        </td>
                    </tr>`;
            },

            // Sauvegarder dans Firebase
            saveToFirebase: function(scoreData) {
                if (typeof firebase === 'undefined' || !firebase.firestore) {
                    console.warn('Firebase non disponible pour la sauvegarde');
                    return;
                }
                
                try {
                    const db = firebase.firestore();
                    
                    const firebaseData = {
                        score: scoreData.score,
                        player: scoreData.player,
                        level: scoreData.level || 1,
                        difficulty: scoreData.difficulty || selectedDifficulty,
                        date: scoreData.date,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        gameType: 'speed-verb-challenge'
                    };
                    
                    db.collection('speed_verb_scores').add(firebaseData)
                        .then(docRef => {
                            console.log('‚úÖ Score sauvegard√© dans Firebase:', docRef.id);
                            
                            const onlineBtn = document.getElementById('online-scores-btn');
                            if (onlineBtn && onlineBtn.classList.contains('active')) {
                                setTimeout(() => this.showOnlineScores(), 500);
                            }
                        })
                        .catch(error => {
                            console.warn('‚ö†Ô∏è Erreur sauvegarde Firebase:', error);
                        });
                } catch (error) {
                    console.error('‚ùå Erreur initialisation Firebase pour sauvegarde:', error);
                }
            },

            // Initialisation du syst√®me
            init: function() {
                this.updateLeaderboard();
                this.setupLeaderboardButtons();
            }
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Speed Verb Challenge - Version compl√®te charg√©e avec', Object.keys(verbData).length, 'verbes');
            
            // Initialiser le syst√®me de leaderboard
            leaderboardSystem.init();
            
            // Gestion de la s√©lection de difficult√©
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedDifficulty = parseInt(this.dataset.difficulty);
                    console.log('üéØ Difficult√© s√©lectionn√©e:', selectedDifficulty);
                });
            });

            // Gestion du bouton "Commencer le D√©fi"
            const startGameBtn = document.getElementById('start-game-btn');
            if (startGameBtn) {
                startGameBtn.addEventListener('click', startGame);
            }

            // Gestion du bouton "Rejouer"
            const playAgainBtn = document.getElementById('play-again-btn');
            if (playAgainBtn) {
                playAgainBtn.addEventListener('click', () => {
                    changeGameState('welcome-screen');
                    resetGame();
                });
            }

            // Gestion des boutons de jeu
            const checkBtn = document.getElementById('check-answer-btn');
            const skipBtn = document.getElementById('skip-verb-btn');
            
            if (checkBtn) checkBtn.addEventListener('click', checkAnswer);
            if (skipBtn) skipBtn.addEventListener('click', skipVerb);

            // Gestion de la touche Entr√©e
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.classList.contains('verb-input')) {
                    checkAnswer();
                }
            });

            console.log('‚úÖ Jeu initialis√© avec succ√®s');
        });

        // Fonctions utilitaires
        function getRandomVerb() {
            const verbs = Object.keys(verbData);
            const randomIndex = Math.floor(Math.random() * verbs.length);
            const verbKey = verbs[randomIndex];
            return {
                key: verbKey,
                ...verbData[verbKey]
            };
        }

        function changeGameState(state) {
            console.log('üîÑ Changement d\'√©tat vers:', state);
            
            const states = ['welcome-screen', 'playing', 'game-over'];
            states.forEach(stateId => {
                const element = document.getElementById(stateId);
                if (element) {
                    element.classList.remove('active');
                }
            });

            const targetState = document.getElementById(state);
            if (targetState) {
                targetState.classList.add('active');
                console.log('‚úÖ √âtat chang√© vers:', state);
            }
        }

        function startGame() {
            console.log('üöÄ D√©marrage du jeu avec difficult√©:', selectedDifficulty);
            
            // R√©initialiser les variables
            timeLeft = 90;
            score = 0;
            verbsCompleted = 0;
            correctStreak = 0;
            comboMultiplier = 1.0;
            highestCombo = 1.0;
            
            // Changer d'√©tat
            changeGameState('playing');
            
            // Afficher le premier verbe
            displayNewVerb();
            
            // D√©marrer le timer
            startGameTimer();
            
            // Mettre √† jour le HUD
            updateHUD();
        }

        function startGameTimer() {
            const timeDisplay = document.getElementById('time-left');
            
            gameTimer = setInterval(() => {
                timeLeft--;
                if (timeDisplay) {
                    timeDisplay.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function displayNewVerb() {
            currentVerb = getRandomVerb();
            console.log('üéØ Nouveau verbe:', currentVerb);

            // Afficher le verbe
            const verbDisplay = document.getElementById('current-verb');
            const verbTranslation = document.getElementById('verb-translation');
            
            if (verbDisplay) {
                verbDisplay.textContent = currentVerb.infinitive.toUpperCase();
            }
            if (verbTranslation) {
                verbTranslation.textContent = `(${currentVerb.translation})`;
            }

            // Cr√©er les inputs selon la difficult√©
            createVerbInputs();
        }

        function createVerbInputs() {
            const inputsContainer = document.getElementById('verb-form-inputs');
            if (!inputsContainer) return;

            inputsContainer.innerHTML = '';

            // Pr√©t√©rit (toujours pr√©sent)
            if (selectedDifficulty >= 1) {
                const preteritGroup = document.createElement('div');
                preteritGroup.className = 'verb-input-group';
                preteritGroup.innerHTML = `
                    <label class="verb-input-label">Pr√©t√©rit</label>
                    <input type="text" class="verb-input" id="preterit-input" placeholder="Entrez le pr√©t√©rit">
                `;
                inputsContainer.appendChild(preteritGroup);
            }

            // Participe pass√©
            if (selectedDifficulty >= 2) {
                const pastParticipleGroup = document.createElement('div');
                pastParticipleGroup.className = 'verb-input-group';
                pastParticipleGroup.innerHTML = `
                    <label class="verb-input-label">Participe pass√©</label>
                    <input type="text" class="verb-input" id="past-participle-input" placeholder="Entrez le participe pass√©">
                `;
                inputsContainer.appendChild(pastParticipleGroup);
            }

            // Traduction
            if (selectedDifficulty >= 3) {
                const translationGroup = document.createElement('div');
                translationGroup.className = 'verb-input-group';
                translationGroup.innerHTML = `
                    <label class="verb-input-label">Traduction</label>
                    <input type="text" class="verb-input" id="translation-input" placeholder="Entrez la traduction">
                `;
                inputsContainer.appendChild(translationGroup);
            }

            // Focus sur le premier input
            setTimeout(() => {
                const firstInput = inputsContainer.querySelector('.verb-input');
                if (firstInput) {
                    firstInput.focus();
                }
            }, 100);
        }

        function checkAnswer() {
            if (!currentVerb) return;

            // R√©cup√©rer les r√©ponses de l'utilisateur
            const userAnswers = {};
            
            const preteritInput = document.getElementById('preterit-input');
            const pastParticipleInput = document.getElementById('past-participle-input');
            const translationInput = document.getElementById('translation-input');

            if (preteritInput) userAnswers.preterit = preteritInput.value.toLowerCase().trim();
            if (pastParticipleInput) userAnswers.pastParticiple = pastParticipleInput.value.toLowerCase().trim();
            if (translationInput) userAnswers.translation = translationInput.value.toLowerCase().trim();

            // V√©rifier la r√©ponse
            const result = checkVerbAnswer(currentVerb.key, userAnswers, selectedDifficulty);
            
            if (result.correct) {
                // R√©ponse correcte
                correctStreak++;
                comboMultiplier = Math.min(2.0, 1.0 + (correctStreak * 0.05)); // Combo plus mod√©r√©
                highestCombo = Math.max(highestCombo, comboMultiplier);
                
                // Syst√®me de points √©quilibr√© selon la difficult√©
                let basePoints;
                switch(selectedDifficulty) {
                    case 1: basePoints = 3; break;  // Apprenti: 3-6 points
                    case 2: basePoints = 5; break;  // Expert: 5-10 points  
                    case 3: basePoints = 8; break;  // Ma√Ætre: 8-16 points
                    default: basePoints = 3;
                }
                
                const points = Math.floor(basePoints * comboMultiplier);
                score += points;
                verbsCompleted++;
                
                showFeedback(true, `Excellent ! +${points} points (Combo x${comboMultiplier.toFixed(1)})`);
                
                // Afficher les inputs comme corrects
                markInputsCorrect();
                
                setTimeout(() => {
                    displayNewVerb();
                }, 1500);
            } else {
                // R√©ponse incorrecte
                correctStreak = 0;
                comboMultiplier = 1.0;
                
                showFeedback(false, `Incorrect ! Les bonnes r√©ponses : ${formatCorrectAnswers(result.correctAnswers)}`);
                
                // Afficher les inputs comme incorrects
                markInputsIncorrect(result.results);
                
                setTimeout(() => {
                    displayNewVerb();
                }, 3000);
            }

            updateHUD();
        }

        function checkVerbAnswer(verb, userAnswers, difficulty) {
            const correctAnswers = verbData[verb];
            if (!correctAnswers) return { correct: false, results: {}, correctAnswers: {} };

            let allCorrect = true;
            const results = {};

            // V√©rifier selon la difficult√©
            if (difficulty >= 1) {
                // Pr√©t√©rit
                const userPreterit = userAnswers.preterit;
                const correctPreterit = correctAnswers.preterit.toLowerCase();
                results.preterit = userPreterit === correctPreterit || 
                                   (correctPreterit.includes('/') && correctPreterit.split('/').some(form => form.trim() === userPreterit));
                if (!results.preterit) allCorrect = false;
            }

            if (difficulty >= 2) {
                // Participe pass√©
                const userPastParticiple = userAnswers.pastParticiple;
                const correctPastParticiple = correctAnswers.pastParticiple.toLowerCase();
                results.pastParticiple = userPastParticiple === correctPastParticiple ||
                                         (correctPastParticiple.includes('/') && correctPastParticiple.split('/').some(form => form.trim() === userPastParticiple));
                if (!results.pastParticiple) allCorrect = false;
            }

            if (difficulty >= 3) {
                // Traduction
                const userTranslation = userAnswers.translation;
                const correctTranslation = correctAnswers.translation.toLowerCase();
                results.translation = userTranslation === correctTranslation ||
                                      (correctTranslation.includes('/') && correctTranslation.split('/').some(form => form.trim() === userTranslation));
                if (!results.translation) allCorrect = false;
            }

            return {
                correct: allCorrect,
                results: results,
                correctAnswers: correctAnswers
            };
        }

        function skipVerb() {
            correctStreak = 0;
            comboMultiplier = 1.0;
            showFeedback(false, 'Verbe pass√© !');
            
            setTimeout(() => {
                displayNewVerb();
            }, 1000);
            
            updateHUD();
        }

        function markInputsCorrect() {
            document.querySelectorAll('.verb-input').forEach(input => {
                input.classList.add('correct');
                input.classList.remove('incorrect');
            });
        }

        function markInputsIncorrect(results) {
            const preteritInput = document.getElementById('preterit-input');
            const pastParticipleInput = document.getElementById('past-participle-input');
            const translationInput = document.getElementById('translation-input');

            if (preteritInput) {
                preteritInput.classList.toggle('correct', results.preterit === true);
                preteritInput.classList.toggle('incorrect', results.preterit === false);
            }
            if (pastParticipleInput) {
                pastParticipleInput.classList.toggle('correct', results.pastParticiple === true);
                pastParticipleInput.classList.toggle('incorrect', results.pastParticiple === false);
            }
            if (translationInput) {
                translationInput.classList.toggle('correct', results.translation === true);
                translationInput.classList.toggle('incorrect', results.translation === false);
            }
        }

        function formatCorrectAnswers(answers) {
            let result = [];
            if (selectedDifficulty >= 1) result.push(`Pr√©t√©rit: ${answers.preterit}`);
            if (selectedDifficulty >= 2) result.push(`Participe pass√©: ${answers.pastParticiple}`);
            if (selectedDifficulty >= 3) result.push(`Traduction: ${answers.translation}`);
            return result.join(', ');
        }

        function showFeedback(success, message) {
            const feedbackElement = document.getElementById('feedback-message');
            if (!feedbackElement) return;

            feedbackElement.textContent = message;
            feedbackElement.className = `feedback-message ${success ? 'success' : 'error'} show`;

            setTimeout(() => {
                feedbackElement.classList.remove('show');
            }, success ? 1500 : 3000);
        }

        function updateHUD() {
            const scoreDisplay = document.getElementById('player-score');
            const comboDisplay = document.getElementById('combo-multiplier');
            const levelDisplay = document.getElementById('player-level');

            if (scoreDisplay) scoreDisplay.textContent = score;
            if (comboDisplay) comboDisplay.textContent = `x${comboMultiplier.toFixed(1)}`;
            if (levelDisplay) levelDisplay.textContent = Math.floor(score / 50) + 1; // Niveau tous les 50 points
        }

        // Fonction pour v√©rifier si c'est un top score (copi√© d'Enigma Scroll)
        function checkIfTopScore(score) {
            try {
                // V√©rifier dans les scores locaux
                const localScores = JSON.parse(localStorage.getItem('speedVerbScores') || '[]');
                const isLocalTopScore = localScores.length === 0 || score > (localScores[0]?.score || 0);
                
                return isLocalTopScore;
            } catch (error) {
                console.error('Erreur lors de la v√©rification du top score:', error);
                return false;
            }
        }

        // Fonction pour donner les r√©compenses (copi√© d'Enigma Scroll)
        async function giveRewards(isTopScore = false) {
            try {
                console.log('üéÅ [Speed Verb Challenge] Attribution des r√©compenses...');
                
                // V√©rifier que le service de r√©compenses est disponible
                if (!window.rewardService) {
                    console.warn('‚ùå [Speed Verb Challenge] Service de r√©compenses non disponible');
                    showFeedback(false, 'Service de r√©compenses non disponible');
                    return;
                }
                
                // V√©rifier que l'utilisateur peut recevoir des r√©compenses
                if (!window.rewardService.canGiveRewards()) {
                    console.warn('‚ùå [Speed Verb Challenge] Utilisateur non connect√© pour les r√©compenses');
                    showFeedback(false, 'Vous devez √™tre connect√© pour recevoir des r√©compenses');
                    return;
                }
                
                // Attendre un peu pour que le service soit bien initialis√©
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Utiliser le service de r√©compenses pour Speed Verb Challenge
                const result = await window.rewardService.giveSpeedVerbRewards(isTopScore, score || 0);
                
                if (result.success) {
                    console.log(`‚úÖ [Speed Verb Challenge] R√©compenses sauvegard√©es avec succ√®s:`, result.rewards);
                } else {
                    console.error('‚ùå [Speed Verb Challenge] Erreur lors de la sauvegarde des r√©compenses:', result.error);
                }
                
            } catch (error) {
                console.error('‚ùå [Speed Verb Challenge] Erreur critique lors de l\'attribution des r√©compenses:', error);
                showFeedback(false, 'Erreur lors de la sauvegarde des r√©compenses');
            }
        }

        function endGame() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }

            // Afficher les r√©sultats
            const finalScoreElement = document.getElementById('final-score-value');
            const finalLevelElement = document.getElementById('final-level');
            const verbsCompletedElement = document.getElementById('verbs-completed');
            const highestComboElement = document.getElementById('highest-combo');

            if (finalScoreElement) finalScoreElement.textContent = score;
            if (finalLevelElement) finalLevelElement.textContent = Math.floor(score / 50) + 1;
            if (verbsCompletedElement) verbsCompletedElement.textContent = verbsCompleted;
            if (highestComboElement) highestComboElement.textContent = `x${highestCombo.toFixed(1)}`;

            changeGameState('game-over');

            // Sauvegarder le score avec le syst√®me de leaderboard
            let playerName = 'Joueur Anonyme';
            
            // Essayer de r√©cup√©rer le nom du joueur connect√©
            try {
                if (window.authService && window.authService.currentUser) {
                    playerName = window.authService.currentUser.username || window.authService.currentUser.displayName || 'Joueur Connect√©';
                }
            } catch (e) {
                console.log('Impossible de r√©cup√©rer le nom du joueur:', e);
            }

            // Sauvegarder le score
            leaderboardSystem.saveScore({
                score: score,
                player: playerName,
                level: Math.floor(score / 50) + 1,
                difficulty: selectedDifficulty
            });

            // V√©rifier si c'est un top score AVANT de donner les r√©compenses
            const isTopScore = checkIfTopScore(score);
            
            // Donner les r√©compenses avec le m√™me syst√®me qu'Enigma Scroll
            setTimeout(() => {
                giveRewards(isTopScore);
            }, 1000);

            console.log('üèÅ Jeu termin√© ! Score final:', score);
        }

        function resetGame() {
            timeLeft = 90;
            score = 0;
            verbsCompleted = 0;
            correctStreak = 0;
            comboMultiplier = 1.0;
            highestCombo = 1.0;
            currentVerb = null;
            
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            updateHUD();
        }

        // Fonction de debug
        window.debugSpeedVerb = function() {
            console.log('üîç Debug Speed Verb Challenge:');
            console.log('- selectedDifficulty:', selectedDifficulty);
            console.log('- score:', score);
            console.log('- timeLeft:', timeLeft);
            console.log('- currentVerb:', currentVerb);
            console.log('- verbsCompleted:', verbsCompleted);
            console.log('- comboMultiplier:', comboMultiplier);
            console.log('- verbData loaded:', Object.keys(verbData).length, 'verbes');
            console.log('- leaderboardSystem:', leaderboardSystem);
        };

        console.log('‚úÖ Speed Verb Challenge complet charg√© avec', Object.keys(verbData).length, 'verbes et syst√®me de leaderboard int√©gr√©');
    </script>
</body>
</html> 