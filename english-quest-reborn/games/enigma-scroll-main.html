<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Enigma Scroll - Un jeu de mots myst√©rieux o√π vous devez deviner des mots cach√©s en anglais">
  <meta name="theme-color" content="#121212">
  <title>Enigma Scroll - Jeu de Mots Myst√©rieux | English Quest</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Exo+2:wght@300;400;600;700&family=Spectral:wght@300;400;500;600&family=MedievalSharp&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="../src/js/firebase-init.js"></script>
  <script src="../src/js/firebase-service-adapter.js"></script>

  <style>
    :root {
      /* Couleurs principales */
      --color-primary: #2ecc71;
      --color-secondary: #27ae60;
      --color-accent: #f1c40f;
      --color-danger: #e74c3c;
      --color-warning: #f39c12;
      --color-info: #3498db;

      /* Couleurs de fond */
      --color-background: #121212;
      --color-surface: #1e1e1e;
      --color-surface-hover: #2a2a2a;
      --color-surface-active: #333333;

      /* Couleurs de texte */
      --color-text-primary: #ffffff;
      --color-text-secondary: rgba(255, 255, 255, 0.7);
      --color-text-disabled: rgba(255, 255, 255, 0.5);

      /* Couleurs pour le jeu Wordle */
      --word-correct: #2ecc71;
      --word-present: #f39c12;
      --word-absent: #7f8c8d;
      --word-unfilled: rgba(255, 255, 255, 0.1);

      /* Espacement */
      --spacing-xs: 0.5rem;
      --spacing-sm: 1rem;
      --spacing-md: 2rem;
      --spacing-lg: 3rem;
      --spacing-xl: 5rem;

      /* Bordures */
      --border-radius-sm: 0.25rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 1rem;
      --border-radius-xl: 2rem;

      /* Ombres */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
      --shadow-glow: 0 0 15px rgba(0, 229, 255, 0.5);

      /* Transitions */
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --transition-slow: 0.5s ease;

      /* Typographie */
      --font-family-primary: 'Exo 2', sans-serif;
      --font-family-secondary: 'Cinzel', serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family-primary);
      background-color: var(--color-background);
      color: var(--color-text-primary);
      line-height: 1.5;
      overflow-x: hidden;
      min-height: 100vh;
      padding-top: 80px;
    }

    /* Header styles */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(46, 204, 113, 0.2);
      z-index: 1000;
      padding: var(--spacing-sm) 0;
    }

    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-sm);
    }

    .logo {
      font-family: var(--font-family-secondary);
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--color-primary);
      text-decoration: none;
      letter-spacing: 1px;
    }

    .logo span {
      color: var(--color-text-primary);
    }

    .nav-list {
      display: flex;
      gap: 2rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-link {
      color: var(--color-text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: all var(--transition-normal);
      position: relative;
      padding: 0.5rem 0;
    }

    .nav-link:hover {
      color: var(--color-primary);
    }

    .nav-link.active {
      color: var(--color-primary);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--color-primary);
      transition: width var(--transition-normal);
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-login {
      background: linear-gradient(135deg, var(--color-primary), var(--color-info));
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-md);
      text-decoration: none;
      font-weight: 600;
      transition: all var(--transition-normal);
      border: none;
      cursor: pointer;
    }

    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .btn-logout {
      background: linear-gradient(135deg, var(--color-danger), #c0392b);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-md);
      text-decoration: none;
      font-weight: 600;
      transition: all var(--transition-normal);
      border: none;
      cursor: pointer;
      margin-left: 10px;
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }

    /* Container principal */
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-sm);
    }

    /* √âcran de connexion obligatoire */
    .auth-required {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
      padding: 2rem;
    }

    .auth-required h1 {
      font-family: var(--font-family-secondary);
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--color-primary), var(--color-info));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .auth-required p {
      font-size: 1.2rem;
      color: var(--color-text-secondary);
      margin-bottom: 2rem;
      max-width: 600px;
    }

    /* Section de jeu */
    .game-section {
      padding: var(--spacing-md) 0;
    }

    .game-header {
      text-align: center;
      margin-bottom: var(--spacing-lg);
    }

    .game-title {
      font-family: var(--font-family-secondary);
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--color-primary), var(--color-info));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .game-subtitle {
      font-size: 1.2rem;
      color: var(--color-text-secondary);
    }

    /* Zone de jeu */
    .game-area {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: var(--spacing-lg);
      max-width: 1200px;
      margin: 0 auto;
    }

    .game-main {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    /* Grille de jeu */
    .game-grid {
      display: grid;
      gap: 0.25rem;
      justify-content: center;
      margin: var(--spacing-md) 0;
    }

    .grid-row {
      display: grid;
      gap: 0.25rem;
    }

    .grid-cell {
      width: 60px;
      height: 60px;
      border: 2px solid var(--color-surface-hover);
      background: var(--color-surface);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      text-transform: uppercase;
      color: var(--color-text-primary);
      border-radius: var(--border-radius-sm);
      transition: all var(--transition-fast);
    }

    .grid-cell.current {
      border-color: var(--color-primary);
      box-shadow: 0 0 10px rgba(46, 204, 113, 0.3);
    }

    .grid-cell.correct {
      background: var(--word-correct);
      border-color: var(--word-correct);
      animation: cellFlip 0.6s ease;
    }

    .grid-cell.present {
      background: var(--word-present);
      border-color: var(--word-present);
      animation: cellFlip 0.6s ease;
    }

    .grid-cell.absent {
      background: var(--word-absent);
      border-color: var(--word-absent);
      animation: cellFlip 0.6s ease;
    }

    .grid-cell.hint {
      background: linear-gradient(135deg, var(--color-info), var(--color-primary));
      border-color: var(--color-info);
      animation: hintReveal 0.8s ease;
    }

    /* Clavier virtuel */
    .keyboard {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 500px;
      margin: 0 auto;
    }

    .keyboard-row {
      display: flex;
      gap: 0.25rem;
      justify-content: center;
    }

    .key-btn {
      padding: 0.75rem;
      background: var(--color-surface-hover);
      border: none;
      border-radius: var(--border-radius-sm);
      color: var(--color-text-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      min-width: 40px;
      font-size: 0.9rem;
    }

    .key-btn:hover {
      background: var(--color-surface-active);
      transform: translateY(-1px);
    }

    .key-btn.key-enter, .key-btn.key-delete {
      font-size: 0.7rem;
      padding: 0.75rem 1rem;
    }

    .key-btn.correct {
      background: var(--word-correct);
    }

    .key-btn.present {
      background: var(--word-present);
    }

    .key-btn.absent {
      background: var(--word-absent);
    }

    /* Sidebar */
    .game-sidebar {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .stats-card, .leaderboard-card {
      background: var(--color-surface);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-md);
      border: 1px solid rgba(46, 204, 113, 0.2);
    }

    .card-title {
      font-family: var(--font-family-secondary);
      font-size: 1.3rem;
      margin-bottom: var(--spacing-sm);
      color: var(--color-primary);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .stat-value {
      font-weight: bold;
      color: var(--color-accent);
    }

    /* Tableau des scores am√©lior√© */
    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      table-layout: fixed;
    }

    .leaderboard-table th {
      background: var(--color-surface-hover);
      padding: 0.4rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-primary);
      border-bottom: 1px solid rgba(46, 204, 113, 0.3);
      font-size: 0.8rem;
    }

    .leaderboard-table td {
      padding: 0.4rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .leaderboard-table tr:hover {
      background: var(--color-surface-hover);
    }

    .leaderboard-table .rank {
      width: 20%;
      text-align: center;
      font-weight: bold;
    }

    .leaderboard-table .player {
      width: 45%;
    }

    .leaderboard-table .score {
      width: 35%;
      text-align: right;
      font-weight: bold;
      color: var(--color-accent);
      font-size: 0.8rem;
    }

    /* √âcran d'accueil */
    .welcome-screen {
      text-align: center;
      padding: var(--spacing-xl);
      max-width: 800px;
      margin: 0 auto;
    }

    .difficulty-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .difficulty-btn {
      background: var(--color-surface);
      border: 2px solid rgba(46, 204, 113, 0.3);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-md);
      color: var(--color-text-primary);
      cursor: pointer;
      transition: all var(--transition-normal);
      text-decoration: none;
      display: block;
    }

    .difficulty-btn:hover {
      border-color: var(--color-primary);
      background: var(--color-surface-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .difficulty-btn.active {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.1);
    }

    .difficulty-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: var(--color-primary);
    }

    .difficulty-desc {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
    }

    /* Boutons */
    .btn {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: white;
      padding: 0.75rem 2rem;
      border: none;
      border-radius: var(--border-radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 1rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--color-info), var(--color-primary));
    }

    .btn-lg {
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Messages */
    .message {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--color-surface);
      border: 1px solid var(--color-primary);
      border-radius: var(--border-radius-md);
      padding: 1rem 2rem;
      color: var(--color-text-primary);
      z-index: 1001;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transition: all var(--transition-normal);
    }

    .message.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .message.success {
      border-color: var(--color-primary);
      background: rgba(46, 204, 113, 0.1);
    }

    .message.error {
      border-color: var(--color-danger);
      background: rgba(231, 76, 60, 0.1);
    }

    .message.warning {
      border-color: var(--color-warning);
      background: rgba(243, 156, 18, 0.1);
    }

    /* Classes utilitaires */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    /* Power-ups */
    .power-ups {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: var(--spacing-md) 0;
    }

    .power-up {
      background: var(--color-surface);
      border: 2px solid rgba(46, 204, 113, 0.3);
      border-radius: var(--border-radius-md);
      padding: 1rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      text-align: center;
      min-width: 100px;
    }

    .power-up:hover {
      border-color: var(--color-primary);
      background: var(--color-surface-hover);
      transform: translateY(-2px);
    }

    .power-up.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .power-up-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--color-primary);
    }

    .power-up-name {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
    }

    /* Styles pour les r√©compenses */
    .reward-notification {
      position: fixed;
      top: 150px;
      right: 20px;
      background: linear-gradient(135deg, var(--color-accent), #e67e22);
      color: white;
      padding: 1rem;
      border-radius: var(--border-radius-md);
      z-index: 1002;
      transform: translateX(400px);
      transition: transform 0.5s ease;
      box-shadow: var(--shadow-lg);
    }

    .reward-notification.show {
      transform: translateX(0);
    }

    .reward-icon {
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    /* Animations */
    @keyframes cellFlip {
      0% { transform: scaleY(1); }
      50% { transform: scaleY(0); }
      100% { transform: scaleY(1); }
    }

    @keyframes hintReveal {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
      20%, 40%, 60%, 80% { transform: translateX(2px); }
    }

    @keyframes dance {
      0%, 100% { transform: translateY(0); }
      25% { transform: translateY(-10px); }
      75% { transform: translateY(-5px); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .game-area {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .game-sidebar {
        order: -1;
      }

      .grid-cell {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }

      .game-title {
        font-size: 2rem;
      }

      .difficulty-selection {
        grid-template-columns: 1fr;
      }

      .leaderboard-table {
        font-size: 0.75rem;
      }

      .leaderboard-table th,
      .leaderboard-table td {
        padding: 0.3rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-container">
      <a href="../index.html" class="logo">ENGLISH<span>QUEST</span></a>

      <nav class="nav">
        <ul class="nav-list">
          <li><a href="../index.html" class="nav-link">Accueil</a></li>
          <li><a href="../games.html" class="nav-link">Jeux</a></li>
          <li><a href="../courses.html" class="nav-link">Cours</a></li>
          <li><a href="../gallery.html" class="nav-link">Galerie</a></li>
          <li><a href="../leaderboard.html" class="nav-link">Classement</a></li>
        </ul>
      </nav>

      <div class="user-menu" id="userMenu">
        <a href="../login.html" class="btn-login" id="loginButton">Connexion</a>
        <a href="../profile.html" class="btn-login" id="profileButton" style="display: none;">Mon Profil</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- √âcran de connexion obligatoire -->
    <div id="authRequired" class="auth-required hidden">
      <div class="container">
        <div style="text-align: center; margin-bottom: 2rem;">
          <i class="fas fa-lock" style="font-size: 4rem; color: var(--color-primary); margin-bottom: 1rem;"></i>
          <h1>üîí Acc√®s Restreint</h1>
          <p style="font-size: 1.4rem; margin-bottom: 1rem;">
            <strong>Connexion obligatoire pour jouer √† Enigma Scroll</strong>
          </p>
          <p style="font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
            üéÆ Pour acc√©der au jeu et sauvegarder votre progression, vos scores et vos r√©compenses (or & XP), vous devez √™tre connect√© √† votre compte English Quest.
          </p>
          
          <div style="background: var(--color-surface); border-radius: var(--border-radius-lg); padding: 1.5rem; margin: 2rem auto; max-width: 500px; border: 1px solid rgba(46, 204, 113, 0.3);">
            <h3 style="color: var(--color-primary); margin-bottom: 1rem;">‚ú® Avantages de la connexion :</h3>
            <ul style="text-align: left; list-style: none; padding: 0;">
              <li style="margin-bottom: 0.5rem;">üèÜ Sauvegarde automatique de vos scores</li>
              <li style="margin-bottom: 0.5rem;">üí∞ Gagner de l'or et de l'XP</li>
              <li style="margin-bottom: 0.5rem;">üìä Classement global</li>
              <li style="margin-bottom: 0.5rem;">üéØ Suivi de vos performances</li>
              <li style="margin-bottom: 0.5rem;">üéÆ Acc√®s √† tous les jeux</li>
            </ul>
          </div>
        </div>
        
        <div style="display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap;">
          <a href="../login.html" class="btn btn-lg" style="min-width: 200px;">
            <i class="fas fa-sign-in-alt"></i>
            Se connecter
          </a>
          <a href="../register.html" class="btn btn-secondary btn-lg" style="min-width: 200px;">
            <i class="fas fa-user-plus"></i>
            Cr√©er un compte
          </a>
        </div>
        
        <p style="margin-top: 2rem; font-size: 0.9rem; color: var(--color-text-disabled);">
          Pas encore de compte ? L'inscription est gratuite et prend moins d'une minute !
        </p>
      </div>
    </div>

    <!-- √âcran d'accueil du jeu -->
    <div id="welcomeScreen" class="welcome-screen hidden">
      <div class="container">
        <div class="game-header">
          <h1 class="game-title">Enigma Scroll</h1>
          <p class="game-subtitle">D√©chiffrez les parchemins myst√©rieux et devinez des mots cach√©s en anglais</p>
        </div>

        <div class="difficulty-selection">
          <div class="difficulty-btn" data-difficulty="easy">
            <div class="difficulty-title">Facile</div>
            <div class="difficulty-desc">Mots de 4 lettres<br>6 tentatives</div>
          </div>
          <div class="difficulty-btn" data-difficulty="medium">
            <div class="difficulty-title">Moyen</div>
            <div class="difficulty-desc">Mots de 5 lettres<br>6 tentatives</div>
          </div>
          <div class="difficulty-btn" data-difficulty="hard">
            <div class="difficulty-title">Difficile</div>
            <div class="difficulty-desc">Mots de 6 lettres<br>6 tentatives</div>
          </div>
        </div>

        <button id="startGameButton" class="btn btn-lg" disabled>
          <i class="fas fa-play"></i>
          Commencer la Partie
        </button>
      </div>
    </div>

    <!-- Zone de jeu -->
    <div id="gameArea" class="game-area hidden">
      <div class="game-main">
        <!-- Power-ups -->
        <div class="power-ups">
          <div class="power-up" data-type="hint">
            <div class="power-up-icon">üí°</div>
            <div class="power-up-name">Indice (1)</div>
          </div>
          <div class="power-up" data-type="time">
            <div class="power-up-icon">‚è∞</div>
            <div class="power-up-name">+15s (2)</div>
          </div>
          <div class="power-up" data-type="skip">
            <div class="power-up-icon">‚è≠Ô∏è</div>
            <div class="power-up-name">Passer (3)</div>
          </div>
        </div>

        <!-- Grille de jeu -->
        <div id="gameGrid" class="game-grid"></div>

        <!-- Clavier virtuel -->
        <div class="keyboard">
          <div class="keyboard-row">
            <button class="key-btn">Q</button>
            <button class="key-btn">W</button>
            <button class="key-btn">E</button>
            <button class="key-btn">R</button>
            <button class="key-btn">T</button>
            <button class="key-btn">Y</button>
            <button class="key-btn">U</button>
            <button class="key-btn">I</button>
            <button class="key-btn">O</button>
            <button class="key-btn">P</button>
          </div>
          <div class="keyboard-row">
            <button class="key-btn">A</button>
            <button class="key-btn">S</button>
            <button class="key-btn">D</button>
            <button class="key-btn">F</button>
            <button class="key-btn">G</button>
            <button class="key-btn">H</button>
            <button class="key-btn">J</button>
            <button class="key-btn">K</button>
            <button class="key-btn">L</button>
          </div>
          <div class="keyboard-row">
            <button class="key-btn key-enter">ENTER</button>
            <button class="key-btn">Z</button>
            <button class="key-btn">X</button>
            <button class="key-btn">C</button>
            <button class="key-btn">V</button>
            <button class="key-btn">B</button>
            <button class="key-btn">N</button>
            <button class="key-btn">M</button>
            <button class="key-btn key-delete">‚å´</button>
          </div>
        </div>

        <div class="text-center">
          <button id="newGameButton" class="btn btn-secondary" style="display: none;">
            <i class="fas fa-redo"></i>
            Nouvelle Partie
          </button>
        </div>
      </div>

      <div class="game-sidebar">
        <!-- Statistiques -->
        <div class="stats-card">
          <h3 class="card-title">Statistiques</h3>
          <div class="stat-item">
            <span>Score:</span>
            <span class="stat-value" id="currentScore">0</span>
          </div>
          <div class="stat-item">
            <span>Combo:</span>
            <span class="stat-value" id="currentCombo">1</span>
          </div>
          <div class="stat-item">
            <span>Mots trouv√©s:</span>
            <span class="stat-value" id="wordsFound">0</span>
          </div>
          <div class="stat-item">
            <span>Temps restant:</span>
            <span class="stat-value" id="timeLeft">90</span>
          </div>
          <div class="stat-item">
            <span>Or:</span>
            <span class="stat-value" id="playerGold">0</span>
          </div>
          <div class="stat-item">
            <span>XP:</span>
            <span class="stat-value" id="playerXP">0</span>
          </div>
        </div>

        <!-- Classement -->
        <div class="leaderboard-card">
          <h3 class="card-title">Meilleurs Scores</h3>
          <table class="leaderboard-table">
            <thead>
              <tr>
                <th class="rank">#</th>
                <th class="player">Joueur</th>
                <th class="score">Score</th>
              </tr>
            </thead>
            <tbody id="leaderboardBody">
              <tr>
                <td colspan="3" style="text-align: center; color: var(--color-text-secondary);">
                  Chargement...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Message de notification -->
  <div id="messageContainer" class="message"></div>

  <!-- Notification de r√©compense -->
  <div id="rewardNotification" class="reward-notification">
    <i class="fas fa-coins reward-icon"></i>
    <span id="rewardText"></span>
  </div>

  <script>
    // ===========================================
    // DONN√âES ET CONFIGURATION
    // ===========================================
    
    const TARGET_WORDS = {
      4: ['WORD', 'GAME', 'PLAY', 'LOVE', 'TIME', 'LIFE', 'HOPE', 'TREE', 'BOOK', 'FIRE', 'BLUE', 'MOON', 'STAR', 'GOLD', 'FISH', 'BIRD', 'WIND', 'RAIN', 'SNOW', 'CAKE'],
      5: ['HOUSE', 'LIGHT', 'WORLD', 'SMILE', 'PEACE', 'MAGIC', 'DREAM', 'HAPPY', 'LUCKY', 'ANGEL', 'BRAVE', 'CLEAN', 'DANCE', 'EARTH', 'FRESH', 'GRACE', 'HEART', 'JOLLY', 'QUICK', 'SWEET'],
      6: ['FRIEND', 'CASTLE', 'DRAGON', 'FOREST', 'GENTLE', 'BRIGHT', 'STRONG', 'WISDOM', 'HEALTH', 'MOTHER', 'FATHER', 'SCHOOL', 'TALENT', 'SPRING', 'GOLDEN', 'SILENT', 'PLANET', 'FLOWER', 'ISLAND', 'MARKET']
    };

    const DIFFICULTIES = {
      easy: { wordLength: 4, maxAttempts: 6, timeLimit: 90 },
      medium: { wordLength: 5, maxAttempts: 6, timeLimit: 90 },
      hard: { wordLength: 6, maxAttempts: 6, timeLimit: 90 }
    };

    // Variables du jeu
    let gameState = {
      gameActive: false,
      currentWord: '',
      currentRow: 0,
      currentCol: 0,
      wordLength: 5,
      maxAttempts: 6,
      timeLeft: 90,
      score: 0,
      combo: 1,
      bestCombo: 1,
      wordsFound: 0,
      boardState: [],
      keyboardState: {},
      selectedDifficulty: null,
      validatingWord: false,
      gameStarted: false
    };

    let gameTimer = null;
    let randomEventTimer = null;
    let currentUser = null;
    let userProfile = null;

    // ===========================================
    // SYST√àME D'AUTHENTIFICATION ET PROFIL
    // ===========================================

    async function checkAuthentication() {
      console.log('V√©rification de l\'authentification...');
      
      // Attendre que les services soient pr√™ts
      await new Promise(resolve => {
        const checkServices = () => {
          if (window.authService || localStorage.getItem('userSession')) {
            resolve();
          } else {
            setTimeout(checkServices, 100);
          }
        };
        checkServices();
      });

      // Utiliser le syst√®me d'authentification du reborn
      if (window.authService) {
        await window.authService.init();
        currentUser = window.authService.getCurrentUser();
      } else {
        // Fallback vers le syst√®me simple
        const userData = localStorage.getItem('userSession');
        currentUser = userData ? JSON.parse(userData) : null;
      }

      console.log('Utilisateur actuel:', currentUser);
      updateAuthUI();
      
      if (!currentUser) {
        document.getElementById('authRequired').classList.remove('hidden');
        return false;
      }

      await loadUserProfile();
      document.getElementById('welcomeScreen').classList.remove('hidden');
      return true;
    }

    function updateAuthUI() {
      const loginButton = document.getElementById('loginButton');
      const profileButton = document.getElementById('profileButton');
      const userMenu = document.getElementById('userMenu');

      // Supprimer les anciens boutons de d√©connexion
      const existingLogoutButtons = document.querySelectorAll('#logoutButton');
      existingLogoutButtons.forEach(btn => btn.remove());

      if (currentUser) {
        loginButton.style.display = 'none';
        profileButton.style.display = 'inline-flex';
        
        // Mettre √† jour le texte du bouton profil
        if (currentUser.displayName) {
          profileButton.textContent = currentUser.displayName;
        } else if (currentUser.username) {
          profileButton.textContent = currentUser.username;
        } else if (currentUser.email) {
          profileButton.textContent = currentUser.email.split('@')[0];
        } else {
          profileButton.textContent = 'Mon Profil';
        }

        // Ajouter le bouton de d√©connexion
        const logoutButton = document.createElement('a');
        logoutButton.id = 'logoutButton';
        logoutButton.className = 'btn-logout';
        logoutButton.textContent = 'D√©connexion';
        logoutButton.href = '#';
        logoutButton.addEventListener('click', async (e) => {
          e.preventDefault();
          await logout();
        });
        
        userMenu.appendChild(logoutButton);
      } else {
        loginButton.style.display = 'inline-flex';
        profileButton.style.display = 'none';
      }
    }

    async function logout() {
      if (window.authService) {
        await window.authService.logout();
      } else {
        localStorage.removeItem('userSession');
      }
      currentUser = null;
      userProfile = null;
      window.location.reload();
    }

    async function loadUserProfile() {
      if (!currentUser) return;

      try {
        if (window.firebaseServiceInstance && window.firebaseServiceInstance.getProfile) {
          userProfile = await window.firebaseServiceInstance.getProfile(currentUser.uid);
        }

        // Initialiser le profil s'il n'existe pas
        if (!userProfile) {
          userProfile = {
            gold: 0,
            xp: 0,
            gamesPlayed: 0,
            totalScore: 0
          };
        }

        document.getElementById('playerGold').textContent = userProfile.gold || 0;
        document.getElementById('playerXP').textContent = userProfile.xp || 0;
      } catch (error) {
        console.error('Erreur lors du chargement du profil:', error);
        // Profil par d√©faut en cas d'erreur
        userProfile = { gold: 0, xp: 0, gamesPlayed: 0, totalScore: 0 };
        document.getElementById('playerGold').textContent = 0;
        document.getElementById('playerXP').textContent = 0;
      }
    }

    async function updateUserProgress(goldEarned, xpEarned, isTopScore = false) {
      if (!currentUser) return;

      try {
        const newGold = (userProfile.gold || 0) + goldEarned;
        const newXP = (userProfile.xp || 0) + xpEarned;
        const newGamesPlayed = (userProfile.gamesPlayed || 0) + 1;

        const updateData = {
          gold: newGold,
          xp: newXP,
          gamesPlayed: newGamesPlayed,
          lastActivity: new Date()
        };

        if (window.firebaseServiceInstance && window.firebaseServiceInstance.updateProfile) {
          await window.firebaseServiceInstance.updateProfile(currentUser.uid, updateData);
        }
        
        // Mettre √† jour l'affichage local
        userProfile.gold = newGold;
        userProfile.xp = newXP;
        userProfile.gamesPlayed = newGamesPlayed;
        document.getElementById('playerGold').textContent = newGold;
        document.getElementById('playerXP').textContent = newXP;

        // Afficher la notification de r√©compense
        showRewardNotification(goldEarned, xpEarned, isTopScore);
      } catch (error) {
        console.error('Erreur lors de la mise √† jour du profil:', error);
        // Mettre √† jour localement m√™me en cas d'erreur
        userProfile.gold = (userProfile.gold || 0) + goldEarned;
        userProfile.xp = (userProfile.xp || 0) + xpEarned;
        document.getElementById('playerGold').textContent = userProfile.gold;
        document.getElementById('playerXP').textContent = userProfile.xp;
        showRewardNotification(goldEarned, xpEarned, isTopScore);
      }
    }

    function showRewardNotification(gold, xp, isTopScore) {
      const notification = document.getElementById('rewardNotification');
      const rewardText = document.getElementById('rewardText');
      
      if (isTopScore) {
        rewardText.textContent = `üèÜ Top Score! +${gold} or, +${xp} XP`;
        notification.style.background = 'linear-gradient(135deg, #f1c40f, #e67e22)';
      } else {
        rewardText.textContent = `üéÆ Partie termin√©e! +${gold} or, +${xp} XP`;
        notification.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
      }
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    // ===========================================
    // SYST√àME DE SCORES ET CLASSEMENT
    // ===========================================

    async function saveScore(finalScore, wordsCount, difficulty) {
      if (!currentUser) return;

      try {
        const scoreData = {
          userId: currentUser.uid,
          username: currentUser.username || currentUser.displayName || currentUser.email?.split('@')[0] || 'Joueur',
          game: 'enigma-scroll',
          score: finalScore,
          wordsFound: wordsCount,
          difficulty: difficulty,
          timestamp: new Date()
        };

        if (window.firebaseServiceInstance && window.firebaseServiceInstance.addScore) {
          await window.firebaseServiceInstance.addScore(scoreData);
        }
        
        // V√©rifier si c'est un top score
        const isTopScore = await checkIfTopScore(finalScore);
        
        // R√©compenses : 1 or et 1 XP pour terminer, 20 or et 20 XP pour top score
        const goldReward = isTopScore ? 20 : 1;
        const xpReward = isTopScore ? 20 : 1;
        
        await updateUserProgress(goldReward, xpReward, isTopScore);
        
        // Recharger le classement
        await loadLeaderboard();
      } catch (error) {
        console.error('Erreur lors de la sauvegarde du score:', error);
        // Donner quand m√™me les r√©compenses m√™me si la sauvegarde √©choue
        await updateUserProgress(1, 1, false);
      }
    }

    async function checkIfTopScore(score) {
      try {
        // Crit√®re simple pour un top score
        return score > 1000;
      } catch (error) {
        console.error('Erreur lors de la v√©rification du top score:', error);
        return false;
      }
    }

    async function loadLeaderboard() {
      const leaderboardBody = document.getElementById('leaderboardBody');
      
      try {
        // Affichage d'exemple en attendant l'impl√©mentation compl√®te
        const sampleData = [
          { rank: 1, player: 'Alex', score: 2450 },
          { rank: 2, player: 'Marie', score: 2100 },
          { rank: 3, player: 'Tom', score: 1890 },
          { rank: 4, player: 'Lisa', score: 1650 },
          { rank: 5, player: 'John', score: 1420 }
        ];

        leaderboardBody.innerHTML = sampleData.map(data => `
          <tr>
            <td class="rank">${data.rank}</td>
            <td class="player">${data.player}</td>
            <td class="score">${data.score}</td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('Erreur lors du chargement du classement:', error);
        leaderboardBody.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; color: var(--color-danger);">
              Erreur de chargement
            </td>
          </tr>
        `;
      }
    }

    // ===========================================
    // LOGIQUE DE JEU
    // ===========================================

    function createGrid() {
      const gameGrid = document.getElementById('gameGrid');
      gameGrid.innerHTML = '';
      gameGrid.style.gridTemplateColumns = `repeat(${gameState.wordLength}, 1fr)`;
      
      gameState.boardState = [];
      
      for (let row = 0; row < gameState.maxAttempts; row++) {
        gameState.boardState[row] = [];
        const rowDiv = document.createElement('div');
        rowDiv.className = 'grid-row';
        rowDiv.style.gridTemplateColumns = `repeat(${gameState.wordLength}, 1fr)`;
        
        for (let col = 0; col < gameState.wordLength; col++) {
          const cell = document.createElement('div');
          cell.className = 'grid-cell';
          cell.dataset.row = row;
          cell.dataset.col = col;
          
          gameState.boardState[row][col] = { letter: '', state: '' };
          rowDiv.appendChild(cell);
        }
        
        gameGrid.appendChild(rowDiv);
      }
    }

    function updateDisplay() {
      document.getElementById('currentScore').textContent = gameState.score;
      document.getElementById('currentCombo').textContent = gameState.combo;
      document.getElementById('wordsFound').textContent = gameState.wordsFound;
      document.getElementById('timeLeft').textContent = gameState.timeLeft;
      
      // Mettre √† jour la grille
      for (let row = 0; row < gameState.maxAttempts; row++) {
        for (let col = 0; col < gameState.wordLength; col++) {
          const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
          const cellData = gameState.boardState[row][col];
          
          cell.textContent = cellData.letter;
          cell.className = 'grid-cell';
          
          if (cellData.state) {
            cell.classList.add(cellData.state);
          }
          
          if (row === gameState.currentRow && col === gameState.currentCol && gameState.gameActive) {
            cell.classList.add('current');
          }
        }
      }
    }

    function addLetter(letter) {
      if (!gameState.gameActive || gameState.currentCol >= gameState.wordLength) return;
      
      const cell = document.querySelector(`[data-row="${gameState.currentRow}"][data-col="${gameState.currentCol}"]`);
      cell.textContent = letter;
      gameState.boardState[gameState.currentRow][gameState.currentCol].letter = letter;
      gameState.currentCol++;
      updateDisplay();
    }

    function deleteLetter() {
      if (!gameState.gameActive || gameState.currentCol <= 0) return;
      
      gameState.currentCol--;
      const cell = document.querySelector(`[data-row="${gameState.currentRow}"][data-col="${gameState.currentCol}"]`);
      cell.textContent = '';
      gameState.boardState[gameState.currentRow][gameState.currentCol].letter = '';
      updateDisplay();
    }

    async function submitWord() {
      if (!gameState.gameActive || gameState.validatingWord) return;
      if (gameState.currentCol < gameState.wordLength) {
        showMessage('Mot incomplet !', 'warning');
        return;
      }
      
      gameState.validatingWord = true;
      
      const guess = gameState.boardState[gameState.currentRow]
        .map(cell => cell.letter)
        .join('')
        .toUpperCase();
      
      showMessage('V√©rification du mot...', 'info');
      
      try {
        const isValid = await validateWord(guess);
        
        if (!isValid) {
          showMessage('Mot non valide !', 'error');
          // Animation de secousse
          const row = document.querySelector(`[data-row="${gameState.currentRow}"]`);
          if (row) {
            row.style.animation = 'shake 0.5s ease';
            setTimeout(() => row.style.animation = '', 500);
          }
          gameState.validatingWord = false;
          return;
        }
        
        processGuess(guess);
        
      } catch (error) {
        console.error('Erreur validation:', error);
        showMessage('Erreur de validation', 'error');
        gameState.validatingWord = false;
      }
    }

    async function validateWord(word) {
      try {
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word.toLowerCase()}`);
        return response.ok;
      } catch (error) {
        console.error('Erreur validation API:', error);
        return true; // En cas d'erreur, on accepte le mot
      }
    }

    function processGuess(guess) {
      const targetWord = gameState.currentWord.toUpperCase();
      const guessArray = guess.split('');
      const targetArray = targetWord.split('');
      const result = new Array(gameState.wordLength).fill('absent');
      const targetLetterCount = {};
      
      // Compter les lettres dans le mot cible
      targetArray.forEach(letter => {
        targetLetterCount[letter] = (targetLetterCount[letter] || 0) + 1;
      });
      
      // Premi√®re passe : marquer les lettres correctes
      guessArray.forEach((letter, index) => {
        if (letter === targetArray[index]) {
          result[index] = 'correct';
          targetLetterCount[letter]--;
        }
      });
      
      // Deuxi√®me passe : marquer les lettres pr√©sentes
      guessArray.forEach((letter, index) => {
        if (result[index] === 'absent' && targetLetterCount[letter] > 0) {
          result[index] = 'present';
          targetLetterCount[letter]--;
        }
      });
      
      // Appliquer les r√©sultats
      result.forEach((state, index) => {
        gameState.boardState[gameState.currentRow][index].state = state;
        
        // Mettre √† jour le clavier
        const letter = guessArray[index];
        const currentState = gameState.keyboardState[letter];
        
        if (!currentState || (currentState === 'absent' && state !== 'absent') || 
            (currentState === 'present' && state === 'correct')) {
          gameState.keyboardState[letter] = state;
        }
      });
      
      updateKeyboard();
      updateDisplay();
      
      // V√©rifier la victoire
      if (guess === targetWord) {
        endGame(true, 'F√©licitations ! Mot trouv√© !');
      } else {
        gameState.currentRow++;
        gameState.currentCol = 0;
        gameState.validatingWord = false;
        
        // V√©rifier si plus de tentatives
        if (gameState.currentRow >= gameState.maxAttempts) {
          endGame(false, `√âchec ! Le mot √©tait : ${targetWord}`);
        }
      }
    }

    function updateKeyboard() {
      document.querySelectorAll('.key-btn').forEach(key => {
        const letter = key.textContent;
        if (letter.length === 1 && gameState.keyboardState[letter]) {
          key.className = `key-btn ${gameState.keyboardState[letter]}`;
        }
      });
    }

    function startGame(difficulty) {
      gameState.selectedDifficulty = difficulty;
      const config = DIFFICULTIES[difficulty];
      gameState.wordLength = config.wordLength;
      gameState.maxAttempts = config.maxAttempts;
      gameState.timeLeft = config.timeLimit;
      gameState.currentRow = 0;
      gameState.currentCol = 0;
      gameState.gameActive = true;
      gameState.keyboardState = {};
      gameState.validatingWord = false;
      gameState.gameStarted = true;
      
      // Choisir un mot al√©atoire
      const wordList = TARGET_WORDS[gameState.wordLength];
      gameState.currentWord = wordList[Math.floor(Math.random() * wordList.length)];
      
      // Interface
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('gameArea').classList.remove('hidden');
      
      createGrid();
      updateDisplay();
      startTimer();
      startRandomEvents();
      
      showMessage(`Nouvelle partie ! Mot de ${gameState.wordLength} lettres`, 'success');
    }

    function startTimer() {
      if (gameTimer) clearInterval(gameTimer);
      
      gameTimer = setInterval(() => {
        gameState.timeLeft--;
        updateDisplay();
        
        if (gameState.timeLeft <= 0) {
          endGame(false, 'Temps √©coul√© !');
        }
      }, 1000);
    }

    function stopTimer() {
      if (gameTimer) {
        clearInterval(gameTimer);
        gameTimer = null;
      }
    }

    function startRandomEvents() {
      if (randomEventTimer) clearInterval(randomEventTimer);
      
      randomEventTimer = setInterval(() => {
        if (Math.random() < 0.3) {
          triggerRandomEvent();
        }
      }, 25000);
    }

    function stopRandomEvents() {
      if (randomEventTimer) {
        clearInterval(randomEventTimer);
        randomEventTimer = null;
      }
    }

    function triggerRandomEvent() {
      if (!gameState.gameActive) return;
      
      const events = [
        {
          name: 'Bonus Time',
          action: () => {
            gameState.timeLeft += 15;
            showMessage('üéÅ √âv√©nement : +15 secondes !', 'success');
          }
        },
        {
          name: 'Double Score',
          action: () => {
            gameState.combo = Math.min(gameState.combo * 2, 10);
            showMessage('üéÅ √âv√©nement : Combo doubl√© !', 'success');
          }
        }
      ];
      
      const randomEvent = events[Math.floor(Math.random() * events.length)];
      randomEvent.action();
      updateDisplay();
    }

    function endGame(won, message) {
      gameState.gameActive = false;
      gameState.validatingWord = false;
      stopTimer();
      stopRandomEvents();
      
      if (won) {
        // Calculer le score
        const baseScore = 100 * gameState.wordLength;
        const timeBonus = gameState.timeLeft * 2;
        const attemptBonus = (gameState.maxAttempts - gameState.currentRow) * 20;
        const totalScore = (baseScore + timeBonus + attemptBonus) * gameState.combo;
        
        gameState.score += totalScore;
        gameState.combo++;
        gameState.wordsFound++;
        
        // Mettre √† jour le meilleur combo
        if (gameState.combo > gameState.bestCombo) {
          gameState.bestCombo = gameState.combo;
        }
        
        showMessage(`${message} Score: +${totalScore}`, 'success', 3000);
        
        // Sauvegarder le score et donner des r√©compenses
        saveScore(gameState.score, gameState.wordsFound, gameState.selectedDifficulty);
        
        // Passage automatique au mot suivant apr√®s 2 secondes
        setTimeout(() => {
          if (gameState.selectedDifficulty) {
            showMessage('Nouveau mot !', 'info', 1000);
            setTimeout(() => {
              startGame(gameState.selectedDifficulty);
            }, 500);
          }
        }, 2000);
        
      } else {
        // Sauvegarder le score final en cas d'√©chec
        if (gameState.gameStarted) {
          saveScore(gameState.score, gameState.wordsFound, gameState.selectedDifficulty);
        }
        
        gameState.combo = 1;
        showMessage(message, 'error', 3000);
        
        // Afficher le bouton nouveau jeu
        setTimeout(() => {
          document.getElementById('newGameButton').style.display = 'inline-flex';
        }, 2000);
      }
      
      updateDisplay();
    }

    function newGame() {
      document.getElementById('newGameButton').style.display = 'none';
      gameState.score = 0;
      gameState.combo = 1;
      gameState.wordsFound = 0;
      gameState.gameStarted = false;
      
      if (gameState.selectedDifficulty) {
        startGame(gameState.selectedDifficulty);
      } else {
        document.getElementById('gameArea').classList.add('hidden');
        document.getElementById('welcomeScreen').classList.remove('hidden');
      }
    }

    // Power-ups
    function usePowerUp(type) {
      if (!gameState.gameActive) return;
      
      switch (type) {
        case 'hint':
          // R√©v√©ler une lettre
          const availablePositions = [];
          for (let i = 0; i < gameState.wordLength; i++) {
            if (gameState.boardState[gameState.currentRow][i].letter === '') {
              availablePositions.push(i);
            }
          }
          
          if (availablePositions.length > 0) {
            const randomPos = availablePositions[Math.floor(Math.random() * availablePositions.length)];
            const cell = document.querySelector(`[data-row="${gameState.currentRow}"][data-col="${randomPos}"]`);
            const letter = gameState.currentWord[randomPos];
            
            cell.textContent = letter;
            cell.classList.add('hint');
            gameState.boardState[gameState.currentRow][randomPos].letter = letter;
            
            // Mettre √† jour la position actuelle
            gameState.currentCol = Math.max(gameState.currentCol, randomPos + 1);
            showMessage('üí° Indice utilis√© !', 'success');
          }
          break;
          
        case 'time':
          gameState.timeLeft += 15;
          showMessage('‚è∞ +15 secondes !', 'success');
          break;
          
        case 'skip':
          if (gameState.selectedDifficulty) {
            showMessage('‚è≠Ô∏è Mot pass√© !', 'info');
            setTimeout(() => {
              startGame(gameState.selectedDifficulty);
            }, 500);
          }
          break;
      }
      
      updateDisplay();
    }

    // Messages
    function showMessage(text, type = 'info', duration = 2000) {
      const messageContainer = document.getElementById('messageContainer');
      messageContainer.textContent = text;
      messageContainer.className = `message ${type}`;
      messageContainer.classList.add('show');
      
      setTimeout(() => {
        messageContainer.classList.remove('show');
      }, duration);
    }

    // ===========================================
    // GESTIONNAIRES D'√âV√âNEMENTS
    // ===========================================

    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üéÆ Initialisation d\'Enigma Scroll...');
      
      // V√©rifier l'authentification
      const isAuthenticated = await checkAuthentication();
      if (!isAuthenticated) {
        return;
      }
      
      // Charger le classement initial
      await loadLeaderboard();
      
      // S√©lection de difficult√©
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          const difficulty = this.dataset.difficulty;
          gameState.selectedDifficulty = difficulty;
          
          document.getElementById('startGameButton').disabled = false;
        });
      });
      
      // Bouton commencer
      document.getElementById('startGameButton').addEventListener('click', function() {
        if (!gameState.selectedDifficulty) {
          showMessage('Veuillez s√©lectionner une difficult√© !', 'warning');
          return;
        }
        startGame(gameState.selectedDifficulty);
      });
      
      // Power-ups
      document.querySelectorAll('.power-up').forEach(item => {
        item.addEventListener('click', function() {
          const type = this.dataset.type;
          usePowerUp(type);
        });
      });
      
      // Clavier virtuel
      document.querySelectorAll('.key-btn').forEach(key => {
        key.addEventListener('click', function() {
          const keyText = this.textContent;
          handleKeyPress(keyText);
        });
      });
      
      // Clavier physique
      document.addEventListener('keydown', function(e) {
        const key = e.key.toUpperCase();
        
        // Power-ups avec touches num√©riques
        if (key === '1') { usePowerUp('hint'); return; }
        if (key === '2') { usePowerUp('time'); return; }
        if (key === '3') { usePowerUp('skip'); return; }
        
        handleKeyPress(key);
      });
      
      // Nouveau jeu
      document.getElementById('newGameButton').addEventListener('click', newGame);
      
      console.log('‚úÖ Enigma Scroll initialis√© avec succ√®s !');
    });

    function handleKeyPress(key) {
      if (!gameState.gameActive || gameState.validatingWord) return;
      
      if (key === 'ENTER') {
        submitWord();
      } else if (key === '‚å´' || key === 'BACKSPACE') {
        deleteLetter();
      } else if (key.match(/^[A-Z]$/)) {
        addLetter(key);
      }
    }
  </script>
</body>
</html> 