<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Enigma Scroll - Un jeu de mots mysterieux ou vous devez deviner des mots caches en anglais">
  <meta name="theme-color" content="#121212">
  <title>🧩 Enigma Scroll - Déchiffrez les Mots Mystères</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Exo+2:wght@300;400;600;700&family=Spectral:wght@300;400;500;600&family=MedievalSharp&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- Système d'avatars animés -->
  <link rel="stylesheet" href="../styles/avatar-animations.css">
  
  <!-- CSS FORCÉ pour avatar - SURCHARGE ULTRA-ROBUSTE -->
  <style>
    /* FORCER L'AVATAR - SURCHARGE ABSOLUE */
    .ultra-reactive-adventurer,
    #ultra-adventurer {
      position: fixed !important;
      bottom: 20px !important;
      right: 20px !important;
      width: 80px !important;
      height: 120px !important;
      z-index: 99999 !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      pointer-events: none !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      background: none !important;
      border: none !important;
      box-shadow: none !important;
      transition: top 4s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                  right 4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                  opacity 0.3s ease !important;
      overflow: visible !important;
    }
    
    .ultra-reactive-adventurer .adventurer-avatar-ultra,
    #ultra-adventurer .adventurer-avatar-ultra {
      width: 100% !important;
      height: 100% !important;
      position: relative !important;
      margin: 0 !important;
      padding: 0 !important;
      overflow: visible !important;
      display: block !important;
      filter: drop-shadow(0 2px 8px rgba(231, 76, 60, 0.6)) !important;
    }
    
    .ultra-reactive-adventurer .avatar-display-ultra,
    #ultra-adventurer .avatar-display-ultra {
      width: 100% !important;
      height: 100% !important;
      position: relative !important;
      margin: 0 !important;
      padding: 0 !important;
      display: block !important;
    }
    
    .ultra-reactive-adventurer .avatar-body-ultra,
    #ultra-adventurer .avatar-body-ultra,
    .ultra-reactive-adventurer .avatar-body,
    #ultra-adventurer .avatar-body {
      position: absolute !important;
      bottom: 0 !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      width: 75% !important;
      height: auto !important;
      max-height: 60% !important;
      object-fit: contain !important;
      z-index: 5 !important;
      display: block !important;
      margin: 0 !important;
      padding: 0 !important;
      top: auto !important;
      right: auto !important;
      opacity: 1 !important;
      visibility: visible !important;
    }
    
    .ultra-reactive-adventurer .avatar-head-ultra,
    #ultra-adventurer .avatar-head-ultra,
    .ultra-reactive-adventurer .avatar-head,
    #ultra-adventurer .avatar-head,
    .ultra-reactive-adventurer #userAvatarHead,
    #ultra-adventurer #userAvatarHead {
      position: absolute !important;
      top: 30% !important;
      left: 50% !important;
      right: auto !important;
      bottom: auto !important;
      width: 55% !important;
      height: auto !important;
      transform: translateX(-50%) !important;
      object-fit: contain !important;
      z-index: 10 !important;
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      background: none !important;
      font-size: 3rem !important;
      line-height: 1 !important;
      text-align: center !important;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8) !important;
    }

    /* 🎭 ANIMATIONS PHYSIQUES ULTRA-SPECTACULAIRES - SYSTÈME CRESCENDO */
    @keyframes physicalBounce {
      0%, 100% { transform: scale(1) translateY(0) rotate(0deg); }
      25% { transform: scale(1.3) translateY(-20px) rotate(-2deg); }
      50% { transform: scale(1.5) translateY(-35px) rotate(2deg); }
      75% { transform: scale(1.3) translateY(-15px) rotate(-1deg); }
    }

    @keyframes physicalSpin {
      0% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.4); }
      50% { transform: rotate(180deg) scale(1.6); }
      75% { transform: rotate(270deg) scale(1.4); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ANIMATIONS CRESCENDO - NIVEAUX D'INTENSITÉ */
    @keyframes physicalBounceLevel1 {
      0%, 100% { transform: scale(1) translateY(0); }
      50% { transform: scale(1.2) translateY(-15px); }
    }

    @keyframes physicalBounceLevel2 {
      0%, 100% { transform: scale(1) translateY(0) rotate(0deg); }
      25% { transform: scale(1.3) translateY(-20px) rotate(-2deg); }
      50% { transform: scale(1.5) translateY(-35px) rotate(2deg); }
      75% { transform: scale(1.3) translateY(-15px) rotate(-1deg); }
    }

    @keyframes physicalBounceLevel3 {
      0%, 100% { transform: scale(1) translateY(0) rotate(0deg); }
      20% { transform: scale(1.4) translateY(-25px) rotate(-3deg); }
      40% { transform: scale(1.7) translateY(-45px) rotate(3deg); }
      60% { transform: scale(1.6) translateY(-40px) rotate(-2deg); }
      80% { transform: scale(1.3) translateY(-20px) rotate(1deg); }
    }

    @keyframes physicalSpinLevel1 {
      0% { transform: rotate(0deg) scale(1); }
      100% { transform: rotate(360deg) scale(1.1); }
    }

    @keyframes physicalSpinLevel2 {
      0% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.4); }
      50% { transform: rotate(180deg) scale(1.6); }
      75% { transform: rotate(270deg) scale(1.4); }
      100% { transform: rotate(360deg) scale(1); }
    }

    @keyframes physicalSpinLevel3 {
      0% { transform: rotate(0deg) scale(1); }
      16% { transform: rotate(60deg) scale(1.3); }
      33% { transform: rotate(120deg) scale(1.6); }
      50% { transform: rotate(180deg) scale(1.8); }
      66% { transform: rotate(240deg) scale(1.6); }
      83% { transform: rotate(300deg) scale(1.3); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* SUPER ANIMATIONS POUR PERFORMANCES EXCEPTIONNELLES */
    @keyframes physicalSuperBounce {
      0%, 100% { transform: scale(1) translateY(0) rotate(0deg); }
      10% { transform: scale(1.5) translateY(-30px) rotate(-5deg); }
      20% { transform: scale(1.8) translateY(-50px) rotate(5deg); }
      30% { transform: scale(1.6) translateY(-40px) rotate(-3deg); }
      40% { transform: scale(1.9) translateY(-60px) rotate(3deg); }
      50% { transform: scale(2.0) translateY(-70px) rotate(0deg); }
      60% { transform: scale(1.8) translateY(-55px) rotate(-2deg); }
      70% { transform: scale(1.5) translateY(-35px) rotate(2deg); }
      80% { transform: scale(1.3) translateY(-20px) rotate(-1deg); }
      90% { transform: scale(1.1) translateY(-10px) rotate(1deg); }
    }

    @keyframes physicalSuperSpin {
      0% { transform: rotate(0deg) scale(1); }
      12.5% { transform: rotate(45deg) scale(1.2); }
      25% { transform: rotate(90deg) scale(1.5); }
      37.5% { transform: rotate(135deg) scale(1.7); }
      50% { transform: rotate(180deg) scale(2.0); }
      62.5% { transform: rotate(225deg) scale(1.8); }
      75% { transform: rotate(270deg) scale(1.5); }
      87.5% { transform: rotate(315deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    @keyframes physicalJump {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.2); }
    }

    @keyframes physicalWiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
      75% { transform: rotate(-3deg); }
    }

    @keyframes physicalFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @keyframes physicalZoom {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    @keyframes physicalFlash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; filter: brightness(1.5); }
    }

    @keyframes physicalWave {
      0%, 100% { transform: rotate(0deg) translateX(0); }
      25% { transform: rotate(5deg) translateX(2px); }
      50% { transform: rotate(-5deg) translateX(-2px); }
      75% { transform: rotate(3deg) translateX(1px); }
    }

    @keyframes physicalPump {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    @keyframes physicalVictoryDance {
      0%, 100% { transform: rotate(0deg) scale(1); }
      20% { transform: rotate(10deg) scale(1.1); }
      40% { transform: rotate(-10deg) scale(1.2); }
      60% { transform: rotate(8deg) scale(1.1); }
      80% { transform: rotate(-5deg) scale(1.05); }
    }

    @keyframes physicalGlow {
      0%, 100% { filter: brightness(1) drop-shadow(0 0 5px rgba(255, 255, 0, 0.3)); }
      50% { filter: brightness(1.3) drop-shadow(0 0 15px rgba(255, 255, 0, 0.8)); }
    }

    /* Classes d'animation avec niveaux d'intensité */
    .ultra-reactive-adventurer.animation-physicalBounce,
    #ultra-adventurer.animation-physicalBounce {
      animation: physicalBounce 0.8s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalSpin,
    #ultra-adventurer.animation-physicalSpin {
      animation: physicalSpin 1s ease-in-out !important;
    }

    /* Niveaux crescendo */
    .ultra-reactive-adventurer.animation-physicalBounceLevel1,
    #ultra-adventurer.animation-physicalBounceLevel1 {
      animation: physicalBounceLevel1 0.6s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalBounceLevel2,
    #ultra-adventurer.animation-physicalBounceLevel2 {
      animation: physicalBounceLevel2 0.8s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalBounceLevel3,
    #ultra-adventurer.animation-physicalBounceLevel3 {
      animation: physicalBounceLevel3 1.2s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalSpinLevel1,
    #ultra-adventurer.animation-physicalSpinLevel1 {
      animation: physicalSpinLevel1 0.8s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalSpinLevel2,
    #ultra-adventurer.animation-physicalSpinLevel2 {
      animation: physicalSpinLevel2 1.2s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalSpinLevel3,
    #ultra-adventurer.animation-physicalSpinLevel3 {
      animation: physicalSpinLevel3 1.5s ease-in-out !important;
    }

    /* Super animations pour performances exceptionnelles */
    .ultra-reactive-adventurer.animation-physicalSuperBounce,
    #ultra-adventurer.animation-physicalSuperBounce {
      animation: physicalSuperBounce 1.5s ease-in-out !important;
      filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)) !important;
    }

    .ultra-reactive-adventurer.animation-physicalSuperSpin,
    #ultra-adventurer.animation-physicalSuperSpin {
      animation: physicalSuperSpin 2s ease-in-out !important;
      filter: drop-shadow(0 0 25px rgba(255, 0, 255, 0.8)) !important;
    }

    .ultra-reactive-adventurer.animation-physicalJump,
    #ultra-adventurer.animation-physicalJump {
      animation: physicalJump 0.6s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalWiggle,
    #ultra-adventurer.animation-physicalWiggle {
      animation: physicalWiggle 0.8s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalFloat,
    #ultra-adventurer.animation-physicalFloat {
      animation: physicalFloat 1.2s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalZoom,
    #ultra-adventurer.animation-physicalZoom {
      animation: physicalZoom 0.5s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalFlash,
    #ultra-adventurer.animation-physicalFlash {
      animation: physicalFlash 0.4s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalWave,
    #ultra-adventurer.animation-physicalWave {
      animation: physicalWave 1s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalPump,
    #ultra-adventurer.animation-physicalPump {
      animation: physicalPump 0.6s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalVictoryDance,
    #ultra-adventurer.animation-physicalVictoryDance {
      animation: physicalVictoryDance 1.5s ease-in-out !important;
    }

    .ultra-reactive-adventurer.animation-physicalGlow,
    #ultra-adventurer.animation-physicalGlow {
      animation: physicalGlow 1s ease-in-out !important;
    }
    
    .ultra-reactive-adventurer .avatar-accessory-ultra,
    #ultra-adventurer .avatar-accessory-ultra,
    .ultra-reactive-adventurer .avatar-accessory,
    #ultra-adventurer .avatar-accessory {
      position: absolute !important;
      top: 25% !important;
      right: 10% !important;
      left: auto !important;
      bottom: auto !important;
      width: 30% !important;
      height: 30% !important;
      z-index: 15 !important;
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
      overflow: visible !important;
      pointer-events: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    .ultra-reactive-adventurer .avatar-accessory-ultra img,
    #ultra-adventurer .avatar-accessory-ultra img,
    .ultra-reactive-adventurer .avatar-accessory img,
    #ultra-adventurer .avatar-accessory img {
      width: 100% !important;
      height: 100% !important;
      display: block !important;
      opacity: 1 !important;
      object-fit: contain !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
    }
    
    .ultra-reactive-adventurer .adventure-speech-bubble,
    #ultra-adventurer .adventure-speech-bubble {
      position: absolute !important;
      top: -60px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      min-width: 80px !important;
      max-width: 150px !important;
      padding: 6px 12px !important;
      background: linear-gradient(145deg, #2c3e50, #34495e) !important;
      color: white !important;
      border-radius: 12px !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
      font-size: 11px !important;
      font-weight: 600 !important;
      text-align: center !important;
      line-height: 1.3 !important;
      z-index: 25 !important;
      pointer-events: none !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }
    
    .ultra-reactive-adventurer .adventure-effects-ultra,
    #ultra-adventurer .adventure-effects-ultra {
      position: absolute !important;
      top: 10% !important;
      left: 50% !important;
      right: auto !important;
      bottom: auto !important;
      transform: translateX(-50%) !important;
      font-size: 1.2rem !important;
      z-index: 20 !important;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.8) !important;
      min-height: 20px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      margin: 0 !important;
      padding: 0 !important;
      background: none !important;
      border: none !important;
    }
    
    .ultra-reactive-adventurer .adventure-aura,
    #ultra-adventurer .adventure-aura {
      position: absolute !important;
      top: -5% !important;
      left: -5% !important;
      right: -5% !important;
      bottom: -5% !important;
      border-radius: 50% !important;
      z-index: 1 !important;
      transition: all 0.5s ease !important;
      margin: 0 !important;
      padding: 0 !important;
    }
  </style>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <!-- Configuration Firebase -->
  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBfy1clmJoOl_0r3rQKhJb8ooPWkQgBuQs",
      authDomain: "english-games-41017.firebaseapp.com",
      projectId: "english-games-41017",
      storageBucket: "english-games-41017.appspot.com",
      messagingSenderId: "1062036556501",
      appId: "1:1062036556501:web:e74b7a0c8b8b8b8b8b8b8b"
    };

    // Initialiser Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
      console.log('✅ Firebase initialisé pour Enigma Scroll');
    }
  </script>
  
  <script src="../src/js/firebase-init.js"></script>
  <script src="../src/js/firebase-service-adapter.js"></script>
  
  <!-- Scripts d'authentification -->
  <script type="module" src="../scripts/auth-service.js"></script>
  <script type="module" src="../scripts/auth-header.js"></script>
  <script src="../scripts/game-stats-service.js"></script>

  <!-- Nouveau système de notation simplifié -->
  <script src="../scripts/simple-rating-system.js"></script>
  <script src="../scripts/update-rating-system.js"></script>
  
  <!-- SYSTÈME D'AVATAR ULTRA-SIMPLE ET ROBUSTE -->
  <script src="enigma-scroll-avatar-simple.js"></script>
  
  <!-- 🚫 DÉSACTIVER L'ANCIEN SYSTÈME D'AVATAR CONFLICTUEL -->
  <script>
    // Empêcher le chargement du système d'avatar conflictuel
    window.DISABLE_GAME_AVATAR_INTEGRATION = true;
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🎯 [Avatar] Protection contre les avatars conflictuels...');
      
      // Supprimer tous les anciens avatars
      setTimeout(() => {
        const conflictingAvatars = document.querySelectorAll('.floating-buddy-avatar, .wandering-pet-avatar, .mini-adventurer-avatar, .game-mini-avatar, [class*="adventurer"]:not(#ultra-adventurer)');
        conflictingAvatars.forEach(avatar => {
          console.log('🗑️ [Avatar] Suppression avatar conflictuel:', avatar.className);
          avatar.remove();
        });
        
        // Désactiver l'ancien système s'il existe
        if (window.gameAvatarIntegration) {
          console.log('🚫 [Avatar] Désactivation système conflictuel');
          window.gameAvatarIntegration = null;
        }
        
        // Vérifier notre avatar
        const ourAvatar = document.getElementById('ultra-adventurer');
        if (ourAvatar && window.enigmaAvatar) {
          console.log('✅ [Avatar] Notre système fonctionne correctement');
          
          // Système d'analyse des performances du joueur
          window.playerPerformanceTracker = {
            recentScores: [],
            recentCombos: [],
            totalScore: 0,
            wordsFound: 0,
            averageScore: 0,
            
            updateScore(newScore) {
              this.recentScores.push(newScore);
              if (this.recentScores.length > 5) this.recentScores.shift();
              this.totalScore += newScore;
              this.averageScore = this.recentScores.reduce((a, b) => a + b, 0) / this.recentScores.length;
            },
            
            updateCombo(combo) {
              this.recentCombos.push(combo);
              if (this.recentCombos.length > 3) this.recentCombos.shift();
            },
            
            getPerformanceLevel() {
              const avgScore = this.averageScore || 0;
              const maxCombo = Math.max(...this.recentCombos, 0);
              const totalWords = this.wordsFound;
              
              // Performance exceptionnelle (niveau 4 - Super)
              if (avgScore >= 40 && maxCombo >= 8 && totalWords >= 5) {
                return 'super';
              }
              // Excellente performance (niveau 3)
              else if (avgScore >= 25 && maxCombo >= 5 && totalWords >= 3) {
                return 'level3';
              }
              // Bonne performance (niveau 2)
              else if (avgScore >= 15 && maxCombo >= 3 && totalWords >= 2) {
                return 'level2';
              }
              // Performance de base (niveau 1)
              else {
                return 'level1';
              }
            }
          };

          // Fonction playAnimation complètement refaite - SIMPLE ET DIRECTE
          window.enigmaAvatar.playAnimation = function(animationType) {
            console.log(`🎭 [Avatar FORCE] Animation demandée: ${animationType}`);
            
            const avatar = document.getElementById('ultra-adventurer');
            if (!avatar) {
              console.error('❌ [Avatar FORCE] Avatar introuvable !');
              return;
            }
            
            // Obtenir le niveau de performance
            const performanceLevel = window.playerPerformanceTracker.getPerformanceLevel();
            console.log(`📊 [Avatar FORCE] Niveau de performance: ${performanceLevel}`);
            
            // Adapter l'animation selon les performances
            let finalAnimation = animationType;
            if (animationType === 'physicalBounce' || animationType === 'physicalSpin') {
              switch (performanceLevel) {
                case 'super':
                  finalAnimation = `physicalSuper${animationType.replace('physical', '')}`;
                  break;
                case 'level3':
                  finalAnimation = `${animationType}Level3`;
                  break;
                case 'level2':
                  finalAnimation = `${animationType}Level2`;
                  break;
                case 'level1':
                default:
                  finalAnimation = `${animationType}Level1`;
                  break;
              }
            }
            
            console.log(`🎯 [Avatar FORCE] Animation finale: ${finalAnimation}`);
            
            // Nettoyer TOUTES les anciennes animations
            avatar.classList.forEach(className => {
              if (className.startsWith('animation-')) {
                avatar.classList.remove(className);
              }
            });
            
            // Forcer l'ajout de la nouvelle animation
            const animationClass = `animation-${finalAnimation}`;
            avatar.classList.add(animationClass);
            
            console.log(`✅ [Avatar FORCE] Classe ajoutée: ${animationClass}`);
            console.log(`🔍 [Avatar FORCE] Classes actuelles:`, Array.from(avatar.classList));
            
            // Auto-nettoyage après 4 secondes
            setTimeout(() => {
              avatar.classList.remove(animationClass);
              console.log(`🧹 [Avatar FORCE] Animation ${animationClass} nettoyée`);
            }, 4000);
          };
          
          // Test de l'avatar
          setTimeout(() => {
            window.enigmaAvatar.reactToGameStart();
            console.log('🎯 [Avatar] Test de démarrage envoyé');
            

                      }, 2000);
            

        } else {
          console.error('❌ [Avatar] Problème avec notre système');
        }
      }, 500);
    });
  </script>
  
  <!-- Gestion universelle du menu mobile et synchronisation auth -->
  <script src="../scripts/universal-mobile-auth.js" defer></script>

  <!-- Script de jeu principal -->
  <script src="enigma-scroll-script.js"></script>

  <!-- SYSTÈME DE VALIDATION ULTRA-COMPLET -->
  <script src="comprehensive-word-validator.js"></script>
  
  <!-- 🚀 SYSTÈME D'EXTENSION MASSIVE DE MOTS -->
  <script src="word-database-booster.js"></script>

  <!-- Le système d'avatar ultra-simple se charge automatiquement -->

  <!-- Autres styles du jeu -->
  <link rel="stylesheet" href="../src/components/styles/game-ui.css">

  <style>
    /* Variables exactes du site reborn */
    :root {
      --color-primary: #2ecc71;
      --color-secondary: #27ae60;
      --color-accent: #f1c40f;
      --color-danger: #e74c3c;
      --color-warning: #f39c12;
      --color-info: #3498db;
      --color-background: #121212;
      --color-surface: #1e1e1e;
      --color-surface-hover: #2a2a2a;
      --color-surface-active: #333333;
      --color-text-primary: #ffffff;
      --color-text-secondary: rgba(255, 255, 255, 0.7);
      --color-text-disabled: rgba(255, 255, 255, 0.5);
      --word-correct: #2ecc71;
      --word-present: #f39c12;
      --word-absent: #7f8c8d;
      --word-unfilled: rgba(255, 255, 255, 0.1);
      --spacing-xs: 0.5rem;
      --spacing-sm: 1rem;
      --spacing-md: 2rem;
      --spacing-lg: 3rem;
      --spacing-xl: 5rem;
      --border-radius-sm: 0.25rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 1rem;
      --border-radius-xl: 2rem;
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
      --shadow-glow: 0 0 15px rgba(0, 229, 255, 0.5);
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --transition-slow: 0.5s ease;
      --font-family-primary: 'Exo 2', sans-serif;
      --font-family-secondary: 'Cinzel', serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family-primary);
      background-color: var(--color-background);
      color: var(--color-text-primary);
      line-height: 1.5;
      overflow-x: hidden;
      min-height: 100vh;
      padding-top: 80px;
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(46, 204, 113, 0.2);
      z-index: 1000;
      padding: var(--spacing-sm) 0;
    }

    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-sm);
    }

    .logo {
      font-family: var(--font-family-secondary);
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--color-primary);
      text-decoration: none;
      letter-spacing: 1px;
    }

    .logo span {
      color: var(--color-text-primary);
    }

    .nav-list {
      display: flex;
      gap: 2rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-link {
      color: var(--color-text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: all var(--transition-normal);
      position: relative;
      padding: 0.5rem 0;
    }

    .nav-link:hover {
      color: var(--color-primary);
    }

    .nav-link.active {
      color: var(--color-primary);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--color-primary);
      transition: width var(--transition-normal);
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-login {
      background: linear-gradient(135deg, var(--color-primary), var(--color-info));
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-md);
      text-decoration: none;
      font-weight: 600;
      transition: all var(--transition-normal);
      border: none;
      cursor: pointer;
    }

    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-sm);
    }

    .game-universe {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 2rem 0;
      background-color: var(--color-background);
      gap: 2rem;
    }

    .game-content {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 2rem;
      width: 100%;
      max-width: 1200px;
    }

    .game-interface {
      width: 100%;
      max-width: 600px;
      text-align: center;
      margin: 0 auto;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .game-header-content {
      margin-bottom: 2rem;
    }

    .section-title.text-gradient {
      background: linear-gradient(90deg, var(--color-primary), var(--color-info));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 900;
      font-size: 3rem;
      margin-bottom: 1rem;
      font-family: var(--font-family-secondary);
    }

    .game-subtitle {
      color: var(--color-text-secondary);
      font-size: 1.2rem;
      margin-bottom: 2rem;
      font-family: 'Spectral', serif;
    }

    .difficulty-selection {
      margin: 2rem 0;
    }

    .difficulty-selection h3 {
      color: var(--color-text-primary);
      margin-bottom: 1.5rem;
      font-family: var(--font-family-secondary);
    }

    .difficulty-options {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }

    .difficulty-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1.5rem 1rem;
      background: var(--color-surface);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      cursor: pointer;
      transition: all var(--transition-normal);
      color: var(--color-text-primary);
      min-width: 120px;
      text-decoration: none;
    }

    .difficulty-btn:hover {
      background: var(--color-surface-hover);
      border-color: var(--color-primary);
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .difficulty-btn.active {
      background: var(--color-primary);
      color: var(--color-background);
    }

    .difficulty-icon {
      font-size: 1.5rem;
      color: var(--color-primary);
    }

    .difficulty-btn.active .difficulty-icon {
      color: var(--color-background);
    }

    .difficulty-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .difficulty-desc {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .game-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .game-button {
      padding: 1rem 2rem;
      border-radius: var(--border-radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      border: none;
      font-family: var(--font-family-primary);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .primary-button {
      background: linear-gradient(135deg, var(--color-secondary), var(--color-primary));
      color: var(--color-background);
    }

    .primary-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .secondary-button {
      background: transparent;
      border: 1px solid var(--color-primary);
      color: var(--color-primary);
    }

    .secondary-button:hover {
      background-color: rgba(46, 204, 113, 0.1);
    }

    .hidden {
      display: none !important;
    }

    /* Interface de jeu */
    .game-hud {
      display: flex;
      justify-content: space-around;
      background: var(--color-surface);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      padding: 1rem;
      margin-bottom: 2rem;
    }

    .hud-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
    }

    .hud-icon {
      color: var(--color-primary);
      font-size: 1.2rem;
    }

    .hud-label {
      font-size: 0.8rem;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .hud-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--color-text-primary);
    }

    /* Power-ups */
    .power-ups-container {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .power-up {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--color-surface);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-normal);
      width: 80px;
    }

    .power-up:hover {
      background: var(--color-surface-hover);
      border-color: var(--color-primary);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .power-up.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .power-up.disabled:hover {
      transform: none;
      box-shadow: none;
      background: var(--color-surface);
    }

    .power-up-icon {
      font-size: 1.5rem;
      color: var(--color-primary);
    }

    .power-up-name {
      font-size: 0.9rem;
      color: var(--color-text-primary);
    }

    .power-up-count {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--color-text-primary);
    }

    /* Grille de mots */
    .word-grid {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      margin: 2rem 0;
      width: 100%;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .grid-row {
      display: flex;
      gap: 0.5rem;
      width: 100%;
      justify-content: center;
    }

    .grid-cell {
      width: 3.5rem;
      height: 3.5rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--color-text-primary);
      background: var(--color-surface);
      transition: all var(--transition-normal);
    }

    .grid-cell.filled {
      border-color: var(--color-primary);
      background: var(--color-surface-hover);
    }

    .grid-cell.correct {
      background: var(--word-correct);
      border-color: var(--word-correct);
      color: white;
    }

    .grid-cell.present {
      background: var(--word-present);
      border-color: var(--word-present);
      color: white;
    }

    .grid-cell.absent {
      background: var(--word-absent);
      border-color: var(--word-absent);
      color: white;
    }

    /* Clavier virtuel */
    .virtual-keyboard {
      margin: 2rem 0;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .key-btn {
      padding: 1rem 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius-sm);
      background: var(--color-surface);
      color: var(--color-text-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      min-width: 2.5rem;
      font-family: var(--font-family-primary);
    }

    .key-btn:hover {
      background: var(--color-surface-hover);
      border-color: var(--color-primary);
    }

    .key-special {
      min-width: 4rem;
      font-size: 0.9rem;
    }

    .key-btn.correct {
      background: var(--word-correct);
      border-color: var(--word-correct);
      color: white;
    }

    .key-btn.present {
      background: var(--word-present);
      border-color: var(--word-present);
      color: white;
    }

    .key-btn.absent {
      background: var(--word-absent);
      border-color: var(--word-absent);
      color: white;
      opacity: 0.6;
    }

    /* Messages */
    .message-container {
      position: fixed;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1100;
      max-width: 400px;
      width: 90%;
    }

    .game-message {
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius-lg);
      color: white;
      font-weight: 600;
      text-align: center;
      margin-bottom: 0.5rem;
      animation: slideDown 0.3s ease-out;
    }

    .game-message.success {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    }

    .game-message.error {
      background: linear-gradient(135deg, var(--color-danger), #c0392b);
    }

    .game-message.warning {
      background: linear-gradient(135deg, var(--color-warning), #e67e22);
    }

    .game-message.info {
      background: linear-gradient(135deg, var(--color-info), #2980b9);
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sidebar */
    .sidebar-card {
      background: var(--color-surface);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      padding: 1.5rem;
    }

    .sidebar-card h3 {
      color: var(--color-text-primary);
      margin-bottom: 1rem;
      font-family: var(--font-family-secondary);
    }

    .stats-grid {
      display: grid;
      gap: 1rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-label {
      color: var(--color-text-secondary);
      font-size: 0.9rem;
    }

    .stat-value {
      color: var(--color-primary);
      font-weight: bold;
      font-size: 1.2rem;
    }

    .help-content {
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .help-content p {
      margin-bottom: 1rem;
    }

    .help-content ul {
      margin-left: 1rem;
      margin-bottom: 1rem;
    }

    .color-guide {
      margin: 1rem 0;
    }

    .color-example {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .example-letter {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      border-radius: var(--border-radius-sm);
      font-weight: bold;
      color: white;
    }

    .example-letter.correct {
      background: var(--word-correct);
    }

    .example-letter.present {
      background: var(--word-present);
    }

    .example-letter.absent {
      background: var(--word-absent);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .game-content {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .sidebar {
        order: -1;
      }

      .section-title.text-gradient {
        font-size: 2rem;
      }

      .difficulty-options {
        flex-direction: column;
        align-items: center;
      }

      .difficulty-btn {
        width: 100%;
        max-width: 300px;
      }

      .grid-cell {
        width: 2.5rem;
        height: 2.5rem;
        font-size: 1.2rem;
      }

      .key-btn {
        padding: 0.8rem 0.6rem;
        min-width: 2rem;
      }

      .key-special {
        min-width: 3rem;
      }

      .game-hud {
        flex-wrap: wrap;
        gap: 1rem;
      }

      .power-ups-container {
        gap: 1rem;
      }

      .power-up {
        width: 70px;
        padding: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .header-container {
        flex-direction: column;
        gap: 1rem;
      }

      .nav-list {
        gap: 1rem;
      }

      .grid-cell {
        width: 2rem;
        height: 2rem;
        font-size: 1rem;
      }

      .key-btn {
        padding: 0.6rem 0.4rem;
        min-width: 1.8rem;
        font-size: 0.9rem;
      }

      .game-buttons {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <a href="../index.html" class="logo">English <span>Quest</span></a>
      
      <nav class="nav" id="mainNav">
        <ul class="nav-list">
          <li><a href="../index.html" class="nav-link">Accueil</a></li>
          <li><a href="../games.html" class="nav-link active">Jeux</a></li>
          <li><a href="../courses.html" class="nav-link">Cours</a></li>
          <li><a href="../progress.html" class="nav-link">Progression</a></li>
        </ul>
      </nav>
      
      <div class="user-menu" id="userMenu">
        <a href="../auth.html" class="btn-login" id="loginBtn">Se connecter</a>
      </div>
    </div>
  </header>

  <!-- 🎯 AVATAR ULTRA-RÉACTIF - CONTENEUR PRINCIPAL -->
  <div id="ultra-adventurer" class="ultra-reactive-adventurer">
    <div class="adventurer-avatar-ultra">
      <div class="avatar-display-ultra">
        <div class="avatar-body-ultra">
          <div class="avatar-head-ultra" id="userAvatarHead">
            🧙‍♂️
          </div>
          <div class="avatar-accessory-ultra">
            ⚡
          </div>
        </div>
      </div>
      <div class="adventure-aura"></div>
    </div>
    <div class="speech-bubble-ultra" id="avatarSpeechBubble" style="display: none;">
      <div class="bubble-content-ultra"></div>
      <div class="bubble-arrow-ultra"></div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="game-universe">
    <div class="container">
      <div class="game-content">
        <div class="game-interface">
          <!-- Écran d'accueil -->
          <div id="welcome-screen" class="welcome-screen">
            <div class="game-header-content">
              <h1 class="section-title text-gradient">Enigma Scroll</h1>
              <p class="game-subtitle">Découvrez des mots mystérieux cachés dans les parchemins anciens</p>
            </div>

            <!-- Sélection de difficulté -->
            <div class="difficulty-selection">
              <h3>Choisissez votre défi</h3>
              <div class="difficulty-options">
                <div class="difficulty-btn" data-difficulty="4">
                  <div class="difficulty-icon">⭐</div>
                  <div class="difficulty-name">Débutant</div>
                  <div class="difficulty-desc">4 lettres</div>
                </div>
                <div class="difficulty-btn" data-difficulty="5">
                  <div class="difficulty-icon">⭐⭐</div>
                  <div class="difficulty-name">Intermédiaire</div>
                  <div class="difficulty-desc">5 lettres</div>
                </div>
                <div class="difficulty-btn" data-difficulty="6">
                  <div class="difficulty-icon">⭐⭐⭐</div>
                  <div class="difficulty-name">Avancé</div>
                  <div class="difficulty-desc">6 lettres</div>
                </div>
              </div>
            </div>

            <div class="game-buttons">
              <button id="start-game-button" class="game-button primary-button">
                <i class="fas fa-play"></i>
                Commencer l'aventure
              </button>
            </div>
          </div>

          <!-- Interface de jeu -->
          <div id="game-area" class="game-area hidden">
            <!-- HUD -->
            <div class="game-hud">
              <div class="hud-item">
                <div class="hud-icon">🎯</div>
                <div class="hud-label">Score</div>
                <div class="hud-value" id="score-display">0</div>
              </div>
              <div class="hud-item">
                <div class="hud-icon">🔥</div>
                <div class="hud-label">Combo</div>
                <div class="hud-value" id="combo-display">1x</div>
              </div>
              <div class="hud-item">
                <div class="hud-icon">⏱️</div>
                <div class="hud-label">Temps</div>
                <div class="hud-value" id="time-display">90</div>
              </div>
              <div class="hud-item">
                <div class="hud-icon">📝</div>
                <div class="hud-label">Tentatives</div>
                <div class="hud-value" id="attempts-display">0/6</div>
              </div>
            </div>

            <!-- Power-ups -->
            <div class="power-ups-container">
              <div class="power-up" data-type="hint">
                <div class="power-up-icon">💡</div>
                <div class="power-up-name">Indice</div>
                <div class="power-up-count" id="hint-count">3</div>
              </div>
              <div class="power-up" data-type="time">
                <div class="power-up-icon">⏰</div>
                <div class="power-up-name">+30s</div>
                <div class="power-up-count" id="time-count">2</div>
              </div>
              <div class="power-up" data-type="skip">
                <div class="power-up-icon">⏭️</div>
                <div class="power-up-name">Passer</div>
                <div class="power-up-count" id="skip-count">1</div>
              </div>
            </div>

            <!-- Grille de mots -->
            <div class="word-grid" id="word-grid">
              <!-- Générée dynamiquement -->
            </div>

            <!-- Clavier virtuel -->
            <div class="virtual-keyboard" id="keyboard">
              <div class="keyboard-row">
                <button class="key-btn" data-key="Q">Q</button>
                <button class="key-btn" data-key="W">W</button>
                <button class="key-btn" data-key="E">E</button>
                <button class="key-btn" data-key="R">R</button>
                <button class="key-btn" data-key="T">T</button>
                <button class="key-btn" data-key="Y">Y</button>
                <button class="key-btn" data-key="U">U</button>
                <button class="key-btn" data-key="I">I</button>
                <button class="key-btn" data-key="O">O</button>
                <button class="key-btn" data-key="P">P</button>
              </div>
              <div class="keyboard-row">
                <button class="key-btn" data-key="A">A</button>
                <button class="key-btn" data-key="S">S</button>
                <button class="key-btn" data-key="D">D</button>
                <button class="key-btn" data-key="F">F</button>
                <button class="key-btn" data-key="G">G</button>
                <button class="key-btn" data-key="H">H</button>
                <button class="key-btn" data-key="J">J</button>
                <button class="key-btn" data-key="K">K</button>
                <button class="key-btn" data-key="L">L</button>
              </div>
              <div class="keyboard-row">
                <button class="key-btn key-special" data-key="ENTER">ENTER</button>
                <button class="key-btn" data-key="Z">Z</button>
                <button class="key-btn" data-key="X">X</button>
                <button class="key-btn" data-key="C">C</button>
                <button class="key-btn" data-key="V">V</button>
                <button class="key-btn" data-key="B">B</button>
                <button class="key-btn" data-key="N">N</button>
                <button class="key-btn" data-key="M">M</button>
                <button class="key-btn key-special" data-key="BACKSPACE">⌫</button>
              </div>
            </div>

            <!-- Messages du jeu -->
            <div class="message-container" id="message-container"></div>

            <!-- Bouton nouveau jeu -->
            <div class="game-buttons">
              <button id="new-game-button" class="game-button secondary-button" style="display: none;">
                <i class="fas fa-redo"></i>
                Nouvelle partie
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <div class="sidebar-card">
            <h3>🏆 Statistiques</h3>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-label">Mots trouvés</div>
                <div class="stat-value" id="words-found-stat">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Meilleur combo</div>
                <div class="stat-value" id="best-combo-stat">1</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Score total</div>
                <div class="stat-value" id="total-score-stat">0</div>
              </div>
            </div>
          </div>

          <div class="sidebar-card">
            <h3>📚 Comment jouer</h3>
            <div class="help-content">
              <p><strong>Objectif :</strong> Devinez le mot mystérieux !</p>
              <div class="color-guide">
                <div class="color-example">
                  <span class="example-letter correct">A</span>
                  <span>Bonne lettre, bonne position</span>
                </div>
                <div class="color-example">
                  <span class="example-letter present">B</span>
                  <span>Bonne lettre, mauvaise position</span>
                </div>
                <div class="color-example">
                  <span class="example-letter absent">C</span>
                  <span>Lettre absente du mot</span>
                </div>
              </div>
              <p><strong>Power-ups :</strong></p>
              <ul>
                <li>💡 <strong>Indice</strong> : Révèle une lettre</li>
                <li>⏰ <strong>+30s</strong> : Ajoute du temps</li>
                <li>⏭️ <strong>Passer</strong> : Nouveau mot</li>
              </ul>
              <p><strong>Raccourcis :</strong> 1, 2, 3</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Script principal du jeu -->
  <script src="enigma-scroll-script.js"></script>
  
  <script>
    // Initialisation complète du jeu avec le nouveau système
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🎯 Initialisation d\'Enigma Scroll avec système ultra-diversifié...');
      
      // Attendre que tous les systèmes soient chargés
      let initAttempts = 0;
      const maxAttempts = 100;
      
      function checkSystemsReady() {
        initAttempts++;
        
        // Vérifier que tous les systèmes sont disponibles
        const systemsReady = (
          window.COMPREHENSIVE_ENGLISH_WORDS &&
          window.validateWordComprehensive &&
          window.boostWordDatabase &&
          typeof wordGenerator !== 'undefined'
        );
        
        if (systemsReady) {
          console.log('✅ Tous les systèmes sont prêts !');
          console.log(`📊 Base de mots chargée avec ${Object.values(window.COMPREHENSIVE_ENGLISH_WORDS).reduce((a, b) => a + b.length, 0)} mots`);
          
          // Vérifier les améliorations
          const stats = window.getDatabaseStats ? window.getDatabaseStats() : null;
          if (stats) {
            console.log('📈 Statistiques de la base enrichie:', stats);
          }
          
          // Initialiser l'interface
          initializeGameInterface();
          
        } else if (initAttempts < maxAttempts) {
          setTimeout(checkSystemsReady, 100);
        } else {
          console.warn('⚠️ Timeout lors de l\'initialisation - Démarrage en mode dégradé');
          initializeGameInterface();
        }
      }
      
      function initializeGameInterface() {
        // Gestion des événements
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            // Marquer comme sélectionné
            document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            
            // Activer le bouton de démarrage
            document.getElementById('start-game-button').disabled = false;
          });
        });
        
        document.getElementById('start-game-button').addEventListener('click', async function() {
          const selectedDiff = document.querySelector('.difficulty-btn.selected');
          if (selectedDiff) {
            const difficulty = parseInt(selectedDiff.dataset.difficulty);
            console.log(`🎮 Démarrage du jeu en difficulté ${difficulty} lettres`);
            await startGame(difficulty);
          } else {
            alert('Veuillez sélectionner une difficulté !');
          }
        });
        
        document.getElementById('new-game-button').addEventListener('click', newGame);
        
        // Gestion du clavier
        document.addEventListener('keydown', function(e) {
          if (!window.gameState || !window.gameState.gameActive) return;
          
          if (e.key.match(/[a-zA-Z]/)) {
            handleKeyPress(e.key.toUpperCase());
          } else if (e.key === 'Enter') {
            handleKeyPress('ENTER');
          } else if (e.key === 'Backspace') {
            handleKeyPress('BACKSPACE');
          } else if (e.key >= '1' && e.key <= '3') {
            const powerUpTypes = ['hint', 'time', 'skip'];
            const powerUpType = powerUpTypes[parseInt(e.key) - 1];
            usePowerUp(powerUpType);
          }
        });
        
        // Clavier virtuel
        document.querySelectorAll('.key-btn').forEach(key => {
          key.addEventListener('click', function() {
            handleKeyPress(this.dataset.key);
          });
        });
        
        // Power-ups
        document.querySelectorAll('.power-up').forEach(powerUp => {
          powerUp.addEventListener('click', function() {
            if (!this.classList.contains('disabled')) {
              usePowerUp(this.dataset.type);
            }
          });
        });
        
        console.log('✅ Interface d\'Enigma Scroll initialisée !');
      }
      
      checkSystemsReady();
    });
  </script>
</body>
</html> 