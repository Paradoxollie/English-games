<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="English Quest - Learn English through interactive games and courses">
    
    <!-- Skip link pour l'accessibilité -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="./images/logo.gif" as="image">
    <link rel="preload" href="./src/js/performance.js" as="script">
    <link rel="preload" href="./src/js/accessibility.js" as="script">
    
    <!-- Polices -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link href="./dist/output.css" rel="stylesheet">
    <link href="./src/styles/layout.css" rel="stylesheet">
    <link href="./src/styles/fonts.css" rel="stylesheet">
    <link href="./src/styles/transitions.css" rel="stylesheet">
    <link href="./src/styles/colors.css" rel="stylesheet">
    <link href="./src/styles/navigation.css" rel="stylesheet">
    <link href="./src/styles/carousel.css" rel="stylesheet">
    <link href="./src/styles/accessibility.css" rel="stylesheet">
    <link href="./src/styles/nav-reset.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RMCQTMKDVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RMCQTMKDVP');
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>

    <!-- Sentry pour le monitoring -->
    <script src="https://browser.sentry-cdn.com/7.0.0/bundle.min.js"></script>

    <!-- Scripts de l'application -->
    <script src="./src/config/firebase-config.js"></script>
    <script src="./src/js/performance.js"></script>
    <script src="./src/js/accessibility.js"></script>
    <script src="./src/js/cache-manager.js"></script>
    <script src="./src/js/monitoring.js"></script>
    <script src="./src/js/app.js"></script>
    <script src="./visit-counter.js"></script>

    <style>
        /* Styles spécifiques pour les badges et tags */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            border: 2px solid;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            border: 2px solid;
            margin: 0.25rem;
        }

        /* Effets de lueur améliorés */
        .glow-text-lg {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5),
                         0 0 20px rgba(255, 215, 0, 0.3),
                         0 0 30px rgba(255, 215, 0, 0.2);
        }
        
        .glow-text-blue-lg {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5),
                         0 0 20px rgba(59, 130, 246, 0.3),
                         0 0 30px rgba(59, 130, 246, 0.2);
        }
        
        /* Style pour les titres */
        .section-title {
            @apply relative;
        }
        
        .section-title::after {
            content: '';
            @apply absolute left-1/2 -bottom-4 w-32 h-1 transform -translate-x-1/2;
            background: linear-gradient(90deg, transparent, currentColor, transparent);
        }
    </style>
</head>
<body class="bg-quest-pattern" data-page="index" style="background-image: url('./images/background.webp');">
    <!-- Header avec accessibilité améliorée -->
    <header class="site-header" role="banner" aria-label="Site header">
    <div class="logo-container">
            <img src="./images/logo.gif"
                 alt="English Quest Logo"
                 class="w-48 md:w-64 h-auto"
                 width="600"
                 height="400"
                 loading="eager"
                 decoding="async">
        </div>

        <nav class="main-nav overflow-x-auto" role="navigation" aria-label="Main navigation">
            <div class="w-full overflow-x-auto">
                <div class="container mx-auto grid grid-flow-col auto-cols-max gap-8 justify-center px-4 py-3">
                    <a href="index.html" class="nav-link active text-quest-gold font-bold hover:text-quest-gold relative glow-gold text-sm md:text-base">Home</a>
                    <a href="./all-games.html" class="nav-link text-sm md:text-base">Games</a>
                    <a href="./courses.html" class="nav-link text-sm md:text-base">Courses</a>
                    <a href="./leaderboard.html" class="nav-link text-sm md:text-base">Leaderboard</a>
                    <a href="./contact.html" class="nav-link text-sm md:text-base">Contact</a>
                            </div>
                        </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden" aria-label="Menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <!-- Mobile menu content will be injected by JavaScript -->
                                </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="min-h-screen pt-16 md:pt-32 px-4 md:px-8" role="main">
        <!-- Hero Section avec accessibilité améliorée -->
        <div class="quest-panel max-w-2xl mx-auto mb-8 md:mb-16 text-center" role="banner" aria-labelledby="main-title">
            <h1 id="main-title" class="text-3xl md:text-5xl font-bold mb-4 md:mb-6 glow-text px-2" aria-label="English Quest - Choose your path to mastery">
                <span class="text-white">ENGLISH</span>
                <span class="text-quest-gold">QUEST</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-300 px-2">Choose your path to mastery!</p>
                        </div>

        <!-- Games Section -->
        <section class="quest-panel max-w-7xl mx-auto mb-16 px-4" aria-labelledby="games-title">
            <div class="section-header mb-8 text-center">
                <h2 id="games-title" class="section-title text-5xl font-medieval mb-4">
                    <span class="text-quest-gold glow-text-lg block mb-2">Available Quests</span>
                    <span class="block text-3xl text-quest-gold/70 font-cinzel">Quêtes Disponibles</span>
                </h2>
                <p class="text-quest-gold/70 text-xl italic mt-4">Choose your challenge and prove your worth in the realm of English</p>
                                </div>
            <div id="game-carousel" class="relative" data-lazy="loadGameCarousel" role="region" aria-label="Games carousel">

                <div id="game-display" class="flex justify-center items-center min-h-[500px]">
                    <!-- Un seul jeu sera affiché ici -->
                        </div>

                <div class="flex justify-center mt-4 gap-4">
                </div>
            </div>
        </section>

        <!-- Courses Section -->
        <section class="quest-panel max-w-7xl mx-auto mb-16 px-4" aria-labelledby="courses-title">
            <div class="section-header mb-8 text-center">
                <h2 id="courses-title" class="section-title text-5xl font-medieval mb-4">
                    <span class="text-blue-500 glow-text-blue-lg block mb-2">Training Grounds</span>
                    <span class="block text-3xl text-blue-400/70 font-cinzel">Terrains d'Entraînement</span>
                </h2>
                <p class="text-blue-400/70 text-xl italic mt-4">Master the ancient arts of English grammar</p>
                                </div>
            <div id="course-carousel" class="relative" data-lazy="loadCourseCarousel" role="region" aria-label="Courses carousel">

                <div id="course-display" class="flex justify-center items-center min-h-[500px]">
                    <!-- Un seul cours sera affiché ici -->
                        </div>

                <div class="flex justify-center mt-4 gap-4">
                            </div>
                        </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="quest-footer" role="contentinfo">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-quest-gold text-lg font-medieval mb-4">About Us</h3>
                    <p class="text-gray-300">
                        English Quest is dedicated to making language learning fun and effective through interactive games.
                    </p>
                                </div>
                <div>
                    <h3 class="text-quest-gold text-lg font-medieval mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="./all-games.html" class="footer-link">All Games</a></li>
                        <li><a href="./courses.html" class="footer-link">Courses</a></li>
                        <li><a href="./leaderboard.html" class="footer-link">Leaderboard</a></li>
                        <li><a href="./contact.html" class="footer-link">Contact Us</a></li>
                    </ul>
                            </div>
                <div>
                    <h3 class="text-quest-gold text-lg font-medieval mb-4">Stats</h3>
                    <ul class="space-y-2">
                        <div class="visitor-counter text-left mb-4">
                            <div id="visitor-count" class="counter-wrapper">
                                <div class="counter-loading">
                                    <span class="text-quest-gold">Loading visitor stats...</span>
                                </div>
                            </div>
                        </div>
                    </ul>
            </div>
        </div>

            <div class="mt-8 pt-8 border-t border-quest-gold/30 text-center">
                <p class="text-gray-400">&copy; 2024 - English Quest - Pierre Marienne - All rights reserved </p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialiser les services
                const monitoring = new MonitoringService();
                const cacheManager = new CacheManager();
                const performanceOptimizer = new PerformanceOptimizer();
                const accessibilityManager = new AccessibilityManager();

                // Setup cache
                cacheManager.setupImageCache();

                // Code des carousels
                const games = [
                    {
                        title: "Speed Verb Challenge",
                        description: "Test your knowledge of irregular verbs! Type as many verbs as you can in 90 seconds!",
                        image: "./images/speed-challenge.webp",
                        url: "./speed-verb-challenge.html",
                        difficulty: "legendary",
                        tags: ["Verbs", "Time Trial", "Grammar"],
                        icon: "⚔️"
                    },
                    {
                        title: "Word Memory Game",
                        description: "Challenge your memory and vocabulary! Match pairs of words and their meanings.",
                        image: "./images/word-memory-game.webp",
                        url: "./word-memory-game.html",
                        difficulty: "intermediate",
                        tags: ["Vocabulary", "Memory", "Fun"],
                        icon: "🎯"
                    },
                    {
                        title: "Memory Matrix",
                        description: "Train your spatial memory with this grid-based challenge. Remember the patterns!",
                        image: "./images/matrix-game.webp",
                        url: "./memory-matrix.html",
                        difficulty: "hard",
                        tags: ["Memory", "Pattern", "Focus"],
                        icon: "🧩"
                    },
                    {
                        title: "Lost in Migration",
                        description: "Guide the birds in the right direction while learning English directions and commands!",
                        image: "./images/lost-in-migration.webp",
                        url: "./lost-in-migration.html",
                        difficulty: "easy",
                        tags: ["Directions", "Focus", "Fun"],
                        icon: "🦅"
                    },
                    {
                        title: "Brew Your Words",
                        description: "Mix and match ingredients to create magical potions while learning new vocabulary!",
                        image: "./images/brew-your-words.webp",
                        url: "./brew-your-words.html",
                        difficulty: "intermediate",
                        tags: ["Vocabulary", "Creative", "Magic"],
                        icon: "🧪"
                    },
                    {
                        title: "Enigma Scroll",
                        description: "Uncover the mysteries of the enchanted scroll! Test your English skills by solving magical word puzzles in this epic fantasy adventure!",
                        image: "./images/enigma-scroll.webp",
                        link: "enigma-scroll-nature.html",
                        tags: ["Puzzles", "Vocabulary", "Adventure"],
                        rarity: "epic"
                    },
                    {
                        title: "Whisper Trials",
                        description: "Test your listening skills in this atmospheric sound-based challenge!",
                        image: "./images/whisper-trials.webp",
                        url: "./whisper-trials.html",
                        difficulty: "legendary",
                        tags: ["Listening", "Focus", "Immersive"],
                        icon: "👂"
                    },
                    {
                        title: "Word Bubbles",
                        description: "Challenge your typing and vocabulary skills! Type the correct words as they fall before time runs out.",
                        image: "./images/word-bubbles.webp",
                        link: "wow-bubbles.html",
                        tags: ["Typing", "Speed", "Vocabulary"],
                        rarity: "rare"
                    },
                    {
                        title: "Echoes of Lexicon",
                        description: "Journey through a mystical world where words have power. Build your vocabulary!",
                        image: "./images/echoes-lexicon.webp",
                        url: "./echoes-lexicon.html",
                        difficulty: "hard",
                        tags: ["Vocabulary", "Adventure", "Story"],
                        icon: "📚"
                    }
                ];

                const courses = [
                    {
                        title: "The Conditional",
                        description: "Master the different forms and usage of the conditional with this comprehensive guide.",
                        image: "./images/conditionnel-course.webp",
                        url: "./conditional-course.html",
                        level: "advanced",
                        tags: ["Grammar", "Advanced", "Conditional"],
                        icon: "🎯"
                    },
                    {
                        title: "The Superlative",
                        description: "Learn the art of comparison and reach the pinnacle of excellence with superlatives.",
                        image: "./images/superlative.webp",
                        url: "./superlative.html",
                        level: "intermediate",
                        tags: ["Grammar", "Comparison", "Superlative"],
                        icon: "📊"
                    },
                    {
                        title: "Comparative",
                        description: "Face off against fierce grammar guardians and claim your place as the true Grammar Champion.",
                        image: "./images/comparative.webp",
                        url: "./comparative.html",
                        level: "intermediate",
                        tags: ["Grammar", "Comparison", "Comparative"],
                        icon: "⚖️"
                    },
                    {
                        title: "Since and For",
                        description: "Prove your worth as the ultimate Time Master in the realm of English.",
                        image: "./images/for-since.webp",
                        url: "./for-and-since.html",
                        level: "intermediate",
                        tags: ["Time", "Duration", "Prepositions"],
                        icon: "⏳"
                    },
                    {
                        title: "Modals Mastery",
                        description: "Devenez le Maître des Arcanes Modaux et manipulez la puissance des verbes anglais.",
                        image: "./images/modaux.webp",
                        url: "./modaux.html",
                        level: "advanced",
                        tags: ["Modals", "Verbs", "Advanced"],
                        icon: "🔮"
                    }
                ];

                // Ajoutons ces variables au début du script
                let usedGameIndexes = [];
                let usedCourseIndexes = [];

                function getNextUniqueIndex(array, usedIndexes) {
                    if (usedIndexes.length >= array.length) {
                        // Si tous les éléments ont été utilisés, on réinitialise
                        usedIndexes.length = 0;
                    }
                    
                    let availableIndexes = Array.from(array.keys())
                        .filter(i => !usedIndexes.includes(i));
                    
                    let randomIndex = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];
                    usedIndexes.push(randomIndex);
                    return randomIndex;
                }

                function createCard(item, isGame = true) {
                    return `
                        <div class="game-card bg-black/90 border-2 ${isGame ? 'border-quest-gold/80' : 'border-blue-500/80'} rounded-lg overflow-hidden w-[450px]">
                            <div class="relative h-52">
                                <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover">
                            </div>
                            <div class="p-6 bg-gradient-to-b from-black/95 to-black/90">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-2xl font-medieval ${isGame ? 'text-quest-gold' : 'text-blue-400'}">${item.title}</h3>
                                    <div class="badge badge-${isGame ? item.difficulty : item.level}">
                                        ${isGame ? item.difficulty.toUpperCase() : item.level.toUpperCase()}
                                    </div>
                                </div>
                                <p class="text-gray-300 mb-4">${item.description}</p>
                                <div class="flex flex-wrap gap-2 mb-6">
                                    ${item.tags.map(tag => `
                                        <span class="tag tag-${tag.toLowerCase().replace(/\s+/g, '-')}">
                                            ${tag}
                                        </span>
                                    `).join('')}
                                </div>
                                <a href="${item.url}" class="quest-button ${isGame ? 'quest-button-game' : 'quest-button-course'}">
                                    <span class="mr-2 text-xl">${item.icon}</span>
                                    <span>${isGame ? 'Play Now' : 'Start Training'}</span>
                                </a>
                            </div>
                        </div>
                    `;
                }

                function updateDisplays() {
                    try {
                        const gameDisplay = document.getElementById('game-display');
                        const courseDisplay = document.getElementById('course-display');

                        if (gameDisplay) {
                            const gameIndex = getNextUniqueIndex(games, usedGameIndexes);
                            const game = games[gameIndex];
                            gameDisplay.style.opacity = '0';
                            setTimeout(() => {
                                gameDisplay.innerHTML = createCard(game, true);
                                gameDisplay.style.opacity = '1';
                                monitoring.trackPerformance({
                                    name: 'game_card_update',
                                    value: Date.now()
                                });
                            }, 300);
                        }

                        if (courseDisplay) {
                            const courseIndex = getNextUniqueIndex(courses, usedCourseIndexes);
                            const course = courses[courseIndex];
                            courseDisplay.style.opacity = '0';
                            setTimeout(() => {
                                courseDisplay.innerHTML = createCard(course, false);
                                courseDisplay.style.opacity = '1';
                                monitoring.trackPerformance({
                                    name: 'course_card_update',
                                    value: Date.now()
                                });
                            }, 300);
                        }
                    } catch (error) {
                        monitoring.trackError(error, {
                            context: 'updateDisplays'
                        });
                    }
                }

                // Premier affichage
                updateDisplays();

                // Mise à jour toutes les 5 secondes
                setInterval(updateDisplays, 5000);
            } catch (error) {
                monitoring.trackError(error, {
                    context: 'DOMContentLoaded'
                });
            }
        });
    </script>
</body>
</html>